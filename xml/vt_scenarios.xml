<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>

<chapter xmlns="http://docbook.org/ns/docbook" 
	 xmlns:xi="http://www.w3.org/2001/XInclude" 
	 xmlns:xlink="http://www.w3.org/1999/xlink" 
	 version="5.0" xml:id="cha-virtualization-scenarios">
 <!-- I/O virtualization -->
 <title>Virtualization Scenarios</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker>
   </dm:bugtracker>
  </dm:docmanager>
  <abstract>
   <para>
    Virtualization provides several useful capabilities to your
    organization: more efficient hardware use, support for legacy software,
    operating system isolation, live migration, disaster recovery, and 
    load-balancing. 
   </para>
  </abstract>
 </info>
 <sect1 xml:id="sec-virtualization-scenarios-capabilities">
  <title>Server Consolidation</title>
  <para>
   Many servers can be replaced by one big physical
   server, so that hardware is consolidated, and guest operating systems are
   converted to virtual machines. This also supports running legacy
   software on new hardware.
   <!-- reduce cost -->
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Better usage of resources which were not running at 100%
    </para>
   </listitem>
   <listitem>
    <para>
     Fewer server locations needed
    </para>
   </listitem>
   <listitem>
    <para>
     More efficient use of computer resources: multiple workloads on the same server
    </para>
   </listitem>
   <listitem>
    <para>
     Simplification of data center infrastructure
    </para>
   </listitem>
   <listitem>
    <para>
     Eases moving workloads to other hosts, avoiding service downtime 
    </para>
   </listitem>
   <listitem>
    <para>
     Virtual Machine provisioning
    </para>
   </listitem>
   <listitem>
    <para>
     Multiple guest operating systems can run on a single host
    </para>
   </listitem>
  </itemizedlist>
  <important>
   <para>Server consolidation requires special attention to the following points:</para>
   <itemizedlist>
    <listitem>
     <para>
      Maintenance windows should be carefully planned
     </para>
    </listitem>
    <listitem>
     <para>
      Storage is key: it must be able to support migration and growing disk usage
     </para>
    </listitem>
    <listitem>
     <para>
      You must verify that your servers can support the additional workloads
     </para>
    </listitem>
   </itemizedlist>
  </important>
 </sect1>
 <sect1>
  <title>Security and Isolation</title>
  <para>
   Guest operating systems are fully isolated from the host
   running them. Therefore, if there are problems inside virtual machines, the host is
   not harmed. Also, problems inside one VM do not affect other VMs. No data
   is shared between VMs.
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Kernel Same page Merging should be avoided
    </para>
   </listitem>
   <listitem>
    <para>
     Individual CPU cores can be assigned to VMs to increase isolation
    </para>
    </listitem>
    <listitem>
    <para>
     Hyper-threading (HT) should be disabled to avoid potential security issues
    </para>
    </listitem>
    <listitem>
     <para>
      AMD and Intel provides some specific features regarding the security of virtualization
     </para>
    </listitem>
    <listitem>
     <para>
      Secure Boot can be used for VMs to ensure the load of signed drivers
     </para>
    </listitem>
  </itemizedlist>
  <important>
   <para>Isolation and Security enablement can affect performance and consolidation plan.</para>
   <itemizedlist>
    <listitem>
     <para>
      VM should not share network / storage / network / Hardware
    </para>
   </listitem>
   <listitem>
    <para>
     Use of advanced hypervisor features such as PCI pass-through or NUMA will adversely affect VM migration capabilities
    </para>
   </listitem>
   <listitem>
    <para>
     Usage of paravirtualisation and <literal>virtio</literal> drivers will generally improve VM performance and efficiency
    </para>
   </listitem>
   </itemizedlist>
  </important>
      <!-- REMOVE IT FROM NOW. PM WOULD LIKE TO DISCUSS ABOUT THIS
  <itemizedlist>
   <listitem>
    <para>
     AMD Secure Memory Encryption (SME):
     Uses a single key to encrypt system memory. The key is generated by the AMD Secure Processor at boot. SME requires enablement in the system BIOS or operating system. When enabled in the BIOS, memory encryption is transparent and can be run with any operating system.
    </para>
   </listitem>
   <listitem>
    <para>
     AMD Secure Encrypted Virtualization (SEV):
     Uses one key per virtual machine to isolate guests and the hypervisor from one another. The keys are managed by the AMD Secure Processor. SEV requires enablement in the guest operating system and hypervisor. The guest changes allow the VM to indicate which pages in memory should be encrypted. The hypervisor changes use hardware virtualization instructions and communication with the AMD Secure processor to manage the appropriate keys in the memory controller.
    </para>
   </listitem>
   <listitem>
    <para>
     AMD Secure Encrypted Virtualization-Encrypted State (SEV-ES):
     Since SEV only operates when a VM is running, the additional SEV-ES feature encrypts
     all CPU register contents when a VM stops running. This prevents the leakage of information
     in VMs' CPU registers to the hypervisor. SEV-ES can also detect malicious modifications to
     a CPU's register state.
    </para>
</listitem>
  </itemizedlist>
-->
 </sect1>
 <sect1>
  <title>Disaster Recovery</title>
  <para>
   The hypervisor can make snapshots of VMs, enabling restoration
   to a known good state, or to any desired earlier state. Since   
   <xref linkend="gloss-vt-virtualized"/> OSes are less dependent on
   hardware configuration than those running directly on bare metal,
   these snapshots can be restored onto different server hardware so
   long as it is running the same hypervisor.
  </para>
  <para>
   A good practice is too use storage replication to secure VM images. SUSE provide cluster-md and
   DRBD technologiesavailable in the HA products.
  </para>
  <sect2>
   <title>Cluster-MD</title>
   <para>
    The Cluster MD provides support for use of RAID1 across a cluster environment. The disks or
    devices used by Cluster MD are accessed by each node. If one device of the Cluster MD fails,
    it can be replaced at runtime by another device and it is re-synced to provide the same amount
    of redundancy (<link xlink:href="https://documentation.suse.com/fr-fr/sle-ha/15-GA/html/SLE-HA-all/cha-ha-cluster-md.html#">Cluster-MD</link>).
   </para>
  </sect2>
  <sect2>
   <title>DRBD</title>
   <para>
    The distributed replicated block device (DRBD*) allows you to create a mirror of two block
    devices that are located at two different sites across an IP network
    (<link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/single-html/SLE-HA-nfs-quick/#art-sleha-nfs-quick">NFS and DRBD</link>).
   </para>
  </sect2>
  <sect2>
   <title>System Snapshot</title>
   <para>
    The qcow2 and qed formats provide a way to create a base image (also called backing file) and
    overlay images on top of the base image. A backing file is useful to be able to revert to a
    known state and discard the overlay (<link xlink:href="https://documentation.suse.com/sles/15-SP2/single-html/SLES-vt-best-practices/#sec-vt-best-img-overlay">Backing and Overlay</link>).
   </para>
  </sect2>
  <!--
      recover to any other host
      run workloads on unused hardware
      easily copy data to other sites
  -->
 </sect1>
 <sect1>
  <title>Dynamic Load Balancing</title>
  <para>
   Migration is a process to move a running virtual machine to another
   physical machine. Live migration is an extended feature that allows
   this move without disconnection of the client or the application.
   You can use Live migration to provide a simple way to load-balance your
   services across your infrastructure, by moving VMs from
   busy hosts to those with spare capacity, on demand.
  </para>
  <para>
   The cluster resource manager in the High Availability Extension can
   recognize, monitor, and manage services running within virtual servers
   and services running in physical servers. Guest systems can be managed
   as services by the cluster (<link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/single-html/SLE-HA-guide/#sec-ha-features-virtualized">CRM for virtual servers</link>).
  </para>
 </sect1>
</chapter>
