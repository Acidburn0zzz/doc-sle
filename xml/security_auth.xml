<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="cha.security.auth">
 <title>Authentication Server</title>

 <abstract>
  <para>
   The Authentication Server is based on LDAP and optionally Kerberos.
   You can configure it with a &yast; wizard.
  </para>
  <para>
   For more information about LDAP, see <xref
   linkend="cha.security.ldap"/>, and about Kerberos, see <xref
   linkend="cha.security.kerberos"/>.
  </para>
 </abstract>
 <!-- ============================================================ -->
 <sect1 id="sec.security.auth.yast"><!-- os="sles">-->
 <title>Configuring an Authentication Server with &yast;</title>
  <para>
   To set up an authentication server for user account data, make sure
   the <systemitem>yast2-auth-server</systemitem>,
   <systemitem>openldap2</systemitem>,
   <systemitem>krb5-server</systemitem>, and
   <systemitem>krb5-client</systemitem> packages are installed; &yast;
   will remind you and install them if one of these packages is
   missing.  For Kerberos support, the
   <systemitem>krb5-plugin-kdb-ldap</systemitem> package is required.
  </para>
  <para>
   The first part of the Authentication Server configuration with &yast;
   is setting up an LDAP server, then Kerberos enablement follows:
  </para>
  <procedure>
   <title>Authentication Server Configuration with &yast;</title>
   <step>
    <para>
     Start &yast; as &rootuser; and select <menuchoice> <guimenu>Network
     Services</guimenu> <guimenu>Authentication Server</guimenu>
     </menuchoice> to invoke the configuration wizard.
    </para>
   </step>
   <step>
    <para>
     Configure the <guimenu>Global Settings</guimenu> of your LDAP server
     (you can change these settings later)&mdash;see
     <xref linkend="fig.auth.y2.wizard.general.settings"/>:
    </para>
    <figure id="fig.auth.y2.wizard.general.settings">
     <title>&yast; Authentication Server Configuration</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_auth_wizard_general_settings.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_auth_wizard_general_settings.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <substeps>
     <step>
      <para>
       Set LDAP to be started.
      </para>
     </step>
     <step>
      <para>
       If the LDAP server should announce its services via SLP, check
       <guimenu>Register at an SLP Daemon</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Configure <guimenu>Firewall Settings</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Click <guimenu>Next</guimenu>.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
1     Select the server type: <guimenu>Stand-alone server</guimenu>,
     <guimenu>Master server in a replication setup</guimenu>, or
     <guimenu>Replica (slave) server</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Select security options (<guimenu>TLS Settings</guimenu>).
    </para>
    <para>
     It is strongly recommended to <guimenu>Enable TLS</guimenu>. For more
     information, see <xref linkend="step.auth.server.config.tls"/>.
    </para>
    <warning>
     <title>Password Encryption</title>
     <para>
      Enabling TLS ensures passwords are sent encrypted over the network.
      When this option is not enabled, passwords are sent unencrypted.
     </para>
    </warning>
    <para>
     Also consider to use LDAP over SSL and certificates.
    </para>
    <!-- FIXME
    2014-07-30, ke: more on "Launch CA management..." button?
    -->
   </step>
   <step>
    <para>
     Confirm <guimenu>Basic Database Settings</guimenu> with entering an
     <guimenu>LDAP Administrator Password</guimenu> and then clicking
     <guimenu>Next</guimenu>&mdash;see
     <xref
      linkend="fig.auth.y2.wizard.db.settings"/>.
    </para>

    <figure id="fig.auth.y2.wizard.db.settings">
     <title>&yast; LDAP Server&mdash;New Database</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_auth_wizard_db_settings.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_auth_wizard_db_settings.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>

   </step>

   <step>
    <para>
     In the <guimenu>Kerberos Authentication</guimenu> dialog decide
     whether to enable Kerberos authentication or not (you can change
     these settings later)&mdash;see <xref
     linkend="fig.auth.y2.wizard.kerberos.yes"/>.
    </para>
    <figure id="fig.auth.y2.wizard.kerberos.yes">
     <title>&yast; Kerberos Authentication</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_auth_wizard_kerberos_yes.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_auth_wizard_kerberos_yes.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Choose whether Kerberos support is needed or not.  If you enable
     it, also specify your <guimenu>Realm</guimenu>.  Then confirm with
     <guimenu>Next</guimenu>.
    </para>
    <substeps>
     <step>
      <para>
       The <guimenu>Advanced Configuration</guimenu> allows you to
       specify various aspects such as <guimenu>Maximum ticket life
       time</guimenu> or ports to use.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Finally, check the <guimenu>Authentication Server Configuration
     Summary</guimenu> and click <guimenu>Finish</guimenu> to exit the
     configuration wizard.
    </para>
   </step>
  </procedure>
 </sect1>
 <!-- ============================================================ -->
 <sect1 id="sec.security.auth.yast.edit"><!-- os="sles">-->
 <title>Editing an Authentication Server Configuration with &yast;</title>
  <para>
   For changes or additional configuration start the Authentication
   Server module again and in the left pane expand <guimenu>Global
   Settings</guimenu> to make subentries visible&mdash;see <xref
   linkend="fig.auth.y2.server.cfg"/>:
  </para>
  <figure id="fig.auth.y2.server.cfg">
   <title>&yast; Editing Authentication Server Configuration</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_auth_server_cfg.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_auth_server_cfg.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure>
   <title>Editing Authentication Server Configuration</title>
   <step>
    <para>
     With <guimenu>Log Level Settings</guimenu>, configure the degree of
     logging activity (verbosity) of the LDAP server. From the predefined
     list, select or deselect the logging options according to your needs.
     The more options are enabled, the larger your log files grow.
    </para>
   </step>
   <step>
    <para>
     Configure which connection types the server should offer under
     <guimenu>Allow/Disallow Features</guimenu>. Choose from:
    </para>
    <variablelist>
     <varlistentry>
      <term>LDAPv2 Bind Requests</term>
      <listitem>
       <para>
        This option enables connection requests (bind requests) from clients
        using the previous version of the protocol (LDAPv2).
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Anonymous Bind When Credentials Not Empty</term>
      <listitem>
       <para>
        Normally the LDAP server denies any authentication attempts with
        empty credentials (DN or password). Enabling this option, however,
        makes it possible to connect with a password and no DN to establish
        an anonymous connection.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Unauthenticated Bind When DN Not Empty</term>
      <listitem>
       <para>
        Enabling this option makes it possible to connect without
        authentication (anonymously) using a DN but no password.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Unauthenticated Update Options to Process</term>
      <listitem>
       <para>
        Enabling this option allows non-authenticated (anonymous) update
        operations. Access is restricted according to ACLs and other rules.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     <guimenu>Allow/Disallow Features</guimenu> also lets you configure the
     server flags. Choose from:
    </para>
    <variablelist>
     <varlistentry>
      <term>Disable Acceptance of Anonymous Bind Requests</term>
      <listitem>
       <para>
        The server will no longer accept anonymous bind requests. Note, that
        this does not generally prohibit anonymous directory access.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Disable Simple Bind Authentication</term>
      <listitem>
       <para>
        Completely disable Simple Bind authentication.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Disable Forcing Session to Anonymous Status upon StartTLS Operation Receipt</term>
      <listitem>
       <para>
        The server will no longer force an authenticated connection back to
        the anonymous state when receiving the StartTLS operation.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Disallow the StartTLS Operation if Authenticated</term>
      <listitem>
       <para>
        The server will disallow the StartTLS operation on already
        authenticated connections.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step id="step.auth.server.config.tls">
    <para>
     To configure secure communication between client and server, proceed
     with <guimenu>TLS Settings</guimenu>:
    </para>
    <substeps>
     <step>
      <para>
       Activate <guimenu>Enable TLS</guimenu> to enable TLS and SSL
       encryption of the client/server communication.
      </para>
     </step>
     <step>
      <para>
       Either <guimenu>Import Certificate</guimenu> by specifying the exact
       path to its location or enable the <guimenu>Use Common Server
       Certificate</guimenu>. If the <guimenu>Use Common Server
       Certificate</guimenu> is not available because it has not been
       created during installation, go for <guimenu>Launch CA Management
       Module</guimenu> first&mdash; for more information, see
       <xref linkend="sec.security.yast_ca.module"/>.
      </para>
<!--
      <itemizedlist>
       <listitem>
	<para>If you opted for importing a certificate, &yast; prompts you
	 to specify the exact path to its location.</para>
       </listitem>
       <listitem>
	<para>If you opted for using the common server certificate and it has
	 not been created during installation, it is subsequently created.
	</para>
       </listitem>
      </itemizedlist>
      -->
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
<!-- bnc#431264 -->
<!-- Accept or modify the schema files included in the server's
     configuration by selecting <guimenu>Schema Files</guimenu> in
     the left part of the dialog.
     -->
   Add Schema files to be included in the server's configuration by
   selecting <guimenu>Schema Files</guimenu> in the left part of the dialog.
   The default selection of schema files applies to the server providing a
   source of &yast; user account data.
  </para>

  <para>
   &yast; allows to add traditional Schema files (usually with a name ending
   in <literal>.schema</literal>) or LDIF files containing Schema
   definitions in OpenLDAP's LDIF Schema format.
  </para>

  <figure
   id="fig.auth.y2.server.db.cfg">
   <title>&yast; Authentication Server Database Configuration</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_auth_server_db_cfg.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_auth_server_db_cfg.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   To configure the databases managed by your LDAP server, proceed as
   follows:
  </para>

  <procedure>
   <step>
    <para>
     Select the <guimenu>Databases</guimenu> item in the left part of the
     dialog.
    </para>
   </step>
   <step>
    <para>
     Click <guimenu>Add Database</guimenu> to add a new database.
    </para>
   </step>
   <step>
    <para>
     Enter the requested data:
    </para>
    <variablelist>
     <varlistentry>
      <term><guimenu>Base DN</guimenu>
      </term>
      <listitem>
       <para>
        Enter the base DN of your LDAP server.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Administrator DN</guimenu>
      </term>
      <listitem>
       <para>
        Enter the DN of the administrator in charge of the server. If you
        check <guimenu>Append Base DN</guimenu>, only provide the
        <literal>cn</literal> of the administrator and the system fills in
        the rest automatically.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>LDAP Administrator Password</term>
      <listitem>
       <para>
        Enter the password for the database administrator.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Use This Database as the Default for OpenLDAP Clients</term>
      <listitem>
       <para>
        For convenience, check this option if wanted.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     In the next dialog configure replication settings.
    </para>
   </step>
<!--
     <varlistentry>
      <term>Encryption</term>
      <listitem>
       <para>
	Determine the encryption algorithm to use to secure the password of
	Root DN.       
 Choose <guimenu>Crypt</guimenu>,
	<guimenu>smd5</guimenu>, <guimenu>ssha</guimenu>, or
	<guimenu>sha</guimenu>. 
	The dialog also includes a <guimenu>Plain</guimenu> option to
	enable the use of plain text passwords, but enabling this is not
	recommended for security reasons. To confirm your settings and return
	to the previous dialog, select <guimenu>OK</guimenu>.
       </para>
      </listitem>
     </varlistentry>
-->
   <step>
    <para>
     In the next dialog, enable enforcement of password policies to provide
     extra security to your LDAP server:
    </para>
    <substeps>
     <step>
      <para>
       Check <guimenu>Enable Password Policies</guimenu> to be able to
       specify a password policy.
      </para>
     </step>
     <step>
      <para>
       Activate <guimenu>Hash Clear Text Passwords</guimenu> to have clear
       text passwords be hashed before they are written to the database
       whenever they are added or modified.
      </para>
     </step>
     <step>
      <para>
       <guimenu>Disclose "Account Locked" Status</guimenu> provides a
       relevant error message for bind requests to locked accounts.
      </para>
      <warning>
       <title>Locked Accounts in Security Sensitive Environments</title>
       <para>
        Do not use the <guimenu>Disclose "Account Locked" Status</guimenu>
        option if your environment is sensitive to security issues, because
        the <quote>Locked Account</quote> error message provides
        security-sensitive information that can be exploited by a potential
        attacker.
       </para>
      </warning>
     </step>
     <step>
      <para>
       Enter the DN of the default policy object. To use a DN other than the
       one suggested by &yast;, enter your choice. Otherwise, accept the
       default settings.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Complete the database configuration by clicking
     <guimenu>Finish</guimenu>.
    </para>
   </step>
  </procedure>

  <para>
   If you have not opted for password policies, your server is ready to run
   at this point. If you have chosen to enable password policies, proceed
   with the configuration of the password policy in detail. If you have
   chosen a password policy object that does not yet exist, &yast; creates
   one:
  </para>

  <procedure>
   <step>
    <para>
     Enter the LDAP server password. In the navigation tree below
     <guimenu>Databases</guimenu> expand your database object and activate
     the <guimenu>Password Policy Configuration</guimenu> item.
    </para>
   </step>
   <step>
    <para>
     Make sure <guimenu>Enable Password Policies</guimenu> is activated.
     Then click <guimenu>Edit Policy</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Configure the password change policies:
    </para>
    <substeps>
     <step>
      <para>
       Determine the number of passwords stored in the password history.
       Saved passwords may not be reused by the user.
      </para>
     </step>
     <step>
      <para>
       Determine if users will be able to change their passwords and if they
       will need to change their passwords after a reset by the
       administrator. Require the old password for password changes
       (optional).
      </para>
     </step>
     <step>
      <para>
       Determine whether and to what extent passwords should be subject to
       quality checking. Set the minimum password length that must be met
       before a password is valid. If you select <guimenu>Accept Uncheckable
       Passwords</guimenu>, users are allowed to use encrypted passwords,
       even though the quality checks cannot be performed. If you opt for
       <guimenu>Only Accept Checked Passwords</guimenu> only those passwords
       that pass the quality tests are accepted as valid.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Configure the password time-limit policies:
    </para>
    <substeps>
     <step>
      <para>
       Determine the minimum password time-limit (the time that needs to
       pass between two valid password changes) and the maximum password
       time-limit.
      </para>
     </step>
     <step>
      <para>
       Determine the time between a password expiration warning and the
       actual password expiration.
      </para>
     </step>
     <step>
      <para>
       Set the number of postponement uses of an expired password before the
       password expires permanently.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Configure the lockout policies:
    </para>
    <substeps>
     <step>
      <para>
       Enable password locking.
      </para>
     </step>
     <step>
      <para>
       Determine the number of bind failures that trigger a password lock.
      </para>
     </step>
     <step>
      <para>
       Determine the duration of the password lock.
      </para>
     </step>
     <step>
      <para>
       Determine the length of time that password failures are kept in the
       cache before they are purged.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Apply your password policy settings with <guimenu>OK</guimenu>.
    </para>
   </step>
  </procedure>

  <para>
   To edit a previously created database, select its base DN in the tree to
   the left. In the right part of the window, &yast; displays a dialog
   similar to the one used for the creation of a new database (with the main
   difference that the base DN entry is grayed out and cannot be changed).
  </para>
 <para>
   After leaving the Authentication Server configuration by selecting
   <guimenu>Finish</guimenu>, you are ready to go with a basic working
   configuration for your Authentication Server. To fine-tune this
   setup, make use of OpenLDAP's dynamic configuration back-end.
  </para>

  <para>
<!-- bnc#754946 -->
   The OpenLDAP's dynamic configuration back-end stores the
   configuration in an LDAP database. That database consists of a set of
   <literal>.ldif</literal> files in
   <filename>/etc/openldap/slapd.d</filename>. There is no need to
   access these files directly. To access the settings you can either
   use the &yast; Authentication Server module (the
   <systemitem>yast2-auth-server</systemitem> package) or an LDAP client
   such as <command>ldapmodify</command> or
   <command>ldapsearch</command>. For more information on the dynamic
   configuration of OpenLDAP, see the OpenLDAP Administration Guide.
  </para>
 </sect1>
 <!-- ============================================================ -->
 <sect1
  id="sec.security.auth.yast.client">
  <title>Configuring an Authentication Client with &yast;</title>
  <!-- idx -->
  <indexterm>

  <primary>LDAP</primary>

  <secondary>&yast;</secondary>

  <tertiary>client</tertiary></indexterm><indexterm>

  <primary>&yast;</primary>

  <secondary>LDAP</secondary>

  <tertiary>clients</tertiary></indexterm><indexterm>

  <primary>LDAP</primary>

  <secondary>&yast;</secondary>

  <tertiary>modules</tertiary></indexterm><indexterm>

  <primary>LDAP</primary>

  <secondary>&yast;</secondary>

  <tertiary>templates</tertiary></indexterm>

  <para>
   &yast; includes a module to set up LDAP-based user management. If you
   did not enable this feature during the installation, start the module
   by selecting <menuchoice> <guimenu>Network Services</guimenu>
   <guimenu>Authentication Client</guimenu> </menuchoice>. &yast;
   automatically enables any PAM and NSS-related changes as required by
   LDAP and installs the necessary files.  Connect your client to
   the server and let &yast; manage users over LDAP. This basic setup is
   described in <xref linkend="sec.security.auth.yast.client.conf.basic"
   />.
  </para>

  <para>
   Use the &yast; Authentication client to further configure the &yast;
   group and user configuration modules. This includes manipulating the
   default settings for new users and groups and the number and nature
   of the attributes assigned to a user or group. LDAP user management
   allows you to assign far more and different attributes to users and
   groups than traditional user or group management solutions. This is
   described in <xref linkend="sec.security.ldap.yast.client.conf.mod"
   />.
  </para>

  <sect2 id="sec.security.auth.yast.client.conf.basic">
   <title>Configuring Basic Settings</title>
   <para>
    The basic LDAP client configuration dialog
    (<xref linkend="fig.ldap.y2.clconf"/>) opens during installation if you
    choose LDAP user management or when you select <menuchoice>
    <guimenu>Network Services</guimenu> <guimenu>LDAP Client</guimenu>
    </menuchoice> in the &yast; Control Center in the installed system.
   </para>
   <figure id="fig.ldap.y2.clconf">
    <title>&yast;: LDAP Client Configuration</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ldap_y2_clconf.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ldap_y2_clconf.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <para>
     To authenticate users of your machine against an OpenLDAP server and to
     enable user management via OpenLDAP, proceed as follows:
    </para>
    <step>
     <para>
      Click <guimenu>Use LDAP</guimenu> to enable the use of LDAP. Select
      <guimenu>Use LDAP but Disable Logins</guimenu> instead if you want to
      use LDAP for authentication, but do not want other users to log in to
      this client.
     </para>
    </step>
    <step>
     <para>
      Enter the IP address of the LDAP server to use.
     </para>
    </step>
    <step>
     <para>
      Enter the <guimenu>LDAP Base DN</guimenu> to select the search base on
      the LDAP server. To retrieve the base DN automatically, click
      <guimenu>Fetch DN</guimenu>. &yast; then checks for any LDAP database
      on the server address specified above. Choose the appropriate base DN
      from the search results given by &yast;.
     </para>
    </step>
    <step>
     <para>
      If TLS or SSL-protected communication with the server is required,
      select <guimenu>LDAP TLS/SSL</guimenu>. Click <guimenu>Download CA
      Certificate</guimenu> to download a certificate in PEM format from a
      URL.
     </para>
    </step>
    <step>
     <para>
      Select <guimenu>Start Automounter</guimenu> to mount remote
      directories on your client, such as a remotely managed
      <filename>/home</filename>.
     </para>
    </step>
    <step>
     <para>
      Select <guimenu>Create Home Directory on Login</guimenu> to have a
      user's home automatically created on the first user login.
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>OK</guimenu> to apply your settings.
     </para>
    </step>
   </procedure>
   <para>
    To modify data on the server as administrator, click <guimenu>Advanced
    Configuration</guimenu>. The following dialog is split into two tabs.
    See <xref
     linkend="fig.ldap.y2.adconf"/>.
   </para>
   <figure id="fig.ldap.y2.adconf">
    <title>&yast;: Advanced Configuration</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ldap_y2_adconf.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ldap_y2_adconf.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <step>
     <para>
      In the <guimenu>Client Settings</guimenu> tab, adjust the following
      settings according to your needs:
     </para>
     <substeps>
      <step>
       <para>
        If the search base for users, passwords, and groups differs from the
        global search base specified in the <guimenu>LDAP base DN</guimenu>,
        enter these different naming contexts in <guimenu>User
        Map</guimenu>, <guimenu>Password Map</guimenu>, and <guimenu>Group
        Map</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Specify the password change protocol. The standard method to use
        whenever a password is changed is <systemitem>crypt</systemitem>,
        meaning that password hashes generated by <command>crypt</command>
        are used. For details on this and other options, refer to the
        <systemitem>pam_ldap</systemitem> man page.
       </para>
      </step>
      <step>
       <para>
        Specify the LDAP group to use with <guimenu>Group Member
        Attribute</guimenu>. The default value for this is
        <literal>member</literal>.
       </para>
      </step>
      <step>
       <para>
        If a secure connection requires certificate checking, specify where
        your <guimenu>CA Certificate File</guimenu> in PEM format is
        located. Or specify a directory with certificates.
       </para>
      </step>
      <step>
       <para>
        If the LDAP server still uses LDAPv2, enable the use of this
        protocol version by selecting <guimenu>LDAP Version 2</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      In <guimenu>Administration Settings</guimenu>, adjust the following
      settings:
     </para>
     <substeps>
      <step>
       <para>
        Set the base for storing your user management data via
        <guimenu>Configuration Base DN</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Enter the appropriate value for <guimenu>Administrator DN</guimenu>.
        This DN must be identical with the <literal>rootdn</literal> value
        specified in <filename>/etc/openldap/slapd.conf</filename> to enable
        this particular user to manipulate data stored on the LDAP server.
        Enter the full DN (such as
        <literal>cn=Administrator,dc=example,dc=com</literal>) or activate
        <guimenu>Append Base DN</guimenu> to have the base DN added
        automatically when you enter <literal>cn=Administrator</literal>.
       </para>
      </step>
      <step>
       <para>
        Check <guimenu>Create Default Configuration Objects</guimenu> to
        create the basic configuration objects on the server to enable user
        management via LDAP.
       </para>
      </step>
      <step>
       <para>
        If your client machine needs to act as a file server for home
        directories across your network, check <guimenu>Home Directories on
        This Machine</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Use the <guimenu>Password Policy</guimenu> section to select, add,
        delete, or modify the password policy settings to use. The
        configuration of password policies with &yast; is part of the LDAP
        server setup.
       </para>
      </step>
      <step>
       <para>
        Click <guimenu>OK</guimenu> to leave the <guimenu>Advanced
        Configuration</guimenu>, then <guimenu>Finish</guimenu> to apply
        your settings.
       </para>
      </step>
     </substeps>
    </step>
   </procedure>
   <para>
    Use <guimenu>Configure User Management Settings</guimenu> to edit
    entries on the LDAP server. Access to the configuration modules on the
    server is then granted according to the ACLs and ACIs stored on the
    server. Follow the procedures outlined in
    <xref
     linkend="sec.security.ldap.yast.client.conf.mod"/>.
   </para>
  </sect2>

  <sect2 id="sec.security.ldap.yast.client.conf.mod">
   <title>Configuring the &yast; Group and User Administration Modules</title>
   <para>
    Use the &yast; LDAP client to adapt the &yast; modules for user and
    group administration and to extend them as needed. Define templates with
    default values for the individual attributes to simplify the data
    registration. The presets created here are stored as LDAP objects in the
    LDAP directory. The registration of user data is still done with the
    regular &yast; modules for user and group management. The registered
    data is stored as LDAP objects on the server.
   </para>
   <figure id="fig.ldap.y2.modconf1">
    <title>&yast;: Module Configuration</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ldap_y2_modconf1.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ldap_y2_modconf1.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    The dialog for module configuration
    (<xref linkend="fig.ldap.y2.modconf1"/>) allows the creation of new
    modules, selection and modification of existing configuration modules,
    and design and modification of templates for such modules.
   </para>
   <procedure>
    <para>
     To create a new configuration module, proceed as follows:
    </para>
    <step>
     <para>
      In the <guimenu>LDAP Client Configuration</guimenu> click
      <guimenu>Advanced Configuration</guimenu>, then open the
      <guimenu>Administration Settings</guimenu> tab. Click
      <guimenu>Configure User Management Settings</guimenu> and enter the
      LDAP server credentials.
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>New</guimenu> and select the type of module to create.
      For a user configuration module, select
      <literal>suseUserConfiguration</literal> and for a group configuration
      choose <literal>suseGroupConfiguration</literal>.
     </para>
    </step>
    <step>
     <para>
      Choose a name for the new template (e.g.,
      <literal>userConfig</literal>). The content view shows a table listing
      all attributes allowed in this module and their assigned values.
     </para>
    </step>
    <step>
     <para>
      Accept the preset values or adjust the defaults to use in group and
      user configurations by selecting the relevant attribute, pressing
      <guimenu>Edit</guimenu>, and entering the new value. Rename a module
      by changing the <systemitem>cn</systemitem> attribute of the module.
      Clicking <guimenu>Delete</guimenu> deletes the currently selected
      module.
     </para>
    </step>
    <step>
     <para>
      After you click <guimenu>OK</guimenu>, the new module is added to the
      selection menu.
     </para>
    </step>
   </procedure>
   <procedure>
    <para>
     The &yast; modules for group and user administration embed templates
     with standard values. To edit a template associated with a
     configuration module, start the object template configuration
     (<xref linkend="fig.ldap.y2.objtemp"/>).
    </para>
    <step>
     <para>
      In the <guimenu>Module Configuration</guimenu> dialog, click
      <guimenu>Configure Template</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Determine the values of the general attributes assigned to this
      template according to your needs or leave them empty. Empty attributes
      are deleted on the LDAP server.
     </para>
    </step>
    <step>
     <para>
      Modify, delete, or add new default values for new objects (user or
      group configuration objects in the LDAP tree).
     </para>
    </step>
   </procedure>
   <figure id="fig.ldap.y2.objtemp">
    <title>&yast;: Configuration of an Object Template</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ldap_y2_objtemp.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ldap_y2_objtemp.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Connect the template to its module by setting the
    <literal>susedefaulttemplate</literal> attribute value of the module to
    the DN of the adapted template.
   </para>
   <tip>
    <para>
     The default values for an attribute can be created from other
     attributes by using a variable instead of an absolute value. For
     example, when creating a new user, <literal>cn=%sn %givenName</literal>
     is created automatically from the attribute values for
     <literal>sn</literal> and <literal>givenName</literal>.
    </para>
   </tip>
   <para>
    Once all modules and templates are configured correctly and ready to
    run, new groups and users can be registered in the usual way with
    &yast;.
   </para>
  </sect2>
 </sect1>

</chapter>
