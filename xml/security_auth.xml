<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="cha.security.auth">
 <title>Authentication Server</title>

 <abstract>
  <para>
   The Authentication Server is based on LDAP and optionally Kerberos.
   You can configure it with a &yast; wizard.
  </para>
  <para>
   For more information about LDAP, see <xref
   linkend="cha.security.ldap"/>, and about Kerberos, see <xref
   linkend="cha.security.kerberos"/>.
  </para>
 </abstract>
 <!-- ============================================================ -->
 <sect1 id="sec.security.auth.yast"><!-- os="sles">-->
 <title>Configuring an Authentication Server with &yast;</title>
  <para>
   To set up an authentication server for user account data, make sure
   the <systemitem>yast2-auth-server</systemitem>,
   <systemitem>openldap2</systemitem>,
   <systemitem>krb5-server</systemitem>, and
   <systemitem>krb5-client</systemitem> packages are installed; &yast;
   will remind you and install them if one of these packages is
   missing.  For Kerberos support, the
   <systemitem>krb5-plugin-kdb-ldap</systemitem> package is required.
  </para>
  <para>
   The first part of the Authentication Server configuration with &yast;
   is setting up an LDAP server, then Kerberos enablement follows:
  </para>
  <procedure>
   <title>Authentication Server Configuration with &yast;</title>
   <step>
    <para>
     Start &yast; as &rootuser; and select <menuchoice> <guimenu>Network
     Services</guimenu> <guimenu>Authentication Server</guimenu>
     </menuchoice> to invoke the configuration wizard.
    </para>
   </step>
   <step>
    <para>
     Configure the <guimenu>Global Settings</guimenu> of your LDAP server
     (you can change these settings later)&mdash;see
     <xref linkend="fig.auth.y2.wizard.general.settings"/>:
    </para>
    <figure id="fig.auth.y2.wizard.general.settings">
     <title>&yast; Authentication Server Configuration</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_auth_wizard_general_settings.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_auth_wizard_general_settings.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <substeps>
     <step>
      <para>
       Set LDAP to be started.
      </para>
     </step>
     <step>
      <para>
       If the LDAP server should announce its services via SLP, check
       <guimenu>Register at an SLP Daemon</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Configure <guimenu>Firewall Settings</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Click <guimenu>Next</guimenu>.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
1     Select the server type: <guimenu>Stand-alone server</guimenu>,
     <guimenu>Master server in a replication setup</guimenu>, or
     <guimenu>Replica (slave) server</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Select security options (<guimenu>TLS Settings</guimenu>).
    </para>
    <para>
     It is strongly recommended to <guimenu>Enable TLS</guimenu>. For more
     information, see <xref linkend="step.auth.server.config.tls"/>.
    </para>
    <warning>
     <title>Password Encryption</title>
     <para>
      Enabling TLS ensures passwords are sent encrypted over the network.
      When this option is not enabled, passwords are sent unencrypted.
     </para>
    </warning>
    <para>
     Also consider to use LDAP over SSL and certificates.
    </para>
    <!-- FIXME
    2014-07-30, ke: more on "Launch CA management..." button?
    -->
   </step>
   <step>
    <para>
     Confirm <guimenu>Basic Database Settings</guimenu> with entering an
     <guimenu>LDAP Administrator Password</guimenu> and then clicking
     <guimenu>Next</guimenu>&mdash;see
     <xref
      linkend="fig.auth.y2.wizard.db.settings"/>.
    </para>

    <figure id="fig.auth.y2.wizard.db.settings">
     <title>&yast; LDAP Server&mdash;New Database</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_auth_wizard_db_settings.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_auth_wizard_db_settings.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>

   </step>

   <step>
    <para>
     In the <guimenu>Kerberos Authentication</guimenu> dialog decide
     whether to enable Kerberos authentication or not (you can change
     these settings later)&mdash;see <xref
     linkend="fig.auth.y2.wizard.kerberos.yes"/>.
    </para>
    <figure id="fig.auth.y2.wizard.kerberos.yes">
     <title>&yast; Kerberos Authentication</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_auth_wizard_kerberos_yes.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_auth_wizard_kerberos_yes.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Choose whether Kerberos support is needed or not.  If you enable
     it, also specify your <guimenu>Realm</guimenu>.  Then confirm with
     <guimenu>Next</guimenu>.
    </para>
    <substeps>
     <step>
      <para>
       The <guimenu>Advanced Configuration</guimenu> allows you to
       specify various aspects such as <guimenu>Maximum ticket life
       time</guimenu> or ports to use.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Finally, check the <guimenu>Authentication Server Configuration
     Summary</guimenu> and click <guimenu>Finish</guimenu> to exit the
     configuration wizard.
    </para>
   </step>
  </procedure>
 </sect1>
 <!-- ============================================================ -->
 <sect1 id="sec.security.auth.yast.edit"><!-- os="sles">-->
 <title>Editing an Authentication Server Configuration with &yast;</title>
  <para>
   For changes or additional configuration start the Authentication
   Server module again and in the left pane expand <guimenu>Global
   Settings</guimenu> to make subentries visible&mdash;see <xref
   linkend="fig.auth.y2.server.cfg"/>:
  </para>
  <figure id="fig.auth.y2.server.cfg">
   <title>&yast; Editing Authentication Server Configuration</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_auth_server_cfg.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_auth_server_cfg.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure>
   <title>Editing Authentication Server Configuration</title>
   <step>
    <para>
     With <guimenu>Log Level Settings</guimenu>, configure the degree of
     logging activity (verbosity) of the LDAP server. From the predefined
     list, select or deselect the logging options according to your needs.
     The more options are enabled, the larger your log files grow.
    </para>
   </step>
   <step>
    <para>
     Configure which connection types the server should offer under
     <guimenu>Allow/Disallow Features</guimenu>. Choose from:
    </para>
    <variablelist>
     <varlistentry>
      <term>LDAPv2 Bind Requests</term>
      <listitem>
       <para>
        This option enables connection requests (bind requests) from clients
        using the previous version of the protocol (LDAPv2).
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Anonymous Bind When Credentials Not Empty</term>
      <listitem>
       <para>
        Normally the LDAP server denies any authentication attempts with
        empty credentials (DN or password). Enabling this option, however,
        makes it possible to connect with a password and no DN to establish
        an anonymous connection.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Unauthenticated Bind When DN Not Empty</term>
      <listitem>
       <para>
        Enabling this option makes it possible to connect without
        authentication (anonymously) using a DN but no password.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Unauthenticated Update Options to Process</term>
      <listitem>
       <para>
        Enabling this option allows non-authenticated (anonymous) update
        operations. Access is restricted according to ACLs and other rules.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     <guimenu>Allow/Disallow Features</guimenu> also lets you configure the
     server flags. Choose from:
    </para>
    <variablelist>
     <varlistentry>
      <term>Disable Acceptance of Anonymous Bind Requests</term>
      <listitem>
       <para>
        The server will no longer accept anonymous bind requests. Note, that
        this does not generally prohibit anonymous directory access.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Disable Simple Bind Authentication</term>
      <listitem>
       <para>
        Completely disable Simple Bind authentication.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Disable Forcing Session to Anonymous Status upon StartTLS Operation Receipt</term>
      <listitem>
       <para>
        The server will no longer force an authenticated connection back to
        the anonymous state when receiving the StartTLS operation.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Disallow the StartTLS Operation if Authenticated</term>
      <listitem>
       <para>
        The server will disallow the StartTLS operation on already
        authenticated connections.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step id="step.auth.server.config.tls">
    <para>
     To configure secure communication between client and server, proceed
     with <guimenu>TLS Settings</guimenu>:
    </para>
    <substeps>
     <step>
      <para>
       Activate <guimenu>Enable TLS</guimenu> to enable TLS and SSL
       encryption of the client/server communication.
      </para>
     </step>
     <step>
      <para>
       Either <guimenu>Import Certificate</guimenu> by specifying the exact
       path to its location or enable the <guimenu>Use Common Server
       Certificate</guimenu>. If the <guimenu>Use Common Server
       Certificate</guimenu> is not available because it has not been
       created during installation, go for <guimenu>Launch CA Management
       Module</guimenu> first&mdash; for more information, see
       <xref linkend="sec.security.yast_ca.module"/>.
      </para>
<!--
      <itemizedlist>
       <listitem>
	<para>If you opted for importing a certificate, &yast; prompts you
	 to specify the exact path to its location.</para>
       </listitem>
       <listitem>
	<para>If you opted for using the common server certificate and it has
	 not been created during installation, it is subsequently created.
	</para>
       </listitem>
      </itemizedlist>
      -->
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
<!-- bnc#431264 -->
<!-- Accept or modify the schema files included in the server's
     configuration by selecting <guimenu>Schema Files</guimenu> in
     the left part of the dialog.
     -->
   Add Schema files to be included in the server's configuration by
   selecting <guimenu>Schema Files</guimenu> in the left part of the dialog.
   The default selection of schema files applies to the server providing a
   source of &yast; user account data.
  </para>

  <para>
   &yast; allows to add traditional Schema files (usually with a name ending
   in <literal>.schema</literal>) or LDIF files containing Schema
   definitions in OpenLDAP's LDIF Schema format.
  </para>

 </sect1>

</chapter>
