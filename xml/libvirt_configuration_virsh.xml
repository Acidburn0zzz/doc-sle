<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>

<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="cha.libvirt.config_virsh">
 <title>Configuring Virtual Machines with virsh</title>
 <info>
  <abstract>
   <para>
    Introduction to virsh.
    TBD.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
  </dm:docmanager>
 </info>
 <para/>

 <sect1 xml:id="sec.libvirt.config.machinetype.virsh">
  <title>Changing the Machine Type with <command>virsh</command></title>

  <para>
   By default, when installing with the <command>virt-install</command> tool, the machine type for &vmguest; is
   <emphasis>pc-i440fx</emphasis>. The machine type is stored in the
   &vmguest;'s xml configuration file in
   <filename>/etc/libvirt/qemu/</filename> in the tag <tag>type</tag>:
  </para>

<screen>&lt;type arch='x86_64' machine='pc-i440fx-2.3'&gt;hvm&lt;/type&gt;</screen>

  <para>
   As an example, the following procedure shows how to change this value to the
   machine type <literal>q35</literal>. <literal>q35</literal> is an Intel*
   chipset. It includes <xref linkend="gloss.vt.acronym.pcie"/>, supports up to
   12 USB ports, and has support for
   <xref linkend="gloss.vt.acronym.sata"/> and
   <xref linkend="gloss.vt.acronym.iommu"/>. IRQ routing has also
   been improved.
  </para>

  <procedure>
   <step>
    <para>
     Check whether your &vmguest; is inactive:
    </para>
<screen>&prompt.sudo;virsh list --inactive
Id    Name                           State
----------------------------------------------------
-     sles11                         shut off</screen>
   </step>
   <step>
    <para>
     Edit the configuration for this &vmguest;:
    </para>
<screen>&prompt.sudo;virsh edit sles11</screen>
   </step>
   <step>
    <para>
     Change the value of the
     <tag class="attribute">machine</tag>
     attribute:
    </para>
<screen>&lt;type arch='x86_64' machine='pc-q35-2.0'&gt;hvm&lt;/type&gt;</screen>
   </step>
   <step>
    <para>
     Restart the &vmguest;.
    </para>
<screen>&prompt.sudo;<command>virsh start sles11</command></screen>
   </step>
   <step>
    <para>
     Check that the machine type has changed. Log in to the &vmguest; as
     root and run the following command:
    </para>
<screen>&prompt.sudo;<command>dmidecode | grep Product</command>
Product Name: Standard PC (Q35 + ICH9, 2009)</screen>
   </step>
  </procedure>

  <tip>
   <title>Machine Type Update Recommendations</title>
   <para>
    Whenever the &qemu; version on the host system is upgraded (for example,
    when upgrading the &vmhost; to a new service pack), upgrade the machine type
    of the &vmguest;s to the latest
    available version. To check, use the command <command>qemu-system-x86_64 -M
    help</command> on the &vmhost;.
   </para>
   <para>
    The default machine type <literal>pc-i440fx</literal>, for example, is
    regularly updated. If your &vmguest; still runs with a machine type of
    <literal>pc-i440fx-1.<replaceable>X</replaceable></literal>, an update
    to <literal>pc-i440fx-2.<replaceable>X</replaceable></literal> is
    strongly recommended. This allows taking advantage of the most recent
    updates and corrections in machine definitions, and ensures
    better future compatibility.
   </para>
  </tip>
 </sect1>

 
</chapter>
