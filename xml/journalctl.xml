<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="cha.journalctl">
 <title><command>journalctl</command>: Query the &systemd; Journal</title>
 <para>
  When &systemd; replaced traditional init scripts in &sle; 12 (see
  <xref linkend="cha.systemd"/>, it introduced its own logging system called
  <emphasis>journal</emphasis>. There is no need to run a
  <systemitem>syslog</systemitem> based service anymore, as all system
  events are written in the journal.
 </para>
 <para>
  The journal itself is a system service managed by &systemd;. Its full name
  is <literal>systemd-journald.service</literal>. It collects and stores
  logging data by maintaining structured indexed journals based on logging
  information received from the kernel, from user processes, from standard
  input and error of system services. The
  <literal>systemd-journald.service</literal> service is on by default:
 </para>
<screen># systemctl status systemd-journald
systemd-journald.service - Journal Service
   Loaded: loaded (/usr/lib/systemd/system/systemd-journald.service; static)
   Active: active (running) since Mon 2014-05-26 08:36:59 EDT; 3 days ago
     Docs: man:systemd-journald.service(8)
           man:journald.conf(5)
 Main PID: 413 (systemd-journal)
   Status: "Processing requests..."
   CGroup: /system.slice/systemd-journald.service
           └─413 /usr/lib/systemd/systemd-journald
[...]</screen>
<sect1 id="journalctl.persistent">
 <title>Making the Journal Persistent</title>
 <para>
  The journal stores log data in <filename>/run/log/journal/</filename> by
  default. Because the <filename>/run/</filename> directory is temporary by
  nature, log data is lost at reboot. To make the log data persistent, the
  directory <filename>/var/log/journal/</filename> must exist where the
  systemd-journald service stores its data. If it does not exist, create it and
  restart the systemd-journald service:
 </para>
 <screen>mkdir /var/log/journal/ &amp;&amp; systemctl restart systemd-journald</screen>
</sect1>
 <sect1 id="journalctl.filtering">
  <title>Filtering the Journal Output</title>
  <para>
   When called without switches, <command>journalctl</command> shows the full
   content of the journal, the oldest entries listed first. The output can be
   filtered by specific switches and fields.
  </para>
  <sect2 id="journalctl.filtering.boot">
   <title>Filtering Based on Boot Number</title>
   <para>
    <command>journalctl</command> can filter messages based on a specific system
    boot. To list all available boots, run
   </para>
<screen># journalctl --list-boots
-1 097ed2cd99124a2391d2cffab1b566f0 Mon 2014-05-26 08:36:56 EDT—Fri 2014-05-30 05:33:44 EDT
 0 156019a44a774a0bb0148a92df4af81b Fri 2014-05-30 05:34:09 EDT—Fri 2014-05-30 06:15:01 EDT</screen>
<para>
 The first column lists the boot offset &mdash; 0 for the current boot, -1 for the
 previous, -2 for the scond previous etc. The second column contains the boot ID,
 and then the limiting timestamps of the specific boot follow.
</para> 

  <para>
   To show all messages from the current boot, run
   </para>
   <screen># journalctl -b</screen>
   <para>
    If you need to see journal message from the previous boot, add an offset
    parameter. The following example outputs the previous boot messages:
   </para>
   <screen># journalctl -b -1</screen>
   <para>
    Another way is to list boot messages based on the boot ID. For this purpose,
    use the _BOOT_ID field:
   </para>
   <screen># journalctl _BOOT_ID=156019a44a774a0bb0148a92df4af81b</screen>

  </sect2>
  <sect2 id="journalctl.filtering.fields">
   <title>Filtering Based on Fields</title>
    <para>
    You can filter the output of the journal by specific fields. The syntax of a
    fileld to be matched is <literal>FIELD_NAME=MATCHED_VALUE</literal>, such as
    <literal>_SYSTEMD_UNIT=httpd.service</literal>. You can specify multiple
    matches in a single query to filter the output messages event more. See
    <command>man 7 systemd.journal-fields</command> for a list of default
    fields.
   </para>
  </sect2>
 </sect1>
</chapter>
