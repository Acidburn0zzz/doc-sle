<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd" [
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="lvm" lang="en">
  <title>LVM Configuration</title>
  <para>
   This section briefly describes the principles behind Logical Volume
   Manager (LVM) and its basic features that make it useful under many
   circumstances. The &yast; LVM configuration can be reached from the &yast;
   Expert Partitioner. This partitioning tool enables you to edit and delete
   existing partitions and create new ones that should be used with LVM.
  </para>
  <warning>
   <para>
    Using LVM might be associated with increased risk, such as data loss.
    Risks also include application crashes, power failures, and faulty
    commands. Save your data before implementing LVM or reconfiguring
    volumes. Never work without a backup.
   </para>
  </warning>
  <itemizedlist role="subtoc">
   <listitem>
    <para>
     <xref linkend="sec_yast2_system_lvm_explanation" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="bi706ct" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="bgchx8b" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="lvm_activate_vgs" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="brgpqe2" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="brgqpfy" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="biuz4lz" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="brgpmw3" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="brgob84" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="btx9jxu" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
  </itemizedlist>
  <sect1 id="sec_yast2_system_lvm_explanation">
   <title>Understanding the Logical Volume Manager</title>

   <para>
    LVM enables flexible distribution of hard disk space over several file
    systems. It was developed because the need to change the segmentation of
    hard disk space might arise only after the initial partitioning has
    already been done during installation. Because it is difficult to modify
    partitions on a running system, LVM provides a virtual pool (volume
    group or VG) of memory space from which logical volumes (LVs) can be
    created as needed. The operating system accesses these LVs instead of
    the physical partitions. Volume groups can span more than one disk, so
    that several disks or parts of them can constitute one single VG. In
    this way, LVM provides a kind of abstraction from the physical disk
    space that allows its segmentation to be changed in a much easier and
    safer way than through physical repartitioning.
   </para>

   <para role="intro">
    <xref linkend="bo1t1qx" xrefstyle="FigureXRef"/> compares physical
    partitioning (left) with LVM segmentation (right). On the left side, one
    single disk has been divided into three physical partitions (PART), each
    with a mount point (MP) assigned so that the operating system can access
    them. On the right side, two disks have been divided into two and three
    physical partitions each. Two LVM volume groups (VG&nbsp;1 and
    VG&nbsp;2) have been defined. VG&nbsp;1 contains two partitions from
    DISK&nbsp;1 and one from DISK&nbsp;2. VG&nbsp;2 contains the remaining
    two partitions from DISK&nbsp;2.
   </para>

   <figure pgwide="0" id="bo1t1qx">
    <title>Physical Partitioning versus LVM</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="lvm.svg" width="445pt" format="SVG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="lvm.png" width="445pt" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>

   <para>
    In LVM, the physical disk partitions that are incorporated in a volume
    group are called physical volumes (PVs). Within the volume groups in
    <xref linkend="bo1t1qx" xrefstyle="FigureXRef"/>, four logical volumes
    (LV&nbsp;1 through LV&nbsp;4) have been defined, which can be used by
    the operating system via the associated mount points. The border between
    different logical volumes need not be aligned with any partition border.
    See the border between LV&nbsp;1 and LV&nbsp;2 in this example.
   </para>

   <para>
    LVM features:
   </para>

   <itemizedlist>
    <listitem>
     <para>
      Several hard disks or partitions can be combined in a large logical
      volume.
     </para>
    </listitem>
    <listitem>
     <para>
      Provided the configuration is suitable, an LV (such as
      <filename>/usr</filename>) can be enlarged when the free space is
      exhausted.
     </para>
    </listitem>
    <listitem>
     <para>
      Using LVM, it is possible to add hard disks or LVs in a running
      system. However, this requires hot-swappable hardware that is capable
      of such actions.
     </para>
    </listitem>
    <listitem>
     <para>
      It is possible to activate a <emphasis>striping mode</emphasis> that
      distributes the data stream of a logical volume over several physical
      volumes. If these physical volumes reside on different disks, this can
      improve the reading and writing performance like RAID&nbsp;0.
     </para>
    </listitem>
    <listitem>
     <para>
      The snapshot feature enables consistent backups (especially for
      servers) in the running system.
     </para>
    </listitem>
   </itemizedlist>

   <para>
    With these features, using LVM already makes sense for heavily used home
    PCs or small servers. If you have a growing data stock, as in the case
    of databases, music archives, or user directories, LVM is especially
    useful. It allows file systems that are larger than the physical hard
    disk. Another advantage of LVM is that up to 256 LVs can be added.
    However, keep in mind that working with LVM is different from working
    with conventional partitions.
   </para>

   <para>
    Starting from kernel version&nbsp;2.6, LVM version&nbsp;2 is available,
    which is downward-compatible with the previous LVM and enables the
    continued management of old volume groups. When creating new volume
    groups, decide whether to use the new format or the downward-compatible
    version. LVM&nbsp;2 does not require any kernel patches. It makes use of
    the device mapper integrated in kernel 2.6. This kernel only supports
    LVM version&nbsp;2. Therefore, when talking about LVM, this section
    always refers to LVM version&nbsp;2.
   </para>

   <para>
    You can manage new or existing LVM storage objects by using the &yast;
    Partitioner. Instructions and further information about configuring LVM
    is available in the official
    <ulink url="http://tldp.org/HOWTO/LVM-HOWTO/"><citetitle>LVM
    HOWTO</citetitle></ulink>.
   </para>

   <important>
    <para>
     If you add multipath support after you have configured LVM, you must
     modify the <filename>/etc/lvm/lvm.conf</filename> file to scan only the
     multipath device names in the <filename>/dev/disk/by-id</filename>
     directory as described in
     <xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>, then reboot
     the server.
    </para>
   </important>
  </sect1>
  <sect1 id="bi706ct">
   <title>Creating LVM Partitions</title>

   <para>
    For each disk, partition the free space that you want to use for LVM as
    <literal>0x8E Linux LVM</literal>. You can create one or multiple LVM
    partitions on a single device. It is not necessary for all of the
    partitions on a device to be LVM partitions.
   </para>

   <para>
    You can use the Volume Group function to group one or more LVM
    partitions into a logical pool of space called a volume group, then
    carve out one or more logical volumes from the space in the volume
    group.
   </para>

   <para>
    In the &yast; Partitioner, only the free space on the disk is made
    available to you as you are creating LVM partitions. If you want to use
    the entire disk for a single LVM partition and other partitions already
    exists on the disk, you must first remove all of the existing partitions
    to free the space before you can use that space in an LVM partition.
   </para>

   <warning>
    <para>
     Deleting a partition destroys all of the data in the partition.
    </para>
   </warning>

   <procedure id="bq2fjmu">
    <step id="bq2fjmv">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="bq2fk0j">
     <para>
      In &yast;, open the <guimenu>Partitioner</guimenu>.
     </para>
    </step>
    <step id="brgn1yt">
     <para>
      (Optional) Remove one or more existing partitions to free that space
      and make it available for the LVM partition you want to create.
     </para>
     <para>
      For information, see
      <xref linkend="brgob84" xrefstyle="SectTitleOnPage"/>.
     </para>
    </step>
    <step id="bq2fk9e">
     <para>
      On the Partitions page, click <guimenu>Add</guimenu>.
     </para>
    </step>
    <step id="brgodov">
     <para>
      Under <guimenu>New Partition Type</guimenu>, select <guimenu>Primary
      Partition</guimenu> or<guimenu> Extended Partition</guimenu>, then
      click <guimenu>Next</guimenu>.
     </para>
    </step>
    <step id="brgoefx">
     <para role="intro">
      Specify the <guimenu>New Partition Size</guimenu>, then click
      <guimenu>Next</guimenu>.
     </para>
     <informaltable frame="topbot" rowsep="0" pgwide="0">
      <tgroup cols="2">
       <colspec colnum="1" colname="1" colwidth="5001*"/>
       <colspec colnum="2" colname="2" colwidth="5001*"/>
       <tbody>
        <row id="brgpexh">
         <entry>
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="yast2_lvm2_a.png" width="151pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="yast2_lvm2_a.png" width="151pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </entry>
         <entry>
          <itemizedlist>
           <listitem>
            <formalpara id="brgof07">
             <title>Maximum Size:</title>
             <para>
              Use all of the free available space on the disk.
             </para>
            </formalpara>
           </listitem>
           <listitem>
            <formalpara id="brgooyf">
             <title>Custom Size:</title>
             <para>
              Specify a size up the amount of free available space on the
              disk.
             </para>
            </formalpara>
           </listitem>
           <listitem>
            <formalpara id="brgooyg">
             <title>Custom Region:</title>
             <para>
              Specify the start and end cylinder of the free available space
              on the disk.
             </para>
            </formalpara>
           </listitem>
          </itemizedlist>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </step>
    <step id="brgpahi">
     <para role="intro">
      Configure the partition format:
     </para>
     <informaltable frame="topbot" rowsep="0" pgwide="0">
      <tgroup cols="2">
       <colspec colnum="1" colname="1" colwidth="5001*"/>
       <colspec colnum="2" colname="2" colwidth="5001*"/>
       <tbody>
        <row id="brgpi5z">
         <entry>
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="yast2_lvm3_a.png" width="139pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="yast2_lvm3_a.png" width="139pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </entry>
         <entry>
          <orderedlist>
           <listitem>
            <para>
             Under <guimenu>Formatting Options</guimenu>, select <guimenu>Do
             not format</guimenu>.
            </para>
           </listitem>
           <listitem>
            <para>
             From the <guimenu>File System ID</guimenu> drop-down list,
             select <guimenu>0x8E Linux LVM</guimenu> as the partition
             identifier.
            </para>
           </listitem>
           <listitem>
            <para>
             Under <guimenu>Mounting Options</guimenu>, select <guimenu>Do
             not mount partition</guimenu>.
            </para>
           </listitem>
          </orderedlist>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </step>
    <step id="brgosll">
     <para>
      Click <guimenu>Finish</guimenu>.
     </para>
     <para>
      The partitions are not actually created until you click
      <guimenu>Next</guimenu> and <guimenu>Finish</guimenu> to exit the
      partitioner.
     </para>
    </step>
    <step id="bq2fkxr">
     <para>
      Repeat <xref linkend="bq2fk9e" xrefstyle="StepXRef"/> through
      <xref linkend="brgosll" xrefstyle="StepXRef"/> for each Linux LVM
      partition you want to add.
     </para>
    </step>
    <step id="brgouy6">
     <para>
      Click <guimenu>Next</guimenu>, verify that the new Linux LVM
      partitions are listed, then click <guimenu>Finish</guimenu> to exit
      the partitioner.
     </para>
    </step>
    <step id="bq2fl52">
     <para>
      (Optional) Continue with the Volume Group configuration as described
      in <xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/>.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="bgchx8a">
   <title>Creating Volume Groups</title>

   <para>
    An LVM volume group organizes the Linux LVM partitions into a logical
    pool of space. You can carve out logical volumes from the available
    space in the group. The Linux LVM partitions in a group can be on the
    same or different disks. You can add LVM partitions from the same or
    different disks to expand the size of the group. Assign all partitions
    reserved for LVM to a volume group. Otherwise, the space on the
    partition remains unused.
   </para>

   <procedure id="brgncwg">
    <step id="brgnjca">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="brgnjcb">
     <para>
      In &yast;, open the <guimenu>Partitioner</guimenu>.
     </para>
    </step>
    <step id="brgncwh">
     <para>
      In the left panel, click <guimenu>Volume Management</guimenu>.
     </para>
     <para>
      A list of existing Volume Groups are listed in the right panel.
     </para>
    </step>
    <step id="brgnd6f">
     <para role="intro">
      At the lower left of the Volume Management page, click <guimenu>Add
      Volume Group</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_lvm4_a.png" width="329pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_lvm4_a.png" width="329pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="brgndwo">
     <para>
      Specify the <guimenu>Volume Group Name</guimenu>.
     </para>
     <para>
      If you are creating a volume group at install time, the name
      <literal>system</literal> is suggested for a volume group that will
      contain the &productname; system files.
     </para>
    </step>
    <step id="brgnght">
     <para>
      Specify the <guimenu>Physical Extent Size</guimenu>.
     </para>
     <para>
      The <guimenu>Physical Extent Size</guimenu> defines the size of a
      physical block in the volume group. All the disk space in a volume
      group is handled in chunks of this size. Values can be from 1 KB to 16
      GB in powers of 2. This value is normally set to 4&nbsp;MB.
     </para>
     <para>
      In LVM1, a 4 MB physical extent allowed a maximum LV size of 256 GB
      because it supports only up to 65534 extents per LV. VM2 does not
      restrict the number of physical extents. Having a large number of
      extents has no impact on I/O performance to the logical volume, but it
      slows down the LVM tools.
     </para>
     <important>
      <para>
       Different physical extent sizes should not be mixed in a single VG.
       The extent should not be modified after the initial setup.
      </para>
     </important>
    </step>
    <step id="brgnhd9">
     <para>
      In the <guimenu>Available Physical Volumes</guimenu> list, select the
      Linux LVM partitions that you want to make part of this volume group,
      then click <guimenu>Add</guimenu> to move them to the
      <guimenu>Selected Physical Volumes</guimenu> list.
     </para>
    </step>
    <step id="brgnihe">
     <para>
      Click <guimenu>Finish</guimenu>.
     </para>
     <para>
      The new group appears in the <guimenu>Volume Groups</guimenu> list.
     </para>
    </step>
    <step id="brgnk9f">
     <para>
      On the Volume Management page, click <guimenu>Next</guimenu>, verify
      that the new volume group is listed, then click
      <guimenu>Finish</guimenu>.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="bgchx8b">
   <title>Configuring Physical Volumes</title>

   <para role="intro">
    When the Linux LVM partitions are assigned to a volume group, the
    partitions are then referred to as a physical volumes.
   </para>

   <figure pgwide="0" id="fig.yast2.lvm5">
    <title>Physical Volumes in the Volume Group Named Home</title>
<!--Physical Volume Setup-->
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm5_a.png" width="329pt" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm5_a.png" width="329pt" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>

   <para>
    To add more physical volumes to an existing volume group:
   </para>

   <procedure id="brgq6lc">
    <step id="brgq6ld">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="brgq6le">
     <para>
      In &yast;, open the <guimenu>Partitioner</guimenu>.
     </para>
    </step>
    <step id="brgq6lf">
     <para>
      In the left panel, select Volume Management and expand the list of
      groups.
     </para>
    </step>
    <step id="brgq6lg">
     <para>
      Under Volume Management, select the volume group, then click the
      <guimenu>Overview</guimenu> tab.
     </para>
    </step>
    <step id="brgq6lh">
     <para role="intro">
      At the bottom of the page, click <guimenu>Resize</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="brgq6li">
     <para>
      Select a physical volume (LVM partitions) from the <guimenu>Available
      Physical Volumes</guimenu> list then click Add to move it to the
      <guimenu>Selected Physical Volumes</guimenu> list.
     </para>
    </step>
    <step id="brgq6lj">
     <para>
      Click <guimenu>Finish</guimenu>.
     </para>
    </step>
    <step id="brgq6lk">
     <para>
      Click <guimenu>Next</guimenu>, verify that the changes are listed,
      then click <guimenu>Finish</guimenu>.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="bgchx8c">
   <title>Configuring Logical Volumes</title>

   <para>
    After a volume group has been filled with physical volumes, use the
    Logical Volumes dialog box (see
    <xref linkend="fig.yast2.lvm6" xrefstyle="FigureXRef"/>) to define and
    manage the logical volumes that the operating system should use. This
    dialog lists all of the logical volumes in that volume group. You can
    use <guimenu>Add</guimenu>, <guimenu>Edit</guimenu>, and
    <guimenu>Remove</guimenu> options to manage the logical volumes. Assign
    at least one logical volume to each volume group. You can create new
    logical volumes as needed until all free space in the volume group has
    been exhausted.
   </para>

   <para>
    Beginning in SLES 11 SP3, an LVM logical volume can be thinly
    provisioned. Thin provisioning allows you to create logical volumes with
    sizes that overbook the available free space. You create a thin pool
    that contains unused space reserved for use with an arbitrary number of
    thin volumes. A thin volume is created as a sparse volume and space is
    allocated from a thin pool as needed. The thin pool can be expanded
    dynamically when needed for cost-effective allocation of storage space.
   </para>

   <important>
    <para>
     To use thinly provisioned volumes in a cluster, the thin pool and the
     thin volumes that use it must be managed in a single cluster resource.
     This allows the thin volumes and thin pool to always be mounted
     exclusively on the same node.
    </para>
   </important>

   <figure pgwide="0" id="fig.yast2.lvm6">
    <title>Logical Volume Management</title>
<!--Logical Volume Management-->
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm6_a.png" width="329pt" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm6_a.png" width="329pt" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>

   <para>
    It is possible to distribute the data stream in the logical volume among
    several physical volumes (striping). If these physical volumes reside on
    different hard disks, this generally results in a better reading and
    writing performance (like RAID&nbsp;0). However, a striping LV with
    <literal>n</literal> stripes can only be created correctly if the hard
    disk space required by the LV can be distributed evenly to
    <literal>n</literal> physical volumes. For example, if only two physical
    volumes are available, a logical volume with three stripes is
    impossible.
   </para>

   <procedure id="brgq5hr">
    <step id="brgq6ll">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="brgq6lm">
     <para>
      In &yast;, open the <guimenu>Partitioner</guimenu>.
     </para>
    </step>
    <step id="brgq6ln">
     <para>
      In the left panel, select Volume Management and expand it to see the
      list of volume groups.
     </para>
    </step>
    <step id="brgq6lo">
     <para>
      Under Volume Management, select the volume group, then click the
      <guimenu>Logical Volumes</guimenu> tab.
     </para>
    </step>
    <step id="brgq5hs">
     <para>
      In the lower left, click <guimenu>Add</guimenu> to open the Add
      Logical Volume dialog box.
     </para>
    </step>
    <step id="brgq8gl">
     <para role="intro">
      Specify the <guimenu>Name</guimenu> for the logical volume, then click
      <guimenu>Next</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_lvm9_a.png" width="137pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_lvm9_a.png" width="137pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b15cmz3e">
     <para>
      Specify the type of LVM volume:
     </para>
     <itemizedlist>
      <listitem>
       <formalpara id="b15cmz3f">
        <title>Normal volume:</title>
        <para>
         (Default) The volume’s space is allocated immediately.
        </para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="b15cmz3g">
        <title>Thin pool:</title>
        <para>
         The logical volume is a pool of space that is reserved for use with
         thin volumes. The thin volumes can allocate their needed space from
         it on demand.
        </para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="b15cmz3h">
        <title>Thin volume:</title>
        <para>
         The volume is created as a sparse volume. The volume allocates
         needed space on demand from a thin pool.
        </para>
       </formalpara>
      </listitem>
     </itemizedlist>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_lvm9a_a.png" width="137pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_lvm9a_a.png" width="137pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="brgqd13">
     <para role="intro">
      Specify the size of the volume and whether to use multiple stripes.
     </para>
     <informaltable frame="topbot" rowsep="0" pgwide="0">
      <tgroup cols="2">
       <colspec colnum="1" colname="1" colwidth="5001*"/>
       <colspec colnum="2" colname="2" colwidth="5001*"/>
       <tbody>
        <row id="brgqgrg">
         <entry>
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="yast2_lvm10_a.png" width="155pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="yast2_lvm10_a.png" width="155pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </entry>
         <entry>
          <orderedlist>
           <listitem>
            <para>
             Specify the size of the logical volume, up to the maximum size
             available.
            </para>
            <para>
             The amount of free space in the current volume group is shown
             next to the <guimenu>Maximum Size</guimenu> option.
            </para>
           </listitem>
           <listitem>
            <para>
             Specify the number of stripes.
            </para>
            <warning>
             <para>
              &yast; has no chance at this point to verify the correctness of
              your entries concerning striping. Any mistake made here is
              apparent only later when the LVM is implemented on disk.
             </para>
            </warning>
           </listitem>
          </orderedlist>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </step>
    <step id="brgqevk">
     <para>
      Specify the formatting options for the logical volume:
     </para>
     <informaltable frame="topbot" rowsep="1" pgwide="0">
      <tgroup cols="2">
       <colspec colnum="1" colname="1" colwidth="5001*"/>
       <colspec colnum="2" colname="2" colwidth="5001*"/>
       <tbody>
        <row id="brgqevl">
         <entry>
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="yast2_lvm11_a.png" width="129pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="yast2_lvm11_a.png" width="129pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </entry>
         <entry>
          <orderedlist>
           <listitem>
            <para>
             Under <guimenu>Formatting Options</guimenu>, select
             <guimenu>Format partition</guimenu>, then select the format
             type from the <guimenu>File system</guimenu> drop-down list,
             such as Ext3.
            </para>
           </listitem>
           <listitem>
            <para>
             Under <guimenu>Mounting Options</guimenu>, select
             <guimenu>Mount partition</guimenu>, then select the mount
             point.
            </para>
            <para>
             The files stored on this logical volume can be found at this
             mount point on the installed system.
            </para>
           </listitem>
           <listitem>
            <para>
             Click <guimenu>Fstab Options</guimenu> to add special mounting
             options for the volume.
            </para>
           </listitem>
          </orderedlist>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </step>
    <step id="brgqmpf">
     <para>
      Click <guimenu>Finish</guimenu>.
     </para>
    </step>
    <step id="brgqn20">
     <para>
      Click <guimenu>Next</guimenu>, verify that the changes are listed,
      then click <guimenu>Finish</guimenu>.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="lvm_activate_vgs">
   <title>Automatically Activating Non-Root LVM Volume Groups</title>

   <para>
    Activation behavior for non-root LVM volume groups is controlled by
    parameter settings in the <literal>/etc/sysconfig/lvm</literal> file.
   </para>

   <para>
    By default, non-root LVM volume groups are automatically activated on
    system restart by <filename>/etc/rc.d/boot.lvm</filename>, according to
    the setting for the <literal>LVM_VGS_ACTIVATED_ON_BOOT</literal>
    parameter in the <literal>/etc/sysconfig/lvm</literal> file. This
    parameter allows you to activate all volume groups on system restart, or
    to activate only specified non-root LVM volume groups.
   </para>

   <para>
    To activate all non-root LVM volume groups on system restart, ensure
    that the value for the <literal>LVM_VGS_ACTIVATED_ON_BOOT</literal>
    parameter in the <filename>/etc/sysconfig/lvm</filename> file is empty
    (<literal>""</literal>). This is the default setting. For almost all
    standard LVM installations, it can safely stay empty.
   </para>

<screen>
LVM_VGS_ACTIVATED_ON_BOOT="" 
</screen>

   <para>
    To activate only a specified non-root LVM volume group on system
    restart, specify the volume group name as the value for the
    <literal>LVM_VGS_ACTIVATED_ON_BOOT</literal> parameter:
   </para>

<screen>
LVM_VGS_ACTIVATED_ON_BOOT="vg1" 
</screen>

   <para>
    By default, newly discovered LVM volume groups are not automatically
    activated. The <literal>LVM_ACTIVATED_ON_DISCOVERED</literal> parameter
    is disabled in the <filename>/etc/sysconfig/lvm</filename> file:
   </para>

<screen>
LVM_ACTIVATED_ON_DISCOVERED="disable"
</screen>

   <para>
    You can enable the <literal>LVM_ACTIVATED_ON_DISCOVERED</literal>
    parameter to allow newly discovered LVM volume groups to be activated
    via udev rules:
   </para>

<screen>
LVM_ACTIVATED_ON_DISCOVERED="enable"
</screen>
  </sect1>
  <sect1 id="lvmtagging">
   <title>Tagging LVM2 Storage Objects</title>

   <para role="intro">
    A tag is an unordered keyword or term assigned to the metadata of a
    storage object. Tagging allows you to classify collections of LVM
    storage objects in ways that you find useful by attaching an unordered
    list of tags to their metadata.
   </para>

   <itemizedlist role="subtoc">
    <listitem>
     <para>
      <xref linkend="bwkc8pi" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="bwkc1zg" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="bwkc1ta" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="bwkepmz" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="bwkdms3" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="bwkdqfz" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
   </itemizedlist>

   <sect2 id="bwkc8pi">
    <title>Using LVM2 Tags</title>
    <para role="intro">
     After you tag the LVM2 storage objects, you can use the tags in
     commands to accomplish the following tasks:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Select LVM objects for processing according to the presence or
       absence of specific tags.
      </para>
     </listitem>
     <listitem>
      <para>
       Use tags in the configuration file to control which volume groups and
       logical volumes are activated on a server.
      </para>
     </listitem>
     <listitem>
      <para>
       Override settings in a global configuration file by specifying tags
       in the command.
      </para>
     </listitem>
    </itemizedlist>
    <para>
     A tag can be used in place of any command line LVM object reference
     that accepts:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       a list of objects
      </para>
     </listitem>
     <listitem>
      <para>
       a single object as long as the tag expands to a single object
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Replacing the object name with a tag is not supported everywhere yet.
     After the arguments are expanded, duplicate arguments in a list are
     resolved by removing the duplicate arguments, and retaining the first
     instance of each argument.
    </para>
    <para>
     Wherever there might be ambiguity of argument type, you must prefix a
     tag with the commercial at sign (@) character, such as
     <literal>@mytag</literal>. Elsewhere, using the <quote>@</quote> prefix
     is optional.
    </para>
   </sect2>

   <sect2 id="bwkc1zg">
    <title>Requirements for Creating LVM2 Tags</title>
    <para role="intro">
     Consider the following requirements when using tags with LVM:
    </para>
    <itemizedlist role="subtoc">
     <listitem>
      <para>
       <xref linkend="bwkc4lx" xrefstyle="HeadingOnPage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <xref linkend="bwkc75c" xrefstyle="HeadingOnPage"/>
      </para>
     </listitem>
    </itemizedlist>
    <sect3 id="bwkc4lx">
     <title>Supported Characters</title>
     <para>
      An LVM tag word can contain the ASCII uppercase characters A to Z,
      lowercase characters a to z, numbers 0 to 9, underscore (_), plus (+),
      hyphen (-), and period (.). The word cannot begin with a hyphen. The
      maximum length is 128 characters.
     </para>
    </sect3>
    <sect3 id="bwkc75c">
     <title>Supported Storage Objects</title>
     <para>
      You can tag LVM2 physical volumes, volume groups, logical volumes, and
      logical volume segments. PV tags are stored in its volume group’s
      metadata. Deleting a volume group also deletes the tags in the
      orphaned physical volume. Snapshots cannot be tagged, but their origin
      can be tagged.
     </para>
     <para>
      LVM1 objects cannot be tagged because the disk format does not support
      it.
     </para>
    </sect3>
   </sect2>

   <sect2 id="bwkc1ta">
    <title>Command Line Tag Syntax</title>
    <variablelist>
     <varlistentry id="bwkddun">
      <term>--addtag &lt;<replaceable>tag_info</replaceable>&gt;</term>
      <listitem>
       <para>
        Add a tag to (or <emphasis>tag</emphasis>) an LVM2 storage object.
       </para>
       <formalpara id="bwkdj1p">
        <title>Example</title>
        <para/>
       </formalpara>
<screen>
vgchange --addtag @db1 vg1
</screen>
      </listitem>
     </varlistentry>
     <varlistentry id="bwkdh2t">
      <term>--deltag &lt;<replaceable>tag_info</replaceable>&gt;</term>
      <listitem>
       <para>
        Remove a tag from (or <emphasis>untag</emphasis>) an LVM2 storage
        object.
       </para>
       <formalpara id="bwkdjin">
        <title>Example</title>
        <para/>
       </formalpara>
<screen>
vgchange --deltag @db1 vg1
</screen>
      </listitem>
     </varlistentry>
     <varlistentry id="bwkdh2u">
      <term>--tag &lt;<replaceable>tag_info</replaceable>&gt;</term>
      <listitem>
       <para>
        Specify the tag to use to narrow the list of volume groups or
        logical volumes to be activated or deactivated.
       </para>
       <formalpara id="bwkdg98">
        <title>Example</title>
        <para/>
       </formalpara>
       <para>
        Enter the following to activate it the volume if it has a tag that
        matches the tag provided:
       </para>
<screen>
lvchange -ay --tag @db1 vg1/vol2
</screen>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect2>

   <sect2 id="bwkepmz">
    <title>Configuration File Syntax</title>
    <itemizedlist role="subtoc">
     <listitem>
      <para>
       <xref linkend="bwkcqoj" xrefstyle="HeadingOnPage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <xref linkend="bwkeuio" xrefstyle="HeadingOnPage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <xref linkend="bwkctd3" xrefstyle="HeadingOnPage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <xref linkend="bwkcwqd" xrefstyle="HeadingOnPage"/>
      </para>
     </listitem>
    </itemizedlist>
    <sect3 id="bwkcqoj">
     <title>Enabling Hostname Tags in the lvm.conf File</title>
     <para>
      Add the following code to the <filename>/etc/lvm/lvm.conf</filename>
      file to enable host tags that are defined separately on host in a
      <filename>/etc/lvm/lvm_&lt;<replaceable>hostname</replaceable>&gt;.conf</filename>
      file.
     </para>
<screen>
tags {
   # Enable hostname tags
   hosttags = 1
}
</screen>
     <para>
      You place the activation code in the
      <filename>/etc/lvm/lvm_&lt;<replaceable>hostname</replaceable>&gt;.conf</filename>
      file on the host. See
      <xref linkend="bwkctd3" xrefstyle="HeadingOnPage"/>.
     </para>
    </sect3>
    <sect3 id="bwkeuio">
     <title>Defining Tags for Hostnames in the lvm.conf File</title>
<screen>
tags {

   tag1 { }
      # Tag does not require a match to be set.

   tag2 {
      # If no exact match, tag is not set.
      host_list = [ "hostname1", "hostname2" ]
   }
}
</screen>
    </sect3>
    <sect3 id="bwkctd3">
     <title>Defining Activation</title>
     <para>
      You can modify the <filename>/etc/lvm/lvm.conf</filename> file to
      activate LVM logical volumes based on tags.
     </para>
     <para>
      In a text editor, add the following code to the file:
     </para>
<screen>
  activation {
      volume_list = [ "vg1/lvol0", "@database" ]
  }
</screen>
     <para>
      Replace <literal>@database</literal> with the your tag. Use
      <literal>"@*"</literal> to match the tag against any tag set on the
      host.
     </para>
     <para>
      The activation command matches against
      <replaceable>vgname</replaceable>,
      <replaceable>vgname/lvname</replaceable>, or
      @<replaceable>tag</replaceable> set in the metadata of volume groups
      and logical volumes. A volume group or logical volume is activated
      only if a metadata tag matches. The default if there is no match is
      not to activate.
     </para>
     <para>
      If <literal>volume_list</literal> is not present and any tags are
      defined on the host, then it activates the volume group or logical
      volumes only if a host tag matches a metadata tag.
     </para>
     <para>
      If <literal>volume_list</literal> is not present and no tags are
      defined on the host, then it does activate.
     </para>
    </sect3>
    <sect3 id="bwkcwqd">
     <title>Defining Activation in Multiple Hostname Configuration Files</title>
     <para>
      You can use the activation code in a host’s configuration file
      (<filename>/etc/lvm/lvm_&lt;<replaceable>host_tag</replaceable>&gt;.conf</filename>)
      when host tags are enabled in the <filename>lvm.conf</filename> file.
      For example, a server has two configuration files in the
      <filename>/etc/lvm/</filename> folder:
     </para>
     <simplelist>
      <member><filename>lvm.conf</filename>
      </member>
      <member><filename>lvm_&lt;<replaceable>host_tag</replaceable>&gt;.conf</filename>
      </member>
     </simplelist>
     <para>
      At startup, load the <filename>/etc/lvm/lvm.conf</filename> file, and
      process any tag settings in the file. If any host tags were defined,
      it loads the related
      <filename>/etc/lvm/lvm_&lt;<replaceable>host_tag</replaceable>&gt;.conf</filename>
      file.When it searches for a specific configuration file entry, it
      searches the host tag file first, then the <filename>lvm.conf
      </filename>file, and stops at the first match.Within the
      <filename>lvm_&lt;<replaceable>host_tag</replaceable>&gt;.conf</filename>
      file, use the reverse order that tags were set. This allows the file
      for the last tag set to be searched first. New tags set in the host
      tag file will trigger additional configuration file loads.
     </para>
    </sect3>
   </sect2>

   <sect2 id="bwkdms3">
    <title>Using Tags for a Simple Activation Control in a Cluster</title>
    <para>
     You can set up a simple hostname activation control by enabling the
     <literal>hostname_tags</literal> option in a the
     <filename>/etc/lvm/lvm.conf</filename> file. Use the same file on every
     machine in a cluster so that it is a global setting.
    </para>
    <procedure id="bwkel6y">
     <step id="bwkel6z">
      <para>
       In a text editor, add the following code to the
       <filename>/etc/lvm/lvm.conf</filename> file:
      </para>
<screen>
tags {
   hostname_tags = 1
}
</screen>
     </step>
     <step id="bwkelf9">
      <para>
       Replicate the file to all hosts in the cluster.
      </para>
     </step>
     <step id="bwkelow">
      <para>
       From any machine in the cluster, add <literal>db1</literal> to the
       list of machines that activate <filename>vg1/lvol2</filename>:
      </para>
<screen>
lvchange --addtag @db1 vg1/lvol2
</screen>
     </step>
     <step id="bwkelx8">
      <para>
       On the <filename>db1</filename> server, enter the following to
       activate it:
      </para>
<screen>
lvchange -ay vg1/vol2
</screen>
     </step>
    </procedure>
   </sect2>

   <sect2 id="bwkdqfz">
    <title>Using Tags to Activate On Preferred Hosts in a Cluster</title>
    <para>
     The examples in this section demonstrate two methods to accomplish the
     following:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Activate volume group <filename>vg1</filename> only on the database
       hosts <filename>db1</filename> and <filename>db2</filename>.
      </para>
     </listitem>
     <listitem>
      <para>
       Activate volume group <filename>vg2</filename> only on the file
       server host <filename>fs1</filename>.
      </para>
     </listitem>
     <listitem>
      <para>
       Activate nothing initially on the file server backup host
       <filename>fsb1</filename>, but be prepared for it to take over from
       the file server host <filename>fs1</filename>.
      </para>
     </listitem>
    </itemizedlist>
    <itemizedlist role="subtoc">
     <listitem>
      <para>
       <xref linkend="bwkdsty" xrefstyle="HeadingOnPage"/>
      </para>
     </listitem>
     <listitem>
      <para>
       <xref linkend="bwkdtdw" xrefstyle="HeadingOnPage"/>
      </para>
     </listitem>
    </itemizedlist>
    <sect3 id="bwkdsty">
     <title>Option 1: Centralized Admin and Static Configuration Replicated Between Hosts</title>
     <para>
      In the following solution, the single configuration file is replicated
      among multiple hosts.
     </para>
     <procedure id="bwkdvwj">
      <step id="bwkdvwk">
       <para>
        Add the <literal>@database</literal> tag to the metadata of volume
        group <filename>vg1</filename>. In a terminal console, enter
       </para>
<screen>
vgchange --addtag @database vg1
</screen>
      </step>
      <step id="bwke0dt">
       <para>
        Add the <literal>@fileserver</literal> tag to the metadata of volume
        group <filename>vg2</filename>. In a terminal console, enter
       </para>
<screen>
vgchange --addtag @fileserver vg2
</screen>
      </step>
      <step id="bwke0du">
       <para>
        In a text editor, modify the<filename> /etc/lvm/lvm.conf</filename>
        file with the following code to define the
        <literal>@database</literal>, <literal>@fileserver</literal>,
        <literal>@fileserverbackup</literal> tags.
       </para>
<screen>
tags {
   database {
      host_list = [ "db1", "db2" ]
   }
   fileserver {
      host_list = [ "fs1" ]
   }
   fileserverbackup {
      host_list = [ "fsb1" ]
   }
}

activation {
   # Activate only if host has a tag that matches a metadata tag
   volume_list = [ "@*" ]
}
</screen>
      </step>
      <step id="bwke0dv">
       <para>
        Replicate the modified<filename> /etc/lvm/lvm.conf</filename> file
        to the four hosts: <filename>db1</filename>,
        <filename>db2</filename>, <filename>fs1</filename>, and
        <filename>fsb1</filename>.
       </para>
      </step>
      <step id="bwke2yh">
       <para>
        If the file server host goes down, <filename>vg2</filename> can be
        brought up on <filename>fsb1</filename> by entering the following
        commands in a terminal console on any node:
       </para>
<screen>
vgchange --addtag @fileserverbackup vg2
vgchange -ay vg2
</screen>
      </step>
     </procedure>
    </sect3>
    <sect3 id="bwkdtdw">
     <title>Option 2: Localized Admin and Configuration</title>
     <para>
      In the following solution, each host holds locally the information
      about which classes of volume to activate.
     </para>
     <procedure id="bwke3z3">
      <step id="bwke8yi">
       <para role="intro">
        Add the <literal>@database</literal> tag to the metadata of volume
        group <filename>vg1</filename>. In a terminal console, enter
       </para>
<screen>
vgchange --addtag @database vg1
</screen>
      </step>
      <step id="bwke8yj">
       <para>
        Add the <literal>@fileserver</literal> tag to the metadata of volume
        group <filename>vg2</filename>. In a terminal console, enter
       </para>
<screen>
vgchange --addtag @fileserver vg2
</screen>
      </step>
      <step id="bwke8yk">
       <para>
        Enable host tags in the <filename>/etc/lvm/lvm.conf</filename> file:
       </para>
       <substeps>
        <step id="bwke8dm">
         <para>
          In a text editor, modify the
          <filename>/etc/lvm/lvm.conf</filename> file with the following
          code to enable host tag configuration files.
         </para>
<screen>
tags {
   hosttags = 1
}
</screen>
        </step>
        <step id="bwke8dn">
         <para>
          Replicate the modified <filename>/etc/lvm/lvm.conf</filename> file
          to the four hosts: <filename>db1</filename>,
          <filename>db2</filename>, <filename>fs1</filename>, and
          <filename>fsb1</filename>.
         </para>
        </step>
       </substeps>
      </step>
      <step id="bwke7w8">
       <para>
        On host <filename>db1</filename>, create an activation configuration
        file for the database host <filename>db1</filename>. In a text
        editor, create <filename>a /etc/lvm/lvm_db1.conf</filename> file and
        add the following code:
       </para>
<screen>
activation {
   volume_list = [ "@database" ]
}
</screen>
      </step>
      <step id="bwkeef1">
       <para>
        On host <filename>db2</filename>, create an activation configuration
        file for the database host <filename>db2</filename>. In a text
        editor, create <filename>a /etc/lvm/lvm_db2.conf</filename> file and
        add the following code:
       </para>
<screen>
activation {
   volume_list = [ "@database" ]
}
</screen>
      </step>
      <step id="bwkeef2">
       <para>
        On host fs1, create an activation configuration file for the file
        server host <filename>fs1</filename>.In a text editor, create
        <filename>a /etc/lvm/lvm_fs1.conf</filename> file and add the
        following code:
       </para>
<screen>
activation {
   volume_list = [ "@fileserver" ]
}
</screen>
      </step>
      <step id="bwkeef3">
       <para>
        If the file server host <filename>fs1</filename> goes down, to bring
        up a spare file server host fsb1 as a file server:
       </para>
       <substeps>
        <step id="bwkeef4">
         <para>
          On host <filename>fsb1</filename>, create an activation
          configuration file for the host <filename>fsb1</filename>. In a
          text editor, create <filename>a /etc/lvm/lvm_fsb1.conf</filename>
          file and add the following code:
         </para>
<screen>
activation {
   volume_list = [ "@fileserver" ]
}
</screen>
        </step>
        <step id="bwkeef5">
         <para>
          In a terminal console, enter one of the following commands:
         </para>
<screen>
vgchange -ay vg2

vgchange -ay @fileserver
</screen>
        </step>
       </substeps>
      </step>
     </procedure>
    </sect3>
   </sect2>
  </sect1>
  <sect1 id="brgpqe2">
   <title>Resizing a Volume Group</title>

   <para role="intro">
    You can add and remove Linux LVM partitions from a volume group to
    expand or reduce its size.
   </para>

   <warning>
    <para>
     Removing a partition can result in data loss if the partition is in use
     by a logical volume.
    </para>
   </warning>

   <procedure id="brgpt5w">
    <step id="brgpt5x">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="brgpt5y">
     <para>
      In &yast;, open the <guimenu>Partitioner</guimenu>.
     </para>
    </step>
    <step id="brgpt5z">
     <para>
      In the left panel, select Volume Management and expand it to see the
      list of volume groups.
     </para>
    </step>
    <step id="brgpt60">
     <para>
      Under Volume Management, select the volume group, then click the
      <guimenu>Overview</guimenu> tab.
     </para>
    </step>
    <step id="brgpt61">
     <para role="intro">
      At the bottom of the page, click <guimenu>Resize</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="brgptkf">
     <para>
      Do one of the following:
     </para>
     <itemizedlist>
      <listitem>
       <formalpara id="brgpw44">
        <title>Add:</title>
        <para>
         Expand the size of the volume group by moving one or more physical
         volumes (LVM partitions) from the <guimenu>Available Physical
         Volumes</guimenu> list to the <guimenu>Selected Physical
         Volumes</guimenu> list.
        </para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="brgpxfv">
        <title>Remove:</title>
        <para>
         Reduce the size of the volume group by moving Lone or more physical
         volumes (LVM partitions) from the <guimenu>Selected Physical
         Volumes</guimenu> list to the <guimenu>Available Physical
         Volumes</guimenu> list.
        </para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </step>
    <step id="brgptf8">
     <para>
      Click <guimenu>Finish</guimenu>.
     </para>
    </step>
    <step id="brgpt62">
     <para>
      Click <guimenu>Next</guimenu>, verify that the changes are listed,
      then click <guimenu>Finish</guimenu>.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="brgqpfy">
   <title>Resizing a Logical Volume with &yast;</title>

   <procedure id="brgqpvs">
    <step id="brgqsmd">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="brgqsme">
     <para>
      In &yast;, open the <guimenu>Partitioner</guimenu>.
     </para>
    </step>
    <step id="brgqsmf">
     <para>
      In the left panel, select Volume Management and expand it to see the
      list of volume groups.
     </para>
    </step>
    <step id="brgqsmg">
     <para>
      Under Volume Management, select the volume group, then click the
      <guimenu>Logical Volumes</guimenu> tab.
     </para>
    </step>
    <step id="brgqsmh">
     <para>
      At the bottom of the page, click <guimenu>Resize</guimenu> to open the
      Resize Logical Volume dialog box.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_lvm12_a.png" width="244pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_lvm12_a.png" width="244pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="brgqpvt">
     <para>
      Use the slider to expand or reduce the size of the logical volume.
     </para>
     <warning>
      <para>
       Reducing the size of a logical volume that contains data can cause
       data corruption.
      </para>
     </warning>
    </step>
    <step id="brgqueh">
     <para>
      Click <guimenu>OK</guimenu>.
     </para>
    </step>
    <step id="brgqulm">
     <para>
      Click <guimenu>Next</guimenu>, verify that the change is listed, then
      click <guimenu>Finish</guimenu>.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="biuz4lz">
   <title>Resizing a Logical Volume with Commands</title>

   <para>
    The <command>lvresize</command>, <command>lvextend</command>, and
    <command>lvreduce</command> commands are used to resize logical volumes.
    See the man pages for each of these commands for syntax and options
    information.
   </para>

   <para>
    You can also increase the size of a logical volume by using the &yast;
    Partitioner. &yast; uses <command>parted(8)</command> to grow the
    partition.
   </para>

   <para>
    To extend an LV there must be enough unallocated space available on the
    VG.
   </para>

   <para>
    LVs can be extended or shrunk while they are being used, but this may
    not be true for a file system on them. Extending or shrinking the LV
    does not automatically modify the size of file systems in the volume.
    You must use a different command to grow the file system afterwards. For
    information about resizing file systems, see
    <xref linkend="biuymaa" xrefstyle="ChapTitleOnPage"/>.
   </para>

   <para>
    Ensure that you use the right sequence:
   </para>

   <itemizedlist>
    <listitem>
     <para>
      If you extend an LV, you must extend the LV before you attempt to grow
      the file system.
     </para>
    </listitem>
    <listitem>
     <para>
      If you shrink an LV, you must shrink the file system before you
      attempt to shrink the LV.
     </para>
    </listitem>
   </itemizedlist>

   <para>
    To extend the size of a logical volume:
   </para>

   <procedure id="biuz4s4">
    <step id="biuz7nu">
     <para>
      Open a terminal console, log in as the &rootuser;
      user.
     </para>
    </step>
    <step id="biuz81p">
     <para>
      If the logical volume contains file systems that are hosted for a
      virtual machine (such as a &xen; VM), shut down the VM.
     </para>
    </step>
    <step id="biuz7ph">
     <para>
      Dismount the file systems on the logical volume.
     </para>
    </step>
    <step id="biuz4s5">
     <para>
      At the terminal console prompt, enter the following command to grow
      the size of the logical volume:
     </para>
<screen>
lvextend -L +<replaceable>size</replaceable> <replaceable>/dev/vgname/lvname</replaceable>
</screen>
     <para>
      For <replaceable>size</replaceable>, specify the amount of space you
      want to add to the logical volume, such as 10GB. Replace
      <filename><replaceable>/dev/vgname/lvname</replaceable></filename>
      with the Linux path to the logical volume, such as
      <filename>/dev/vg1/v1</filename>. For example:
     </para>
<screen>
lvextend -L +10GB /dev/vg1/v1<replaceable/>
</screen>
    </step>
   </procedure>

   <para>
    For example, to extend an LV with a (mounted and active) ReiserFS on it
    by 10GB:
   </para>

<screen>
lvextend −L +10G <replaceable>/dev/vgname/lvname</replaceable>
resize_reiserfs −s +10GB −f <replaceable>/dev/vg−name/lv−name</replaceable>
</screen>

   <para>
    For example, to shrink an LV with a ReiserFS on it by 5GB:
   </para>

<screen>
umount <replaceable>/mountpoint−of−LV</replaceable>
resize_reiserfs −s −5GB <replaceable>/dev/vgname/lvname</replaceable>
lvreduce <replaceable>/dev/vgname/lvname</replaceable>
mount <replaceable>/dev/vgname/lvname</replaceable> <replaceable>/mountpoint−of−LV</replaceable>
</screen>
  </sect1>
  <sect1 id="brgpmw3">
   <title>Deleting a Volume Group</title>

   <warning>
    <para>
     Deleting a volume group destroys all of the data in each of its member
     partitions.
    </para>
   </warning>

   <procedure id="brgppd6">
    <step id="brgppd7">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="brgppd8">
     <para>
      In &yast;, open the <guimenu>Partitioner</guimenu>.
     </para>
    </step>
    <step id="brgppd9">
     <para>
      In the left panel, select Volume Management and expand the list of
      groups.
     </para>
    </step>
    <step id="brgpos4">
     <para>
      Under Volume Management, select the volume group, then click the
      <guimenu>Overview</guimenu> tab.
     </para>
    </step>
    <step id="brgpos5">
     <para>
      At the bottom of the page, click <guimenu>Delete</guimenu>, then click
      <guimenu>Yes</guimenu> to confirm the deletion.
     </para>
    </step>
    <step id="brgpos6">
     <para>
      Click <guimenu>Next</guimenu>, verify that the deleted volume group is
      listed (deletion is indicated by a red colored font), then click
      <guimenu>Finish</guimenu>.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="brgob84">
   <title>Deleting an LVM Partition (Physical Volume)</title>

   <warning>
    <para>
     Deleting a partition destroys all of the data in the partition.
    </para>
   </warning>

   <procedure id="brgobbw">
    <step id="brgobki">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="brgobkj">
     <para>
      In &yast;, open the <guimenu>Partitioner</guimenu>.
     </para>
    </step>
    <step id="brgobuj">
     <para>
      If the Linux LVM partition is in use as a member of a volume group,
      remove the partition from the volume group, or
      <link linkend="brgpmw3">delete the volume group</link>.
     </para>
    </step>
    <step id="brgobkk">
     <para>
      In the &yast; Partitioner under <guimenu>Hard Disks</guimenu>, select
      the device (such as <filename>sdc</filename>).
     </para>
    </step>
    <step id="brgobkl">
     <para>
      On the Partitions page, select a partition that you want to remove,
      click <guimenu>Delete</guimenu>, then click <guimenu>Yes</guimenu> to
      confirm the deletion.
     </para>
    </step>
    <step id="brgobkm">
     <para>
      Click <guimenu>Next</guimenu>, verify that the deleted partition is
      listed (deletion is indicated by a red colored font), then click
      <guimenu>Finish</guimenu>.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="btx9jxu">
   <title>Using LVM Commands</title>

   <para>
    For information about using LVM commands, see the man pages for the
    commands described in <xref linkend="btx8b05" xrefstyle="TableXRef"/>.
    Perform the commands as the &rootuser; user.
   </para>

   <table id="btx8b05" frame="topbot" rowsep="1" pgwide="0">
    <title>LVM Commands</title>
    <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="btx8b06">
       <entry>
        <para>
         Command
        </para>
       </entry>
       <entry>
        <para>
         Description
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="btx8b07">
       <entry>
<screen>
pvcreate <replaceable>&lt;device</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Initializes a device (such as <filename>/dev/sdb</filename>) for
         use by LVLM as a physical volume.
        </para>
       </entry>
      </row>
      <row id="btx8yob">
       <entry>
<screen>
pvdisplay &lt;<replaceable>device</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Displays information about the LVM physical volume, such as whether
         it is currently being used in a logical volume.
        </para>
       </entry>
      </row>
      <row id="btx8b08">
       <entry>
<screen>
vgcreate -c y &lt;<replaceable>vg_name&gt;</replaceable> &lt;<replaceable>dev1</replaceable>&gt; [<replaceable>dev2</replaceable>...]
</screen>
       </entry>
       <entry>
        <para>
         Creates a clustered volume group with one or more specified
         devices.
        </para>
       </entry>
      </row>
      <row id="btx8b09">
       <entry>
<screen>
vgchange -a [ey | n] &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Activates (<literal>-a ey</literal>) or deactivates (<literal>-a
         n</literal>) a volume group and its logical volumes for
         input/output.
        </para>
        <important>
         <para>
          Ensure that you use the <literal>ey</literal> option to
          exclusively activate a volume group on a cluster node. This option
          is used by default in the load script.
         </para>
        </important>
       </entry>
      </row>
      <row id="btx8lez">
       <entry>
<screen>
vgremove &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Removes a volume group. Before using this command, remove the
         logical volumes, then deactivate the volume group.
        </para>
       </entry>
      </row>
      <row id="btx8b0a">
       <entry>
<screen>
vgdisplay &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Displays information about a specified volume group.
        </para>
        <para>
         To find the total physical extent of a volume group, enter
        </para>
<screen>
vgdisplay vg_name | grep "Total PE"
</screen>
       </entry>
      </row>
      <row id="b15cnuq5">
       <entry>
<screen>
lvcreate -L <replaceable>size</replaceable> -n &lt;<replaceable>lv_name</replaceable>&gt; &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Creates a logical volume of the specified size.
        </para>
       </entry>
      </row>
      <row id="btx8b0b">
       <entry>
<screen>
lvcreate -L &lt;size&gt; &lt;-T|--thinpool&gt; &lt;<replaceable>vg_name/thin_pool_name</replaceable>&gt;

lvcreate -virtualsize &lt;size&gt; &lt;-T|--thin&gt; 
&lt;<replaceable>vg_name</replaceable>/<replaceable>thin_pool_name</replaceable>&gt; -n &lt;<replaceable>thin_lv_name</replaceable>&gt;

lvcreate -L &lt;size&gt; -T 
&lt;<replaceable>vg_name</replaceable>/<replaceable>thin_pool_name</replaceable>&gt; 
-virtualsize &lt;size&gt; -n &lt;<replaceable>thin_lv_name</replaceable>&gt;


</screen>
       </entry>
       <entry>
        <para>
         Creates a thin logical volume or a thin pool of the specified size.
        </para>
        <para>
         Creates thin pool or thin logical volume or both. Specifying the
         optional argument --size will cause the creation of the thin pool
         logical volume. Specifying the optional argument --virtualsize will
         cause the creation of the thin logical volume from given thin pool
         volume. Specifying both arguments will cause the creation of both
         thin pool and thin volume using this pool.
        </para>
       </entry>
      </row>
      <row id="b15cmns0">
       <entry>
<screen>
lvcreate -s [-L <replaceable>size</replaceable>] -n <replaceable>&lt;snap_volume</replaceable>&gt; <replaceable>&lt;source_volume_path</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Creates a snapshot volume for the specified logical volume. If the
         size option (-L, --size) is not included, the snapshot is created
         as a thin snapshot.
        </para>
       </entry>
      </row>
      <row id="btx8b0c">
       <entry>
<screen>
lvremove&lt;<replaceable>/dev/vg_name/lv_name</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Removes a logical volume, such as
         <filename>/dev/vg_name/lv_name</filename>.
        </para>
        <para>
         Before using this command, close the logical volume by dismounting
         it with the <command>umount</command> command.
        </para>
       </entry>
      </row>
      <row id="b15cmns1">
       <entry>
<screen>
lvremove <replaceable>snap_volume_path</replaceable>
</screen>
       </entry>
       <entry>
        <para>
         Removes a snapshot volume.
        </para>
       </entry>
      </row>
      <row id="b15cmns2">
       <entry>
<screen>
lvconvert --merge  [-b] [-i &lt;<replaceable>seconds</replaceable>&gt;] [&lt;<replaceable>snap_volume_path</replaceable>&gt;[...&lt;snapN&gt;]|@&lt;<replaceable>volume_tag</replaceable>&gt;]
</screen>
       </entry>
       <entry>
        <para>
         Reverts (rolls back or merges) the snapshot data into the original
         volume.
        </para>
       </entry>
      </row>
      <row id="btx8b0d">
       <entry>
<screen>
vgextend <replaceable>&lt;vg_name&gt;</replaceable>&lt;<replaceable>device</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Adds a specified physical volume to an existing volume group
        </para>
       </entry>
      </row>
      <row id="btx8b0e">
       <entry>
<screen>
vgreduce <replaceable>&lt;vg_name</replaceable>&gt; &lt;<replaceable>device</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Removes a specified physical volume from an existing volume group.
        </para>
        <important>
         <para>
          Ensure that the physical volume is not currently being used by a
          logical volume. If it is, you must move the data to another
          physical volume by using the <command>pvmove</command> command.
         </para>
        </important>
       </entry>
      </row>
      <row id="btx8b0f">
       <entry>
<screen>
lvextend -L <replaceable>size</replaceable>&lt;<replaceable>/dev/vg_name/lv_name</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Extends the size of a specified logical volume. Afterwards, you
         must also expand the file system to take advantage of the newly
         available space.
        </para>
       </entry>
      </row>
      <row id="btx8b0g">
       <entry>
<screen>
lvreduce -L <replaceable>size</replaceable> <replaceable>&lt;/dev/vg_name/lv_name</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Reduces the size of a specified logical volume.
        </para>
        <important>
         <para>
          Ensure that you reduce the size of the file system first before
          shrinking the volume, otherwise you risk losing data.
         </para>
        </important>
       </entry>
      </row>
      <row id="b11lxo1l">
       <entry>
<screen>
lvrename <replaceable>&lt;/dev/vg_name/old_lv_name</replaceable>&gt; <replaceable>&lt;/dev/vg_name/new_lv_name</replaceable>&gt;
</screen>
       </entry>
       <entry>
        <para>
         Renames an existing LVM logical volume in a volume group from the
         old volume name to the new volume name. It does not change the
         volume group name.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect1>
 </chapter>
