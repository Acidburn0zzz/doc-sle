<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>

<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="sec.basicnet.router">
 <title>Basic Router Setup</title>

 <!-- 2015-09-28, ke: based on fate#317121, converted to DB -->
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker>
   </dm:bugtracker>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <para>The first step is to enable forwarding in e.g. /etc/sysctl.d/50-router.conf</para>
<screen>net.ipv4.conf.all.forwarding = 1                             
net.ipv6.conf.all.forwarding = 1</screen>
<para>and to provide static IPv4 &amp; IPv6 IP setup for the interfaces. Enabling forwarding disables several mechanisms, e.g. IPv6 does not accept IPv6 RA any more, what also causes that there is no default route created any more.</para>
<para>In many situations, when you can reach the same (internal) network via more than one interface or usually if vpn is used (and already on "normal multihome hosts"), you may want/have to disable IPv4 reverse path filter (there is currently no such thing for IPv6):</para>
<screen>net.ipv4.conf.all.rp_filter = 0</screen>
<para>and filter using firewall instead.</para>
<para>To accept a IPv6 RA (from router on external/uplink/ISP interface) and create default (or also more specific) IPv6 route again, you can set</para>
<screen>net.ipv4.conf.${ifname}.accept_ra = 2</screen>
<para>(note: "eth0.42" has to be written as "eth0/42" in a "." separated sysfs path), probably along with</para>
<screen>net.ipv4.conf.${ifname}.autoconf = 0</screen>
<para>
          More router behaviour / forwarding dependencies are described at:
          <a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt</a>
</para>
<para>
          To provide IPv6 on your internal (dmz) interfaces, that is announce yourself as IPv6 router and announce [autoconf networks] to the clients, install and configure radvd in
          <tt>/etc/radvd.conf</tt>
          , e.g.:
        </para>
<screen>interface eth0     
{     
        IgnoreIfMissing on;         # do not fail if interface missed     

        AdvSendAdvert on;           # enable sending RAs     
        AdvManagedFlag on;          # IPv6 addresses managed via DHCPv6     
        AdvOtherConfigFlag on;      # DNS,NTP... only via DHCPv6     

        AdvDefaultLifetime 3600;    # client default route lifetime of 1hour     

        prefix 2001:db8:0:1::/64    # (/64 is default and required for autoconf)     
        {     
            AdvAutonomous off;         # Disable address autoconf (DHCPv6 only)     

            AdvValidLifetime 3600;     # prefix (autoconf addr) is valid 1h     
            AdvPreferredLifetime 1800; # prefix (autoconf addr) is prefered 1/2h     
        }     
}</screen>
<para>Last but not least step is to configure the firewall. In SuSEfirewall2, you have to set  the FW_ROUTE="yes" (otherwise it will also reset forwarding sysctl again) and define the interfaces in the FW_DEV_INT, FW_DEV_EXT (and FW_DEV_DMZ) zone variables as needed, perhaps also FW_MASQUERADE=yes and FW_MASQ_DEV.</para>
</sect1>
