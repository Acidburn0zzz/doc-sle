<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="image_addon_creator.xml" id="cha.addon_creator">
 <title>Add-on Product Creatorを使用したアドオン製品の作成</title>
 <abstract>
  <para>
   アドオンは、お使いの製品で<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>を拡張するために特別に設計されたメディアで、通常はCDまたはDVDの形態をとります。Add-on Product Creatorは、すべてのSUSE製品で顧客や提携先をサポートし、それらの製品でサードパーティソフトウェアの配布を簡素化する目的で開発されました。
  </para>

  <para>
   Add-on Product Creatorを使用するには、SUSEソフトウェア開発キット (SDK)に付属のパッケージ<systemitem class="resource">yast2-add-on-creator</systemitem>をインストールする必要があります。このSDKは、SUSE Linux Enterprise向けのアドオン製品であり、<ulink url="http://download.suse.com/"/>からダウンロードできます。「<literal>SUSE Linux Enterpriseソフトウェア開発キット</literal>」で検索してください。
  </para>
 </abstract>
 <sect1 id="sec.addon_creator.creating">
  <title>イメージの作成</title>

  <para>
   アドオン製品のイメージを作成するには、次の手順に従います。
  </para>

  <procedure>
   <step performance="required">
    <para>
     YaSTを起動して<guimenu>Add-On Creator</guimenu>モジュールを開きます。
    </para>
   </step>
   <step performance="required">
    <para>
     これまでアドオンを作成したことがない場合は、<guimenu>Create an Add-On from the Beginning (最初からアドオンを作成)</guimenu>をクリックして起動します。また、既存のアドオン製品を基にしてアドオンを作成することもできます。目的のデータが格納されているディレクトリへのパスを指定します。このデータとして、マウント済みのISOイメージ、CDやDVDなどを使用できます。
    </para>
    <para>
     すでにアドオンを作成済みの場合は、既存のすべてのアドオンがウィンドウに一覧表示されます。これらを<guimenu>編集</guimenu>または<guimenu>削除</guimenu>できます。新規作成するには<guimenu>追加</guimenu>をクリックします。
    </para>
    <para>
     このチュートリアルでは、<guimenu>アドオンを最初から作成する</guimenu>方法について説明します。
    </para>
   </step>
   <step performance="required">
    <para>
     作成するアドオンの名前(<guimenu>Add-on Product Label (アドオン製品ラベル)</guimenu>)とバージョンを入力し、補足情報を指定します。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       <guimenu>Required Product (目的の製品)</guimenu>で、作成したアドオンを使用するSUSE Linux製品を選択します。
      </para>
     </listitem>
     <listitem>
      <para>
       アドオン製品パッケージを収めるディレクトリへのパスを選択します。
      </para>
     </listitem>
     <listitem>
      <para>
       必要に応じ、RPMパッケージを収めるディレクトリへのパスを<guimenu>Required Product (目的の製品)</guimenu>で選択します。多くの場合、これらのパッケージは、すでに選択している目的の製品が基になっているものであり、アドオン自体を構成する要素ではありません。しかし、このアドオンから作成する他のパッケージでは、これらのパッケージを必要とします。これらのパッケージは、アドオン製品には追加されませんが、パターンの作成に使用できます。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     <guimenu>次へ</guimenu>で続行します。
    </para>
   </step>
   <step performance="required">
    <para>
     各インストールメディアには、コンテンツファイルと、アドオン製品を定義している製品ファイルが収められています。このダイアログを使用して、両方のファイルに対してデータを指定します。いずれかのエントリを選択し、<guimenu>編集</guimenu>を選択して値を設定または変更します。エントリをダブルクリックすることでも同様の操作ができます。詳しい情報と使用できる値については<guimenu>ヘルプ</guimenu>を参照してください。
    </para>
    <para>
     既存のコンテンツまたは製品のファイルから値をインポートするには、該当の<guimenu>インポート</guimenu>ボタンを選択します。
    </para>
    <para>
     コンテンツファイルの<guimenu>Product architectures (製品のアーキテクチャ)</guimenu>、<guimenu>Product name (製品名)</guimenu>、および<guimenu>Vendor name (ベンダ名)</guimenu>は必ず入力する必要があります。<guimenu>次へ</guimenu>で続行します。
    </para>
   </step>
   <step performance="required">
    <para>
     次の画面でパッケージの説明を入力または変更します。新しい言語を挿入し、翻訳された説明を追加するには、<guimenu>言語を追加する</guimenu>を使用します。<guimenu>インポート</guimenu>で既存のパッケージの説明をインポートすることもできます。
    </para>
    <para>
     <guimenu>次へ</guimenu>で続行します。
    </para>
   </step>
   <step performance="required">
    <para>
     必要に応じて、次のステップでパターンを追加します。パターンを使用してRPMパッケージをグループ化できます。<guimenu>新規</guimenu>を使用すると、新しいパターン名を追加して次のリスト内のそれぞれの属性を変更できます。アドオン製品をインストールする際にインストールに合わせて自動的に選択状態にするパターンの<guimenu>Required Pattern (目的のパターン)</guimenu>をチェックします。
    </para>
    <para>
     <guimenu>次へ</guimenu>で続行します。
    </para>
   </step>
   <step performance="required">
    <para>
     出力ディレクトリへのパスを指定します。ISOイメージを作成する場合は、<guimenu>Create ISO Image (ISOイメージの作成)</guimenu>をチェックしてファイル名を指定します。目的の製品に付属するすべてのパッケージの変更ログを収めたファイルを作成するには<guimenu>Create Changelog (変更ログの作成)</guimenu>を選択します。また、以下の手順で、ワークフローを変更してファイルを追加することもできます。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       <guimenu>ワークフローの設定</guimenu>を使用し、製品ワークフローをカスタマイズするファイルを入力します。この方法で、たとえば、製品が正常に動作するために必要なオプションを備えた補足のダイアログを、アドオンのインストールプロセスに追加できます。詳細については<guimenu>ヘルプ</guimenu>を参照してください。
      </para>
     </listitem>
     <listitem>
      <para>
       アドオン製品に次のファイルを追加するには<guimenu>オプションファイル</guimenu>を使用します。
      </para>
      <variablelist>
       <varlistentry>
        <term><guimenu>info.txt</guimenu>
        </term>
        <listitem>
         <para>
          アドオン製品に関する一般的な情報を収めたテキストファイル
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>ライセンスファイル</guimenu>
        </term>
        <listitem>
         <para>
          さまざまな言語でライセンス情報を収めたファイルを追加します。このファイルには<literal>license.<replaceable>LANGUAGE</replaceable></literal>という名前が割り当てられます。たとえば、<filename>license.en_US</filename>となります。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>READMEファイル</term>
        <listitem>
         <para>
          任意の名前を指定してREADMEファイルを追加します。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       それぞれのテキストボックスにファイルのコンテンツを入力します。既存のファイルからコンテンツを<guimenu>インポート</guimenu>することもできます。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     <guimenu>次へ</guimenu>で続行します。
    </para>
   </step>
   <step performance="required">
    <para>
     アドオン製品にGPGキーで署名し、製品の出自を証明できるようにします。キーがない場合は、キーを作成してからそれぞれのパスフレーズを2回入力します。
    </para>
   </step>
   <step performance="required">
    <para>
     設定の概要で設定を確認し、<guimenu>完了</guimenu>をクリックして続行します。設定を変更するには<guimenu>Back (戻る)</guimenu>ボタンを選択します。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.addon_creator.structure">
  <title>アドオンの構造</title>

  <para>
   アドオン製品には、以下のファイルとディレクトリが収められています。
  </para>

  <variablelist>
   <varlistentry>
    <term><filename>ARCHIVES.gz</filename>
    </term>
    <listitem>
     <para>
      付属しているすべてのパッケージに関する情報を収めています(各パッケージの<command>rpm -qil</command>出力)。このファイルはgzipで圧縮されています。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>Changelog</filename>
    </term>
    <listitem>
     <para>
      RPMファイルに対するすべての変更点を、その変更日順に収めています。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>content</filename>
    </term>
    <listitem>
     <para>
      アドオンのセットアップで作成されたコンテンツファイル。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>content.asc</filename>
    </term>
    <listitem>
     <para>
      GPG署名ファイル。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>content.key</filename>, <filename>gpg-pubkey-<replaceable>NUMBER</replaceable>.asc</filename>
    </term>
    <listitem>
     <para>
      GPG公開鍵
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>INDEX.gz</filename>
    </term>
    <listitem>
     <para>
      すべてのRPMファイルのリスト。このファイルはgzipで圧縮されています。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>ls-lR.gz</filename>
    </term>
    <listitem>
     <para>
      アドオン製品のメディアに収録されているすべてのファイルとディレクトリの一覧。このファイルはgzipで圧縮されています。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>media.<replaceable>N</replaceable>/</filename>
    </term>
    <listitem>
     <para>
      アドオンメディアセットの基本情報を含むファイルが格納されています。ディレクトリには番号が付けられており、<filename>media.1/</filename>は1つ目のアドオンメディアです(DVD1など)。他にもメディアがある場合はこれに続く番号が付けられます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>suse/</filename>
    </term>
    <listitem>
     <para>
      アーキテクチャ固有の情報を格納するサブディレクトリを含みます。例外は、アーキテクチャに依存しないパッケージ用の<filename>noarch/</filename>と、ソースパッケージ用の<filename>src/</filename>です。専有ソフトウェアパッケージは<filename>nosrc/</filename>に格納されています。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
