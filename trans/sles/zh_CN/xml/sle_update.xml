<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="sle_update.xml" id="cha.update.sle">
 <title>更新 SUSE Linux Enterprise</title>
 <abstract>
  <para>
   SUSE® Linux Enterprise (SLE) 允许您将现有系统更新到新版本，例如，从 SLE 11 SP3 更新到 SLE 12。不需新安装。主目录和数据目录以及系统配置等现有数据将保持不变。您可以从本地 CD 或 DVD 驱动器或从中央网络安装源进行更新。
  </para>

  <para>
   如果您基本上已经熟悉 SUSE Linux Enterprise 更新、升级和服务包，可以查看术语小节了解最新信息，然后直接浏览到更新概述小节。这里会显示可能会有的可用更新，并提供有关计划总体更新以及后续部分的指导：更新到最新版本 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productname"><phrase os="sles;sled;slerte">12</phrase></phrase> 的逐步指导。
  </para>

  <para>
   本章的其余部分提供了 SUSE 产品生命周期和服务包版本的背景信息、建议的升级策略、SUSE Linux Enterprise 软件相对于非最新版本号的更新程度（即“向后移植”），以及逐步更新指导参照的其他材料。
  </para>

 </abstract>
 <sect1 id="sec.update.terminology">
  <title>背景信息：术语</title>

  <para>
   本章使用了若干术语。为了理解该信息，请阅读以下定义：
  </para>

  <variablelist>
   <varlistentry>
    <term>向后移植</term>
    <listitem>
     <para>
      向后移植是指通过较新版本的软件采取特定的更改，然后将这些更改应用到较旧版本的做法。最常见的用例是修复较旧软件组件中的安全漏洞。通常，它也是用于提供增强或新功能（不太常见）的维护模型的一部分。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>

    <term>增量 RPM</term>
    <listitem>
     <para>
      增量 RPM 仅包含某个包的两个已定义版本之间的有区别二进制文件，因此其下载大小最小。安装前，需要在本地计算机上重构建完整 rpm 包。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>下游</term>
    <listitem>
     <para>
      开放源代码领域中的软件开发方式的形象说法（与<emphasis>上游</emphasis>相对）。<emphasis>下游</emphasis>一词指从上游将源代码与其他软件集成，从而构建供最终用户使用的发行套件的人员或组织，例如 SUSE。因此，软件将从其开发者开始，通过集成者向下游流向最终用户。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>扩展</term>
    <term>外接式附件产品</term>
    <listitem>
     <para>
      
      扩展（也称为附加产品）为 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 的产品价值提供附加功能。它们由 SUSE 及 SUSE 的合作伙伴提供，并且在基本产品 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 的基础上注册和安装。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>模块</term>
    <listitem>
     
     
       <para>
        模块则全部由 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 负责支持，其生命周期也不同。它们都有明确定义的范围，只通过联机通道提供。在 SUSE Customer Center 上注册产品是能够订阅这些通道的前提。
      </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>联机迁移</term>
    <listitem>
     <para>
      通过使用联机更新工具（而不是安装媒体）对服务包 (SP) 进行更新，以安装相关的增补程序。它会将安装的系统的所有包更新到 SP3 加 SP2 更新的最新状态（包括更新）。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>

    <term>包</term>
    <listitem>
     <para>
      包是 <literal>rpm</literal> 格式的压缩文件，其中包含特定程序的所有文件，包括配置、示例和文档等可选组件。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>

    <term>增补程序</term>
    <listitem>
     <para>
      增补程序由一个或多个包组成，可通过增量 RPM 方式应用。它也可能带来与尚未安装的包的依赖性。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>主要版本</term>
    <term>正式发布 (GA) 版本</term>
    <listitem>
     <para>
      SUSE Linux Enterprise（或任何软件产品）的主要版本是一个新版本，其中会引入一些新功能和工具，去除之前弃用的组件，并进行一些不向后兼容的更改。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>服务包 (SP)</term>
    <listitem>
     <para>
      将几个增补程序合并到便于安装或部署的一个组织体中。服务包是有编号的并通常包含安全性修复、更新、升级或程序增强。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>上游</term>
    <listitem>
     <para>
      开放源代码领域中的软件开发方式的形象说法（与<emphasis>下游</emphasis>相对）。术语<emphasis>上游</emphasis>表示以源代码形式分发的软件的原始项目、作者或维护者。反馈、增补程序、功能增强或其他改进措施将从最终用户或贡献者流向上游开发者。开发者决定是要集成还是拒绝请求。
     </para>
     <para>
      如果项目成员决定集成请求，则会在更新版本的软件中显示这一点。接受的请求将为所有相关方带来好处。
     </para>
     <para>
      如果某个请求未被接受，则可能是因其他原因而遭到拒绝。原因是该请求的状态不符合项目的准则、该请求无效、已集成该请求，或者它不在项目的考虑范围或路线图内。未被接受的请求会给上游开发者带来不利，因为他们需要将其增补程序与上游代码同步。通常会避免这种做法，但有时仍有必要予以采取。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term>更新</term>
    <listitem>
     <para>
      安装包的更新<emphasis>次要</emphasis>版本。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>升级</term>
    <listitem>
     <para>
      安装包或分发包的更新<emphasis>主要</emphasis>版本，引入<emphasis>新功能</emphasis>。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>


 <sect1 id="sec.update.proc.prep.paths">
  <title>支持的 SLE 升级路径</title>

  <abstract>
   <para>
    SUSE Linux Enterprise 支持直接从一个版本升级到下一个版本。例如，如果您当前运行的是 SUSE Linux Enterprise 11 SP2，您将分两步升级：先升级到 SUSE Linux Enterprise 11 SP3，然后再升级到 SUSE Linux Enterprise 12。
   </para>

   <para>
    更新时不能跳过中间版本。因此，如果您运行的产品低了数个版本，如 SUSE Linux Enterprise 10 或 SUSE Linux Enterprise 11 SP1，SUSE 建议您考虑全新安装，而不是走漫长的升级之路。
   </para>

  </abstract>
  <important>
   <title>不支持跨体系结构升级</title>
   <para>
    <emphasis>不</emphasis>支持跨体系结构升级！例如从 32 位版本的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 升级到 64 位版本，或者从大字节序升级到小字节序。
   </para>
   <para>
    具体地说，<emphasis>不</emphasis>支持从 SLE 11 SP3 on POWER（大字节序）升级到 SLE 12 on POWER（新增：小字节序）。
   </para>
   <para>
    另外，由于 SUSE Linux Enterprise 12 只有 64 位版本，所以<emphasis>不</emphasis>支持从任何 32 位 SUSE Linux Enterprise 11 系统升级到 SUSE Linux Enterprise 12。
   </para>
  </important>

  <variablelist>
   <varlistentry>
    <term>从 SUSE Linux Enterprise 10（任何服务包）升级</term>
    <listitem>
     <para>
      不支持直接迁移到 SUSE Linux Enterprise 12。建议使用全新安装方式。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>从 SUSE Linux Enterprise 11 GA 或 SUSE Linux Enterprise 11 SP1 升级</term>
    <listitem>
     <para>
      不支持直接迁移到 SUSE Linux Enterprise 12。
     </para>
     <para>
      如果您无法进行全新安装，则需要先从 SUSE Linux Enterprise 11 GA 升级到 SP1，再从 SUSE Linux Enterprise 11 SP1 升级到 SP2，然后才能继续。<ulink url="https://www.suse.com/documentation/sles11/">《SUSE Linux Enterprise 11 部署指南》</ulink>中在线说明了这些前提步骤。
     </para>
     <para>
      然后，您便可以继续下一步：
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>从 SUSE Linux Enterprise 11 SP2 升级</term>
    <listitem>
     <para>
      首先，将系统升级到 SUSE Linux Enterprise 11 SP3。有关详细信息，请参见<xref linkend="sec.update.sle11sp2"/>。
     </para>
     <para>
      然后继续下一步：
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>从 SUSE Linux Enterprise 11 SP3 升级到 SUSE Linux Enterprise 12</term>
    <listitem>
     <para>
      有关详细信息，请参见<xref linkend="sec.update.sle12"/>。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="sec.update.prep">
  <title>有关更新的一般准备工作</title>

  <para>
   在开始更新过程之前，请确保对您的系统进行适当的准备。这些准备工作包括备份数据，查看发行说明，以及其他工作。
  </para>

  <sect2 id="sec.update.prep.relnotes">
   <title>检查发行说明</title>
   <para>
    在发行说明中，您可以找到有关自 SUSE Linux Enterprise 的上一个版本发行后进行了哪些更改的其他信息。请在发行说明中确认您的特定硬件或设置是否需要考虑某些特殊注意事项、您喜爱的哪些特定软件包进行了大幅更改，以及除了本节中的一般性建议之外，您还应该采取哪些预防措施。发行说明还提供了最新信息和已知问题，这些信息无法及时编入本手册中。
   </para>
   <para>
    您可以在 <ulink url="http://www.suse.com/doc/sles12/#start"/> 上在线阅读包含 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 最新信息的最新版发行说明文档。
   </para>
  </sect2>

  <sect2 id="sec.update.prep.backup">
   <title>创建备份</title>
   <para>
    在更新之前，请将现有配置文件复制到单独一个媒体（如磁带设备、可卸硬盘等）上，用以备份数据。这主要适用于储存在 <filename>/etc</filename> 中的文件以及 <filename>/var</filename> 和 <filename>/opt</filename> 中的一些目录和文件。最好将 <filename>/home</filename>（<envar>HOME</envar> 目录）中的用户数据也写入备份媒体。以 <systemitem class="username">root</systemitem> 用户的身份备份此数据。仅 <systemitem class="username">root</systemitem> 用户对所有本地文件具有读许可权限。
   </para>
   <para>
    如果您已在 YaST 中选择<guimenu>更新现有系统</guimenu>作为安装模式，则可以选择在以后的某个时间执行（系统）备份。您可以选择包含所有已修改的文件以及 <filename>/etc/sysconfig</filename> 目录中的文件。但是，此备份尚不完整，因为缺少了上述所有其他重要目录。在 <filename>/var/adm/backup</filename> 目录中查找备份。
   </para>
  </sect2>

  <sect2 id="sec.update.prep.disks">
   <title>分区和磁盘空间</title>
   <para>
    在开始更新之前，记录必要的根分区信息。命令 <command>df /</command> 可以列出根分区的设备名。例如，在 <xref linkend="aus.update.df"/> 中，要记录的根分区为 <filename>/dev/sda3</filename>（作为 <filename>/</filename> 装入）。
   </para>
   <example id="aus.update.df">
    <title>使用 <command>df -h</command> 列示信息</title>

<screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       44G    4G   40G   9% /data</screen>
   </example>
   <para>
    从旧版本到新版本，软件的大小有<quote>增长</quote>的趋势。因此，在进行更新之前，请使用 <command>df</command> 查看可用分区空间。如果怀疑磁盘空间不足，请在更新和重分区系统前保证数据安全。对于每个分区应该具有多少空间，没有一般的经验可以借鉴。空间要求取决于特定的分区配置文件和选定的软件。
   </para>
  </sect2>

  <sect2 id="sec.update.prep.vms">
   <title>关闭虚拟机 Guest</title>
   <para>
    如果您的计算机充当 KVM 或 Xen 的 VM 主机服务器，请确保在更新之前关闭所有正在运行的 VM Guest。否则，更新后您可能无法访问 guest。
   </para>
  </sect2>

 </sect1>
 <sect1 id="sec.update.sle11sp2">
  <title>中间步骤：将 SLE 11 SP2 升级到 SLE 11 SP3</title>
  <para>
   以下工具支持联机迁移：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <guimenu>YaST wagon</guimenu>（图形用户界面）
    </para>
   </listitem>
   <listitem>
    <para>
     <command>zypper</command>（命令行）
    </para>
   </listitem>
  </itemizedlist>

  <para>
   如果通过联机迁移更新您的系统，则会在系统运行时执行更新。更新完毕后，您只需要重引导一次。您仍然可以使用以下备用方法执行更新：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <xref linkend="sec.update.sle11spx.medium"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec.update.sle11spx.smt"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec.update.sle11spx.manager"/>
    </para>
   </listitem>
  </itemizedlist>

  <sect2 id="sec.update.sle11sp3.online.requirements">
   <title>要求</title>
   <para>
    要执行联机更新，必须符合以下要求。另外，请确保阅读<xref linkend="sec.update.prep"/>。
   </para>
   <variablelist>
    <varlistentry>
     <term>产品注册</term>
     <listitem>
      <para>
       要能够连接到更新储存库，您的产品必须经过注册。如果未注册，请在 YaST 中运行 <guimenu>SUSE Customer Center 配置</guimenu>模块，或使用 <command>suse_register</command> 命令行工具开始注册。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>运行联机更新</term>
     <listitem>
      <para>
       确保已在当前安装的版本中安装了最新的增补程序。在执行联机迁移之前运行联机更新。使用图形界面时，请启动 YaST 联机更新或更新程序小程序。在命令行上运行以下命令（最后一条命令需要运行两次）：
      </para>
<screen>zypper ref -s
zypper update -t patch
zypper update -t patch</screen>
      <para>
       需要时请重引导系统。
      </para>
      <para>
       请参见<xref linkend="cha.onlineupdate.you"/>或<xref linkend="sec.zypper.softup"/>，以获取有关联机更新工具的更多信息。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>第三方软件</term>
     <listitem>
      <para>
       如果您的设置包含第三方软件或外接式附件软件，则在另一台计算机上测试此过程以确保升级未破坏依赖性。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <important>
    <title>始终运行完整的联机迁移</title>
    <para>
     始终要自始而终地完成整个联机迁移过程。如果联机迁移中途中断，则会损坏系统且无法恢复。
    </para>
   </important>
  </sect2>

  <sect2 id="sec.update.sle11sp3.online.wagon">
   <title>使用 YaST <guimenu>Wagon</guimenu> 执行联机迁移</title>
   <procedure>
    <step performance="required">
     <para>
      如果符合所有要求（参见<xref linkend="sec.update.sle11spx.online.requirements"/>），托盘中的更新小程序将显示一条讯息，表示有可用的分发包升级。单击它以启动 YaST <guimenu>Wagon</guimenu>。或者，以 <systemitem class="username">root</systemitem> 身份从命令行运行 <command>/usr/sbin/wagon</command>。
     </para>
    </step>
    <step performance="required">
     <para>
      单击<guimenu>下一步</guimenu>以确认<guimenu>欢迎</guimenu>对话框。
     </para>
    </step>
    <step performance="required">
     <para>
      如果 <guimenu>Wagon</guimenu> 发现不符合要求（必需的维护更新可用，但尚未安装），它将会自动执行自助更新，这可能需要重引导计算机。按屏幕上的说明进行操作。
     </para>
    </step>
    <step performance="required">
     <para>
      在后续对话框中选择更新方法。选择<guimenu>客户中心</guimenu>以使用默认设置（推荐）。
     </para>
     <para>
      单击<guimenu>自定义 URL</guimenu> 以手动选择用于联机迁移的软件储存库。储存库列表即会显示，其中提供了用于手动启用、禁用、添加或删除储存库的选项。添加 SP3 更新源更新源可以是 SP3 安装媒体，也可以是 <literal>SP3-Pool</literal> 和 <literal>SP3-Updates</literal> 储存库。单击<guimenu>确定</guimenu>返回到<guimenu>更新方法</guimenu>对话框。
     </para>
     <para>
      如果您想查看更新过程导致储存库设置发生的的更改，请选择<guimenu>检查储存库的自动更改</guimenu>。
     </para>
     <para>
      按<guimenu>下一步</guimenu>继续。
     </para>
    </step>
    <step performance="required">
     <para>
      随后将重新注册系统。在此过程中，<literal>SP3-Pool</literal> 和 <literal>SP3-Updates</literal> 储存库将会添加到系统中（有关详细信息，请参见<xref linkend="sec.update.nmm.repositories"/>）。确认添加储存库。
     </para>
    </step>
    <step performance="required">
     <para>
      如果您在<guimenu>更新方式</guimenu>对话框中选择了<guimenu>检查储存库的自动更改</guimenu>，此时储存库列表将会显示，供您选择手动启用、禁用、添加或删除储存库。完成后单击<guimenu>确定</guimenu>继续。
     </para>
    </step>
    <step performance="required">
     <para>
      系统会打开<guimenu>分发升级设置</guimenu>屏幕，其中显示了升级配置的摘要。提供了以下部分：
     </para>
     <variablelist>
      <varlistentry>
       <term><guimenu>附加产品</guimenu>
       </term>
       <listitem>
        <para>
         您可以在这里添加 SUSE Linux Enterprise Server 附加产品或第三方产品。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>更新选项</guimenu>
       </term>
       <listitem>
        <para>
         列出在更新期间将要执行的操作。您可以选择先下载所有包，然后一并安装（推荐的默认设置），也可以选择逐个下载包并逐个安装。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>包</guimenu>
       </term>
       <listitem>
        <para>
         更新的统计概述。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>备份</term>
       <listitem>
        <para>
         设置备份选项。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      依次单击<guimenu>下一步</guimenu>和<guimenu>开始更新</guimenu>以继续。
     </para>
     <important>
      <title>中止联机迁移</title>
      <para>
       在单击<guimenu>开始更新</guimenu><emphasis>之前</emphasis>，您可以安全地在此屏幕以及所有先前的屏幕上中止联机迁移。单击<guimenu>中止</guimenu>将会退出更新过程，并将系统恢复到启动 YaST Wagon 之前的状态。在退出 Wagon 之前，请按照屏幕上的指导操作并重新进行注册，以从系统中去除 SP2 储存库。
      </para>
     </important>
    </step>
    <step performance="required">
     <para>
      在更新过程中，将执行以下步骤：
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        更新包。
       </para>
      </step>
      <step performance="required">
       <para>
        重引导系统（按<guimenu>确定</guimenu>）。
       </para>
      </step>
      <step performance="required">
       <para>
        重新注册最近更新的系统。
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      您的系统已成功更新到服务包 3。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.update.sle11sp3.online.zypper">
   <title>使用 <command>zypper</command> 执行联机迁移</title>
   <procedure>
    <step performance="required">
     <para>
      如果符合所有要求（参见<xref linkend="sec.update.sle11spx.online.requirements"/>），则意味着执行联机迁移所需的<quote>产品</quote>已添加到 <filename>/etc/products.d</filename> 中。运行以下命令可获取这些产品的列表：
     </para>

<screen>zypper se -t product | grep -h -- "-migration" | cut -d'|' -f2</screen>
     <para>
      此命令至少应返回 <literal os="sles">SUSE_SLES-SP3-migration</literal>。根据安装的范围，可能会列出更多的产品。
     </para>
    </step>
    <step performance="required">
     <para>
      使用命令 <command>zypper in -t product <replaceable>产品列表</replaceable></command>安装上一步骤检索到的迁移产品，例如：
     </para>
<screen os="sles">zypper in -t product SUSE_SLES-SP3-migration</screen>

    </step>
    <step performance="required">
     <para>
      注册上一步中安装的产品，以获取相应的更新储存库：
     </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
    </step>
    <step performance="required">
     <para>
      刷新安装源和服务：
     </para>
<screen>zypper ref -s</screen>
    </step>
    <step performance="required">
     <para>
      使用 <command>zypper lr</command> 检查您可以检索的安装源列表。
     </para>
     <para>
      如果未启用其中的任一安装源（在遵循此工作流程时，默认情况下不启用 <literal>SP3</literal> 安装源），请使用 <command>zypper modifyrepo --enable <replaceable>安装源别名</replaceable></command>启用该安装源，例如：
     </para>
<screen os="sles">zypper modifyrepo --enable SLES11-SP3-Core SLES11-SP3-Updates</screen>

     <para>
      如果您的设置包含可能与 SP3 不兼容的第三方安装源，请使用 <command>zypper modifyrepo --disable <replaceable>安装源别名</replaceable></command>禁用这些安装源。
     </para>
    </step>
    <step performance="required">
     <para>
      现在所有工作准备就绪，可以使用 <command>zypper dup --from <replaceable>REPO 1</replaceable> --from <replaceable>REPO 2</replaceable> <replaceable>...</replaceable></command> 执行分发包升级了。确保使用 <option>--from</option> 列出全部所需的安装源，例如：
     </para>
<screen os="sles">zypper dup --from SLES11-SP3-Pool --from SLES11-SP3-Updates</screen>

     <para>
      按 <guimenu>y</guimenu> 确认开始升级。
     </para>
    </step>
    <step performance="required">
     <para>
      在通过上一步骤完成分发包升级后，请运行以下命令：
     </para>
<screen>zypper update -t patch</screen>
    </step>
    <step performance="required">
     <para>
      在完成升级到 SP3 之后，您需要重新注册产品：
     </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
    </step>
    <step performance="required">
     <para>
      最后，重引导您的系统。
     </para>
    </step>
    <step performance="required">
     <para>
      您的系统已成功更新到服务包 3。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.update.sle11spx.online">
   <title>联机迁移</title>
   <para>
    可以从运行中的系统内部，通过联机迁移完成系统更新。更新完毕后，您只需要重引导一次。
   </para>
   <sect3 id="sec.update.sle11spx.online.requirements">
    <title>要求</title>
    <para>
     要执行联机更新，必须符合以下要求。另外，请确保阅读<xref linkend="sec.update.prep"/>。
    </para>
    <variablelist>
     <varlistentry>
      <term>产品注册</term>
      <listitem>
       <para>
        要能够连接到更新储存库，您的产品需要经过注册。如果未注册，请在 YaST 中运行 <guimenu>SUSE Customer Center 配置</guimenu>模块，或使用 <command>suse_register</command> 命令行工具开始注册。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>运行联机更新</term>
      <listitem>
       <para>
        确保已在当前安装的版本中安装了最新的增补程序。在执行联机迁移之前运行联机更新。使用图形界面时，请启动 YaST 联机更新或更新程序小程序。在命令行上运行以下命令（最后一条命令需要运行两次）：
       </para>
<screen>zypper ref -s
zypper update -t patch
zypper update -t patch</screen>
       <para>
        需要时请重引导系统。
       </para>
       <para>
        请参见<xref linkend="cha.onlineupdate.you"/>或<xref linkend="sec.zypper.softup"/>，了解有关联机更新工具的更多信息。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>第三方软件</term>
      <listitem>
       <para>
        如果您的设置包含第三方软件或外接式附件软件，则在另一台计算机上测试此过程以确保升级未破坏依赖性。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <important>
     <title>始终运行完整的联机迁移</title>
     <para>
      在任何情况下，都需要从头到尾完成整个联机迁移过程。如果联机迁移中途中断，则会损坏系统且无法恢复。
     </para>
    </important>
   </sect3>
   <sect3 id="sec.update.sle11spx.online.wagon">
    <title>使用 YaST <guimenu>Wagon</guimenu> 执行联机迁移</title>
    <note>
     <para>
      使用 YaST Wagon 进行联机迁移这种方式仅适用于 SUSE Linux Enterprise Server 12 之前的产品。
     </para>
    </note>
    <procedure>
     <step performance="required">
      <para>
       如果符合所有要求（参见<xref linkend="sec.update.sle11spx.online.requirements"/>），托盘中的更新小程序将显示一条讯息，表示有可用的分发包升级。单击它以启动 YaST <guimenu>Wagon</guimenu>。或者，以 <systemitem class="username">root</systemitem> 身份从命令行运行 <command>/usr/sbin/wagon</command>。
      </para>
     </step>
     <step performance="required">
      <para>
       单击<guimenu>下一步</guimenu>以确认<guimenu>欢迎</guimenu>对话框。
      </para>
     </step>
     <step performance="required">
      <para>
       如果 <guimenu>Wagon</guimenu> 发现不符合要求（必需的维护更新可用，但尚未安装），它将会自动执行自助更新，这可能需要重引导计算机。按屏幕上的说明进行操作。
      </para>
     </step>
     <step performance="required">
      <para>
       在后续对话框中选择更新方法。选择<guimenu>客户中心</guimenu>以使用默认设置（推荐）。
      </para>
      <para>
       单击<guimenu>自定义 URL</guimenu> 以手动选择用于联机迁移的软件储存库。储存库列表即会显示，其中提供了用于手动启用、禁用、添加或删除储存库的选项。添加 SP2 更新源更新源可以是 SP2 安装媒体，也可以是 <literal>SP2-Core</literal> 和 <literal>SP2-Updates</literal> 储存库。单击<guimenu>确定</guimenu>返回到<guimenu>更新方法</guimenu>对话框。
      </para>
      <para>
       如果您想查看更新过程导致储存库设置发生的的更改，请选择<guimenu>检查储存库的自动更改</guimenu>。
      </para>
      <para>
       按<guimenu>下一步</guimenu>继续。
      </para>
     </step>
     <step performance="required">
      <para>
       随后将重新注册系统。在此过程中，<literal>SP2-Core</literal> 和 <literal>SP2-Updates</literal> 储存库将会添加到系统中（有关详细信息，请参见<xref linkend="sec.update.nmm.repositories"/>）。确认添加储存库。
      </para>
     </step>
     <step performance="required">
      <para>
       如果您在<guimenu>更新方式</guimenu>对话框中选择了<guimenu>检查储存库的自动更改</guimenu>，此时储存库列表将会显示，供您选择手动启用、禁用、添加或删除储存库。完成后单击<guimenu>确定</guimenu>继续。
      </para>
     </step>
     <step performance="required">
      <para>
       选择迁移类型：
      </para>
      <variablelist>
       <varlistentry>
        <term><guimenu>完整迁移</guimenu>
        </term>
        <listitem>
         <para>
          将所有包更新到最新的 SP2 级别。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>最小迁移</guimenu>
        </term>
        <listitem>
         <para>
          将最低限度的一组包更新到最新的 SP2 级别。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       单击<guimenu>高级</guimenu>可以手动选择用于升级的安装源。
      </para>
      <para>
       确认所做的选择。
      </para>
     </step>
     <step performance="required">
      <para>
       系统会打开<guimenu>分发升级设置</guimenu>屏幕，其中显示了升级配置的摘要，提供了以下部分：
      </para>
      <variablelist>
       <varlistentry>
        <term><guimenu>附加产品</guimenu>
        </term>
        <listitem>
         <para>
          您可以在这里添加 SUSE Linux Enterprise Server 附加产品或第三方产品。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>更新选项</guimenu>
        </term>
        <listitem>
         <para>
          列出在更新期间将要执行的操作。您可以选择先下载所有包，然后一并安装（推荐的默认设置），也可以选择逐个下载包并逐个安装。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>包</guimenu>
        </term>
        <listitem>
         <para>
          更新的统计概述。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>备份</term>
        <listitem>
         <para>
          设置备份选项。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       依次单击<guimenu>下一步</guimenu>和<guimenu>开始更新</guimenu>以继续。
      </para>
      <important>
       <title>中止联机迁移</title>
       <para>
        在单击<guimenu>开始更新</guimenu><emphasis>之前</emphasis>，您可以安全地在此屏幕以及所有先前的屏幕上中止联机迁移。单击<guimenu>中止</guimenu>将会退出更新过程，并将系统恢复到启动 YaST Wagon 之前的状态。在退出 Wagon 之前，请按照屏幕上的指导操作并重新进行注册，以从系统中去除 SP2 储存库。
       </para>
      </important>
     </step>
     <step performance="required">
      <para>
       在更新过程中，将执行以下步骤：
      </para>
      <substeps performance="required">
       <step performance="required">
        <para>
         更新包。
        </para>
       </step>
       <step performance="required">
        <para>
         重引导系统（按<guimenu>确定</guimenu>）。
        </para>
       </step>
       <step performance="required">
        <para>
         重新注册最近更新的系统。
        </para>
       </step>
      </substeps>
     </step>
     <step performance="required">
      <para>
       您的系统已成功更新到服务包 2。
      </para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="sec.update.sle11spx.online.zypper">
    <title>使用 <command>zypper</command> 执行联机迁移</title>
    <procedure>
     <step performance="required">
      <para>
       如果符合所有要求（参见<xref linkend="sec.update.sle11spx.online.requirements"/>），则意味着执行联机迁移所需的<quote>产品</quote>已添加到 <filename>/etc/products.d</filename> 中。运行以下命令可获取这些产品的列表：
      </para>

<screen>zypper se -t product | grep -h -- "-migration" | cut -d'|' -f2</screen>
      <para>
       此命令至少应返回 <literal os="sles">SUSE_SLES-SP2-migration</literal>。根据安装的范围，可能会列出更多的产品。
      </para>
     </step>
     <step performance="required">
      <para>
       使用命令 <command>zypper in -t product <replaceable>产品列表</replaceable></command>安装上一步骤检索到的迁移产品，例如：
      </para>
<screen os="sles">zypper in -t product SUSE_SLES-SP2-migration</screen>

     </step>
     <step performance="required">
      <para>
       注册上一步中安装的产品，以获取相应的更新储存库：
      </para>
<screen>suse_register -d 2 -L /root/.suse_register.log'</screen>
     </step>
     <step performance="required">
      <para>
       再次刷新安装源和服务：
      </para>
<screen>zypper ref -s</screen>
     </step>
     <step performance="required">
      <para>
       使用 <command>zypper lr</command> 检查您可以检索的安装源列表。<emphasis>至少</emphasis>需要<guimenu>启用</guimenu>以下安装源：
      </para>
      <itemizedlist os="sles" mark="bullet" spacing="normal">
       <listitem>
        <para>
         <literal>SLES11-SP1-Pool</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>SLES11-SP1-Updates</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>SLES11-SP2-Core</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>SLES11-SP2-Updates</literal>
        </para>
       </listitem>
      </itemizedlist>
      
      <para>
       根据安装的范围，可能需要启用附加产品或扩展的其他安装源。
      </para>
      <para>
       如果未启用其中的某个安装源（在遵循此工作流程时，默认情况下不启用 <literal>SP2</literal> 安装源），请使用 <command>zypper modifyrepo --enable <replaceable>安装源别名</replaceable></command>启用该安装源，例如：
      </para>
<screen os="sles">zypper modifyrepo --enable SLES11-SP2-Core SLES11-SP2-Updates</screen>

      <para>
       如果您的设置包含可能与 SP2 不兼容的第三方安装源，请使用 <command>zypper modifyrepo --disable <replaceable>安装源别名</replaceable></command>禁用这些安装源。
      </para>
     </step>
     <step performance="required">
      <para>
       现在所有工作准备就绪，可以使用 <command>zypper dup --from <replaceable>REPO 1</replaceable> --from <replaceable>REPO 2</replaceable> <replaceable>...</replaceable></command> 执行分发包升级了。确保使用 <option>--from</option> 列出全部所需的安装源，例如：
      </para>
<screen os="sles">zypper dup --from SLES11-SP2-Core --from SLES11-SP2-Updates</screen>

      <para>
       按 <guimenu>y</guimenu> 确认开始升级。
      </para>
     </step>
     <step performance="required">
      <para>
       在上一步骤中完成分发包升级后，会执行最小迁移（已将最低限度的一组包更新到最新的 SP2 级别）。如果您不打算执行完整迁移，请跳过此步骤。
      </para>
      <para>
       要执行完整迁移（将所有包更新到最新的 SP2 级别），请运行以下命令：
      </para>
<screen>zypper update -t patch</screen>
     </step>
     <step performance="required">
      <para>
       在完成升级到 SP2 之后，您需要重新注册产品：
      </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
     </step>
     <step performance="required">
      <para>
       最后，重引导您的系统。
      </para>
     </step>
     <step performance="required">
      <para>
       您的系统已成功更新到服务包 2。
      </para>
     </step>
    </procedure>
   </sect3>
  </sect2>

  <sect2 id="sec.update.sle11spx.medium">
   <title>通过从安装源引导来执行更新</title>
   <para>
    作为联机迁移（参见<xref linkend="sec.update.sle11spx.online"/>以获取细节）的一种备用方法，您也可以通过从安装源（DVD 或网络安装源）引导这种方式来更新系统。更新的启动方式与正常安装相同。
   </para>
   <para>
    可以从 <ulink url="http://download.suse.com/"/> 获取服务包 2 ISO 映像。请将映像刻录到 DVD，或者按照<xref linkend="sec.deployment.remoteinst.instserver"/>中所述方法准备一个网络安装源。
   </para>
   <sect3 id="sec.upgrade.install-from-dvd">
    <title>从本地 DVD 驱动器更新</title>
    <para>
     在开始进行全新的 SUSE Linux Enterprise SP 安装前，请确保所有服务包安装媒体 (DVD) 都已备妥。
    </para>
    <procedure id="upgrade.sp.instsp.fromsp">
     <title>从服务包媒体引导</title>
     <step performance="required">
      <para>
       插入第一张 SUSE Linux Enterprise SP 媒体并引导计算机。类似 SUSE Linux Enterprise 11 原始安装的引导屏幕将会显示。
      </para>
     </step>
     <step performance="required">
      <para>
       选择<guimenu>安装</guimenu>并按照<xref linkend="cha.inst"/>中的 YaST 安装指导所述内容继续。
      </para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="sec.upgrade.install-from-network">
    <title>从网络安装源更新</title>
    <para>
     在从网络安装源开始更新 SUSE Linux Enterprise SP 之前，请先确保满足下列要求：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       网络安装源已按照<xref linkend="sec.deployment.remoteinst.instserver"/>所述设置妥当。
      </para>
     </listitem>
     <listitem>
      <para>
       安装服务器和目标计算机上存在包含名称服务、DHC（可选，但 PXE 引导需要）和 OpenSLP（可选）的网络连接，并且正在运行。
      </para>
     </listitem>
     <listitem>
      <para>
       存在用于引导目标系统的 SUSE Linux Enterprise SP DVD 1，<emphasis>或</emphasis>根据<xref linkend="sec.deployment.remoteinst.boot.pxeprep" xrefstyle="HeadingOnPage"/>为 PXE 引导设置的目标系统。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     请参见<xref linkend="cha.deployment.remoteinst"/>，深入了解从远程服务器开始升级的相关信息。
    </para>
    <sect4 id="sec.upgrade.install-from-network.dvdboot">
     <title>网络安装 — 从 DVD 引导</title>
     <para>
      要用 SP DVD 作为引导媒体执行网络安装，请执行如下操作：
     </para>
     <procedure>
      <step performance="required">
       <para>
        将 SUSE Linux Enterprise SP DVD 1 媒体插入计算机中。类似 SUSE Linux Enterprise 11 原始安装的引导屏幕将会显示。
       </para>
      </step>
      <step performance="required">
       <para>
        选择<guimenu>安装</guimenu>引导服务包内核，然后使用 <keycap>F4</keycap> 选择网络安装源的类型（FTP、HTTP、NFS 或 SMB）。
       </para>
      </step>
      <step performance="required">
       <para>
        提供相应的路径信息或选择 <guimenu>SLP</guimenu> 作为安装源。
       </para>
      </step>
      <step performance="required">
       <para>
        从所提供的服务器里选择相应的安装服务器，或用引导选项提示提供安装源类型和实际地址（如 <xref linkend="sec.i.yast2.source.net"/> 中所示）。YaST 启动。
       </para>
       <para>
        按<xref linkend="sec.update.sle11spx.medium.update"/>中所述完成安装。
       </para>
      </step>
     </procedure>
    </sect4>
    <sect4 id="sec.upgrade.install-from-network.pxeboot">
     <title>网络安装—— PXE 引导</title>
     <para>
      要进行 SUSE Linux Enterprise 服务包的网络安装，请执行以下操作：
     </para>
     <procedure>
      <step performance="required">
       <para>
        按照<xref linkend="sec.deployment.remoteinst.boot.pxeprep"/>调整您的 DHCP 服务器设置以提供 PXE 引导需要的地址信息。
       </para>
      </step>
      <step performance="required">
       <para>
        设置 TFTP 服务器来储存 PXE 引导需要的引导映像。
       </para>
       <para>
        为此，请使用 SUSE Linux Enterprise 服务包的第一张 CD 或 DVD，或者按照<xref linkend="sec.deployment.remoteinst.boot.tftp"/>中的指导操作。
       </para>
      </step>
      <step performance="required">
       <para>
        在目标计算机上准备 PXE 引导和局域网唤醒。
       </para>
      </step>
      <step performance="required">
       <para>
        对目标系统引导进行初始化，并用 VNC 远程连接到此计算机正运行的安装例程上。有关更多信息，请参见<xref linkend="sec.deployment.remoteinst.monitor.vnc"/>。
       </para>
      </step>
      <step performance="required">
       <para>
        按<xref linkend="sec.update.sle11spx.medium.update"/>中所述完成安装。
       </para>
      </step>
     </procedure>
    </sect4>
   </sect3>
   <sect3 id="sec.update.sle11spx.medium.update">
    <title>更新过程</title>
    <para>
     从安装媒体或网络成功引导后，根据如下所述继续开始更新：
    </para>
    <procedure>
     <step performance="required">
      <para>
       在<guimenu>欢迎</guimenu>屏幕上选择<guimenu>语言</guimenu>和<guimenu>键盘</guimenu>，并接受许可协议。按<guimenu>下一步</guimenu>继续。
      </para>
     </step>
     <step performance="required">
      <para>
       如果您已从物理媒体引导，请执行<guimenu>媒体检查</guimenu>以校验媒体的完整性。除非您先前检查过媒体，否则请勿跳过此步骤。
      </para>
     </step>
     <step performance="required">
      <para>
       在<guimenu>安装模式</guimenu>屏幕上，选择<guimenu>更新</guimenu>。单击<guimenu>下一步</guimenu>将会开始更新过程。
      </para>
     </step>
    </procedure>
   </sect3>
  </sect2>

  <sect2 id="sec.update.sle11spx.smt">
   <title>通过订阅管理工具 (SMT) 更新</title>
   <para>
    作为从 SUSE 更新服务器为每个单一客户端系统下载更新的备用方法，您可以使用适用于 SUSE Linux Enterprise 的订阅管理工具 (SMT)，将更新镜像到本地服务器。
   </para>
   <para>
    此工具既可以充当客户端注册的 SUSE Customer Center 代理，也可以充当软件更新储存库。<ulink url="http://www.suse.com/doc/smt11/"/> 上的 SMT 文档扼要介绍了此工具的功能，并提供了实施指导。
   </para>
  </sect2>

  <sect2 id="sec.update.sle11spx.manager">
   <title>通过 SUSE Manager 更新</title>
   <para>
    SUSE Manager 是一个服务器解决方案，用于提供适用于 SUSE Linux Enterprise 客户端的更新、增补程序和安全修复。它随附了一套工具和基于 Web 的用户界面，用于执行管理任务。
   </para>
   <para>
    <ulink url="http://www.suse.com/doc/suse_manager/"/> 上的 SUSE Manager 文档扼要介绍了此解决方案的功能，并提供了设置服务器和客户端的指导。
   </para>
  </sect2>
 </sect1>

 <sect1 id="sec.update.sle12">
  <title>升级到 SLE 12</title>

  

  <para>
   下列工具支持从 SUSE Linux Enterprise 11 SP3（或更高版本）升级到 SUSE Linux Enterprise 12：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     手动升级，从 ISO 引导（请参见<xref linkend="sec.update.sle12.iso"/>）。
    </para>
   </listitem>
   <listitem>
    <para>
     半自动迁移，可能通过 SSH<phrase os="sles">（请参见 <xref linkend="sec.update.sle12.automated"/>）</phrase>
    </para>
   </listitem>
  </itemizedlist>

  <sect2 id="sec.update.sle12.iso">
   <title>
    使用安装源从 SUSE Linux Enterprise 11 SP3 或更高版本手动升级
   </title>
   <para>
    您可以通过从安装源（本地 DVD 或网络安装源）引导这种方式来升级系统，就像执行全新安装一样。然后，在“引导屏幕”中选择“升级”而不是“安装”来升级系统。
   </para>

   <procedure id="pro.update.sle12.iso">
    <title>
     使用 SUSE Linux Enterprise 12 ISO 从 SUSE Linux Enterprise 11 SP3 或更高版本手动升级
   </title>
    <step performance="required">
     <para>
      选择引导方法以从 ISO 启动系统（请参见<xref linkend="sec.i.yast2.method"/>）。
     </para>
    </step>
    <step performance="required">
     <para>
      从 ISO 启动系统（请参见<xref linkend="sec.i.yast2.startup"/>）。
     </para>
     <para>
      在“引导屏幕”中，选择“升级”以开始系统升级。
     </para>
     <warning>
      <para>
       如果您选择“安装”，之后数据可能会丢失。在全新安装过程中，您需要格外小心，不要损坏数据分区，例如，重新分割磁盘（这可能会损坏现有分区）或重新格式化数据分区（这会删除数据分区上的所有数据）都会损坏数据分区。SUSE 建议在这里选择“升级”。
      </para>
     </warning>
    </step>
    <step performance="required">
     <para>
      执行一般的升级过程（请参见<xref linkend="sec.update.sle11spx.medium.update"/>）。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.update.sle12.automated">
   <title>从 SUSE Linux Enterprise 11 SP3 自动迁移到 SUSE Linux Enterprise 12</title>
   <para>
    要执行自动迁移，请如下操作：
   </para>
   <procedure id="pro.update.sle12">
    <title>从 SUSE Linux Enterprise 11 SP3 自动迁移到 SUSE Linux Enterprise 12</title>
    
    
    <step performance="required">
     <para>
      将安装内核 <filename>linux</filename> 和文件 <filename>initrd</filename> 从第一张安装 DVD 的 <filename>/boot/x86_64/loader/</filename> 目录复制到系统的 <filename>/boot</filename> 目录：
     </para>
     <screen><command>cp</command> -vi <replaceable>DVDROOT</replaceable>/boot/x86_64/loader/linux /boot/linux.upgrade
<command>cp</command> -vi <replaceable>DVDROOT</replaceable>/boot/x86_64/loader/initrd /boot/initrd.upgrade</screen>
     <para>
      <replaceable>DVDROOT</replaceable> 表示系统装入 DVD 的路径，通常为 <filename>/run/media/$USER/$DVDNAME</filename>。
     </para>
    </step>
    <step performance="required">
     <para>
      打开 GRUB 旧配置文件 <filename>/boot/grub/menu.lst</filename>，另外添加一部分。对于其他引导加载程序，编辑相应的配置文件。相应地调整设备名称。例如：
     </para>
     <screen>title Linux Upgrade Kernel
kernel (hd0,0)/boot/linux.upgrade root=/dev/sda1 upgrade <replaceable>OPTIONAL_PARAMETERS</replaceable>
initrd (hd0,0)/boot/initrd.upgrade</screen>
     <para>
      <replaceable>OPTIONAL_PARAMETERS</replaceable> 表示您引导系统和执行升级时可能需要的其他引导参数。它们可能是系统需要的内核参数 — 您可能需要从现有 GRUB 项中查看并复制这些参数。它们还可能是 SUSE <ulink url="http://en.opensuse.org/Linuxrc">linuxrc 参数，在线进行了说明</ulink>。
     </para>
    </step>
    <step performance="required">
     <para>
      如果升级应自动执行<phrase os="sles">（请参见 <xref linkend="sec.update.auto.run"/>）</phrase>，请在 GRUB 配置中 <literal>kernel</literal> 这行的末尾添加 <option>autoupgrade=1</option>。
     </para>
    </step>
    <step performance="required">
     <para>
      重引导计算机，并从引导菜单（这里是 <emphasis>Linux 升级内核</emphasis>）中选择新添加的部分。您可以使用 <command>grubonce</command> 预先选择新创建的 GRUB 项，以便以无人照管方式自动重引导到新创建的项。您也可以在命令行中使用 <command>reboot</command> 来启动重引导。
     </para>
    </step>
    <step performance="required">
     <para>
      执行一般的升级过程（请参见<xref linkend="sec.update.sle11spx.medium.update"/>）。
     </para>
    </step>
    <step performance="required">
     <para>
      升级过程成功完成后，去除安装内核和 initrd 文件（<filename>/boot/linux.upgrade</filename> 和 <filename>/boot/initrd.upgrade</filename>）。现在，它们已没有用处，不再需要它们。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="update_split_brain.xml" parse="xml"/>

 <sect1 id="sec.update.nmm">
  <title>背景信息：SUSE Linux Enterprise 的产品生命周期</title>

  <para>
   
   SUSE Linux Enterprise Server 的生命周期为 13 年：10 年的标准支持，3 年的扩展支持。
  </para>

  <para>
   SUSE Linux Enterprise Desktop 的生命周期为 10 年：7 年的标准支持，3 年的扩展支持。
  </para>

  <para>
   主要版本每 4 年发行一次。服务包每 18 个月发行一次。
  </para>

  <para>
   新服务包发行后，SUSE 对以前的服务包的支持会延续 6 个月。<xref linkend="fig.update.releases.service.packs"/>描述了以上某些方面。
  </para>

  <figure id="fig.update.releases.service.packs">
   <title>主要版本和服务包</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="new-maintenance-model.svg" width="75%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="new-maintenance-model.png" width="75%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   如果您需要更多的时间来设计、验证和测试您的升级计划，长期服务包支持 (LTSS) 可以延长支持期，让您额外获得以 12 个月为增量的 12 到 36 个月的支持，如此，对于任何给定服务包，您一共可以得到 3 到 5 年的支持（请参见<xref linkend="fig.update.maintenance.long-term-service-pack"/>）。
  </para>

  <figure id="fig.update.maintenance.long-term-service-pack">
   <title>长期服务包支持</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="new-maintenance-model+ltss.svg" width="75%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="new-maintenance-model+ltss.png" width="75%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 id="sec.update.supportlevel-lifecycle">
   <title>支持级别</title>
   <para>
    扩展支持级别的范围从第 10 年开始直至第 13 年。这些包含持续的 L3 工程级别诊断和反应性关键 bug 修复。这些支持级别主动更新内核中的普通本地 root 攻击或无需用户干涉即可直接执行的其他 root 攻击。而且，它们借助有限包排除列表支持现有工作负载、软件堆栈和硬件。可在<xref linkend="tab.security-and-bug-fixes"/>中找到概述。
   </para>
   <table id="tab.security-and-bug-fixes">
    <title>安全更新和 bug 修复</title>
    <tgroup cols="6">
     <colspec colname="c1"/>
     <colspec colname="c2"/>
     <colspec colname="c3"/>
     <colspec colname="c4"/>
     <colspec colname="c5"/>
     <colspec colname="c6"/>
     <thead>
      <row>
       <entry/>
       <entry namest="c2" nameend="c4" align="center">
        <para>
         最新服务包 (SP) 的标准支持
        </para>
       </entry>
       <entry>
        <para>
         上个 SP 的标准支持，含 LTSS
        </para>
       </entry>
       <entry>
        <para>
         含 LTSS 的扩展支持
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         特性
        </para>
       </entry>
       <entry>
        <para>
         第 1-5 年
        </para>
       </entry>
       <entry>
        <para>
         第 6-7 年
        </para>
       </entry>
       <entry>
        <para>
         第 8-10 年
        </para>
       </entry>
       <entry>
        <para>
         第 4-10 年
        </para>
       </entry>
       <entry>
        <para>
         第 10-13 年
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         技术服务
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         可访问增补程序和修复
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         可访问文档和知识库
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         支持现有堆栈和工作负载
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         支持新部署
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         受限制（根据合作伙伴和客户要求）
        </para>
       </entry>
       <entry>
        <para>
         受限制（根据合作伙伴和客户要求）
        </para>
       </entry>
       <entry>
        <para>
         否
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         增强请求
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         受限制（根据合作伙伴和客户要求）
        </para>
       </entry>
       <entry>
        <para>
         受限制（根据合作伙伴和客户要求）
        </para>
       </entry>
       <entry>
        <para>
         否
        </para>
       </entry>
       <entry>
        <para>
         否
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         硬件支持与优化
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         受限制（根据合作伙伴和客户要求）
        </para>
       </entry>
       <entry>
        <para>
         受限制（根据合作伙伴和客户要求）
        </para>
       </entry>
       <entry>
        <para>
         否
        </para>
       </entry>
       <entry>
        <para>
         否
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         通过 SUSE SolidDriver 程序（前身为 PLDP）进行驱动程序更新
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         受限制（根据合作伙伴和客户要求）
        </para>
       </entry>
       <entry>
        <para>
         受限制（根据合作伙伴和客户要求）
        </para>
       </entry>
       <entry>
        <para>
         否
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         从最新 SP 向后移植修复
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         受限制（根据合作伙伴和客户要求）
        </para>
       </entry>
       <entry>
        <para>
         不适用
        </para>
       </entry>
       <entry>
        <para>
         不适用
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         重要安全更新
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         缺陷解决方法
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         是
        </para>
       </entry>
       <entry>
        <para>
         受限制（仅限严重性级别 1 和 2 缺陷）
        </para>
       </entry>
       <entry>
        <para>
         受限制（仅限严重性级别 1 和 2 缺陷）
        </para>
       </entry>
       <entry>
        <para>
         受限制（仅限严重性级别 1 和 2 缺陷）
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 id="sec.update.nmm.repositories">
   <title>储存库模型</title>

   <para>
    储存库布局对应于产品生命周期。<xref linkend="tab.update.nmm.repositories.sp2"/>包含了从 SUSE Linux Enterprise 11 SP2 到 SUSE Linux Enterprise 12 的所有储存库的列表。
   </para>
   <table id="tab.update.nmm.repositories.sp2">
    <title>SUSE Linux Enterprise 11 SP2 和 SP3 及 SUSE Linux Enterprise 12 的储存库布局</title>

    <tgroup cols="3">
     <colspec colnum="1" colname="c1" colwidth="1.2*"/>
     <colspec colnum="2" colname="c2" colwidth="3*"/>
     <colspec colnum="3" colname="c3" colwidth="3*"/>
     <thead>
      <row>
       <entry>
        <para>
         类型
        </para>
       </entry>
       <entry>
        <para>
         SLES
        </para>
       </entry>
       <entry>
        <para>
         SLED
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         必需的储存库
        </para>
       </entry>
       <entry>
        <para>
         11 SP2
        </para>
        <simplelist>
         <member><literal>SLES11-SP1-Pool</literal> </member> <member><literal>SLES11-SP1-Updates</literal> </member> <member><literal>SLES11-SP2-Core</literal> </member> <member><literal>SLES11-SP2-Updates</literal> </member>
        </simplelist>
        <para>
         11 SP3
        </para>
        <simplelist>
         <member><literal>SLES11-SP3-Pool</literal> </member> <member><literal>SLES11-SP3-Updates</literal> </member>
        </simplelist>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>SLES12-GA-Pool</literal> </member> <member><literal>SLES12-GA-Updates</literal> </member>
        </simplelist>
       </entry>
       <entry>
        <para>
         11 SP2
        </para>
        <simplelist>
         <member><literal>SLED11-SP1-Pool</literal> </member> <member><literal>SLED11-SP1-Updates</literal> </member> <member><literal>SLED11-SP2-Core</literal> </member> <member><literal>SLED11-SP2-Updates</literal> </member>
        </simplelist>
        <para>
         11 SP3
        </para>
        <simplelist>
         <member><literal>SLED11-SP3-Pool</literal> </member> <member><literal>SLED11-SP3-Updates</literal> </member>
        </simplelist>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>SLED12-GA-Pool</literal> </member> <member><literal>SLED12-GA-Updates</literal> </member>
        </simplelist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         可选储存库
        </para>
       </entry>
       <entry>
        <para>
         11 SP2
        </para>
        <simplelist>
         <member><literal>SLES11-SP2-Debuginfo-Core</literal> </member> <member><literal>SLES11-SP2-Debuginfo-Updates</literal> </member> <member><literal>SLES11-Extras</literal> </member> <member><literal>SLES11-SP2-Extension-Store</literal> </member>
        </simplelist>
        <para>
         11 SP3
        </para>
        <simplelist>
         <member><literal>SLES11-SP3-Debuginfo-Core</literal> </member> <member><literal>SLES11-SP3-Debuginfo-Updates</literal> </member> <member><literal>SLES11-SP3-Extension-Store</literal> </member> <member><literal>SLES11-Extra</literal> </member>
        </simplelist>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>SLES12-GA-Debuginfo-Core</literal> </member> <member><literal>SLES12-GA-Debuginfo-Updates</literal> </member>
        </simplelist>
       </entry>
       <entry>
        <para>
         11 SP2
        </para>
        <simplelist>
         <member><literal>SLED11-SP2-Debuginfo-Core</literal> </member> <member><literal>SLED11-SP2-Debuginfo-Updates</literal> </member> <member><literal>SLED11-Extras</literal> </member> <member><literal>SLED11-SP2-Extension-Store</literal> </member>
        </simplelist>
        <para>
         11 SP3
        </para>
        <simplelist>
         <member><literal>SLED11-SP3-Debuginfo-Core</literal> </member> <member><literal>SLED11-SP3-Debuginfo-Updates</literal> </member> <member><literal>SLED11-SP3-Extension-Store</literal> </member> <member><literal>SLED11-Extra</literal> </member>
        </simplelist>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>SLED12-GA-Debuginfo-Core</literal> </member> <member><literal>SLED12-GA-Debuginfo-Updates</literal> </member>
        </simplelist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         新增：<emphasis>模块</emphasis>特定的储存库
        </para>
       </entry>
       <entry>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>sle-module-web-scripting</literal> </member> <member><literal>sle-module-adv-systems-management</literal> </member> <member><literal>sle-module-public-cloud</literal> </member> <member><literal>sle-module-legacy</literal> </member>
        </simplelist>
       </entry>
       <entry>
        <para>
         12
        </para>
	
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <variablelist>
    <title>针对必需的储存库的说明</title>
    <varlistentry>
     <term>更新</term>
     <listitem>
      <para>
       对相应 <literal>Core</literal> 或 <literal>Pool</literal> 安装源中的包进行的维护更新。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>池</term>
     <listitem>
      <para>
       包含安装媒体中的所有二进制 RPM，外加模式信息和支持状态元数据。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <variablelist>
    <title>针对可选储存库的说明</title>
    <varlistentry>
     <term>Debuginfo-Pool</term>
     <term>Debuginfo-Updates</term>
     <listitem>
      <para>
       这些储存库包含静态内容。在这两者中，只有 <literal>Debuginfo-Updates</literal> 储存库会接收更新。如果您需要安装包含调试信息的库以备不时之需，请启用这些储存库。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <sect3 id="sec.update.nmm.repositories.origin">
    <title>包源</title>
    <formalpara>
     <title>SUSE Linux Enterprise 11 SP3</title>
     <para>
      对于 SP3 的更新，只有下面两个储存库可用：<literal os="sles">SLES11-SP3-Pool</literal> 和 <literal os="sles">SLES11-SP3-Updates</literal>。所有来自 SP2 的之前的储存库会显示出来，但并未启用。只有存在特殊需求的用户才需要这些已禁用的储存库。
     </para>
    </formalpara>
    <formalpara>
     <title>SUSE Linux Enterprise 12</title>
     <para>
      对于 SUSE Linux Enterprise 12 的更新，只有下面两个储存库可用：<literal os="sles">SLES12-GA-Pool</literal> 和 <literal os="sles">SLES12-GA-Updates</literal>。所有来自 SUSE Linux Enterprise 11 SP3 的之前的储存库都会禁用。
     </para>
    </formalpara>
   </sect3>
   <sect3 id="sec.update.nmm.repositories.working">
    <title>使用储存库</title>
    <para>
     在注册时，系统会接收来自 SUSE Customer Center 的储存库。储存库名称会映射到该客户中心内的特定 URI（请参见 <ulink url="https://scc.suse.com/"/>）。要列出系统上所有可用的储存库，请按如下方式使用 <command>zypper</command>：
    </para>
<screen>zypper repos -u</screen>

    <para>
     这会显示系统上所有可用储存库的列表。每个储存库的别名、名称都会列出，并会指出它是否已启用且会刷新。使用选项 <option>-u</option> 也可以从 URI 的来源处获取该 URI。
    </para>
    <para>
     如果您要去除旧储存库（例如，来自 SP1 的储存库），请使用 <command>zypper removerepo</command> 及储存库的名称。例如，要去除旧的 SP1 和 SP2 储存库，请使用以下命令：
    </para>
<screen>zypper removerepo SLES11-SP1-Pool SLES11-SP1-Updates \
    SLE11-SP1-Debuginfo-Pool SLE11-SP1-Debuginfo-Updates \
    SLES11-SP2-Core SLES11-SP2-Updates \
    SLE11-SP2-Debuginfo-Core SLES11-SP2-Extension-Store\
    SLE11-SP2-Debuginfo-Updates</screen>
    <para>
     如果要重新添加某些储存库，请登录 <ulink url="https://scc.suse.com/"/> 并从菜单 <menuchoice><guimenu>My Products</guimenu> <guimenu>Mirror Credentials</guimenu></menuchoice>（我的产品 &gt; 镜像身份凭证）中进行选择。然后，您便可看到一个 URI 列表；只能添加此产品列表中的储存库。例如，要添加 SP2 Extension Store，请使用以下命令（以一行输入，不能使用反斜杠）：
    </para>
<screen>zypper addrepo -n SLES11-SP2-Extension-Store \
    https://nu.novell.com/repo/\$RCE/SLES11-SP2-Extension-Store/nu_novell_com:SLES11-SP2-Extension-Store</screen>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.update.backports">
  <title>背景：向后移植源代码</title>

  <para>
   SUSE 广泛使用了向后移植，即将当前的软件修复和功能迁移到过去发行的 SUSE Linux Enterprise 包中。本节中的信息有助于您了解通过比较产品的版本号来判断 SUSE Linux Enterprise 软件包的功能和安全为何不可靠。您将了解 SUSE 如何在确保系统软件安全且最新的同时，保持在 SUSE Linux Enterprise 产品上运行的应用程序软件的兼容性。您还将了解如何检查在 SUSE Linux Enterprise 系统软件中实际解决了哪些公开的安全问题，以及您的软件实际上有多新。

  </para>

  <sect2 id="sec.update.backports.why">
   <title>为何要向后移植？</title>
   <para>
    上游开发者主要关心所开发软件的进度。在许多情况下，他们会一边修复 bug，一边引入尚未接受广泛测试并可能会造成新 bug 的新功能。
   </para>
   <para>
    对于分发包开发者而言，必须区分两种情况：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      在对功能造成有限中断的情况下执行的 bug 修复；以及
     </para>
    </listitem>
    <listitem>
     <para>
      可能会中断现有功能的更改。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    在大多数情况下，当某个包已属于所发布的分发包时，分发包开发者不会遵照所有的上游更改。通常，他们会继续使用最初发布的上游版本，并根据上游更改来创建增补程序以修复 bug。这种做法称为<emphasis>向后移植</emphasis>。
   </para>
   <para>
    通常，分发包开发者只会在两种情况下引入软件的更新版本：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      当他们的包与上游版本之间的差异过大，以致向后移植的做法不再可行，或者
     </para>
    </listitem>
    <listitem>
     <para>
      软件（例如防恶意软件的软件）由于固有的性质而变得不合时宜。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 id="sec.update.backports.reasons-for">
   <title>向后移植的原因</title>
   <para>
    由于我们致力于在大量企业软件考虑因素之间实现合理的平衡，SUSE 广泛使用了向后移植。其中，最重要的考虑因素包括：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      提供稳定的接口 (API)，软件供应商在构建可用于 SUSE 企业产品的产品时可以依赖这些接口。
     </para>
    </listitem>
    <listitem>
     <para>
      确保 SUSE 企业产品版本中使用的包具有最好的质量，这些包本身以及在成为整个企业产品的一部分后已经过充分的测试。
     </para>
    </listitem>
    <listitem>
     <para>
      由其他供应商对 SUSE 的企业产品维持各种认证，就像对 Oracle 或 SAP 产品的认证一样。
     </para>
    </listitem>
    <listitem>
     <para>
      使 SUSE 开发者能够专注于竭尽所能开发出产品的下一个优质版本，而不是狭隘地将注意力分散于如何推出更多的版本。
     </para>
    </listitem>
    <listitem>
     <para>
      清楚明了特定企业版本中包含的功能和特性，以便我们的支持可以提供有关该版本的准确及时的信息。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 id="sec.update.backports.reasons-against">
   <title>反对向后移植的原因</title>
   <para>
    不要将新的上游包版本引入我们的企业产品，这是常见的策略规则，但不是硬性规则。对于有限种类的包，尤其是防病毒软件，我们考虑更多的是安全方面的因素，而不是质量保证方面优先考虑的保守性因素。对于这个种类的包，偶尔会将更新的版本引入企业产品系列的发布版本。
   </para>
   <para>
    有时，对于其他类型的包，我们也会选择引入新版本，而不是向后移植。当生成向后移植在经济效益上不可行，或者由于极其相关的技术原因而需要引入更新版本时，我们会采取这种做法。
   </para>
  </sect2>

  <sect2 id="sec.update.backports.">
   <title>使用向后移植时解释版本号所产生的效果</title>
   <para>
    由于采用向后移植的做法，用户不能简单地通过比较版本号来确定 SUSE 包是否包含针对特定问题的修复，或者其中是否添加了特定的功能。在使用向后移植时，SUSE 包版本号的上游部分只是表示 SUSE 包基于的上游版本。它可能包含相应上游版本中没有但已向后移植到 SUSE 包中的 bug 修复和功能。
   </para>
   <para>
    在涉及到向后移植时，版本号的这种有限价值可能会造成在特定情况下产生问题，也就是在使用安全扫描工具的时候。某些安全漏洞扫描工具（或者在此类工具中进行特定的测试）只能基于版本号运行。在涉及向后移植时，这些工具/测试很容易生成<quote>误报</quote>（宣称发现软件存在漏洞，而实际上并没有漏洞）。在评估安全扫描工具生成的报告时，用户始终应该调查其中的条目是基于版本号，还是基于对是否存在实际漏洞而展开的实际测试。
   </para>
  </sect2>
  <sect2>
   <title>
    如何检查修复了哪些 Bug 以及哪些功能已向后移植且可用
   </title>
   <para>
    有关向后移植的 bug 修复和功能等的信息可以储存在许多位置：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      包的更改日志：
     </para>
<screen>rpm -q --changelog name-of-installed-package
rpm -qp --changelog packagefile.rpm</screen>
     <para>
      其输出简要记录了包的更改历史记录。
     </para>
    </listitem>
    <listitem>
     <para>
      包的更改日志可能包含类似于引用 Novell Bugzilla 跟踪系统中的 bug 的 <literal>bnc#1234</literal> 之类的项，或者包含指向其他 bug 跟踪系统的链接。（出于保密政策，您不一定能够访问所有此类信息）。
     </para>
    </listitem>
    <listitem>
     <para>
      包可能包含 <filename><replaceable/>/usr/share/doc/packagename/README.SUSE</filename> 或 <filename>README.SuSE</filename> 文件，该文件包含特定于 SUSE 包的概要信息。
     </para>
    </listitem>
    <listitem>
     <para>
      RPM 源包包含构建普通二进制 RPM 期间应用的增补程序，这些增补程序以独立文件的形式存在，如果您熟知如何阅读源代码，可以对这些文件进行解释。对于 SUSE Linux Enterprise 软件的安装源，请参见<xref linkend="sec.zypper.softman.sources"/>，对于 SUSE Linux Enterprise 上的构建包，请参见<xref linkend="sec.rpm.sources"/>，对于 SUSE Linux Enterprise 软件包构建的内部工作，请参见<ulink url="http://www.rpm.org/max-rpm/">《Maximum RPM》</ulink>（最大 RPM）一书。
     </para>
    </listitem>
    <listitem>
     <para>
      有关安全 bug 修复，请参见 <ulink url="http://www.suse.com/support/security/#1">SUSE 安全声明</ulink>。这些修复往往通过<ulink url="http://cve.mitre.org">公共漏洞和披露</ulink>项目所维护的标准化名称（例如 <literal>CAN-2005-2495</literal>）来引用 bug。
     </para>
    </listitem>
   </itemizedlist>

  </sect2>
 </sect1>
 <sect1 id="sec.update.wagonhooks">
  <title>背景：YaST Wagon 的迁移钩子</title>



  <para>
   在迁移过程中的某个时间点，您可以使用迁移钩子来运行自定义的外部脚本。这些脚本可让您处理无法通过正常 RPM 脚本处理的具体问题，或者让您执行迁移期间可能需要执行的任何附加操作（在正常包更新期间不需要执行）。
  </para>

  <para>
   迁移钩子需要以 root 特权执行，因此，可以在脚本中执行任何维护任务（启动/停止服务、数据备份、数据迁移等）。脚本不能是交互式的；STDIN 和 STDOUT 在 YaST 中运行时会被重定向到管道。不应使用 X 会话，因为它不一定在所有情况下都可用（例如以文本模式运行时）。不要忘记设置对钩子脚本的可执行许可权限。
  </para>

  <para>
   <systemitem class="resource">yast2-wagon</systemitem> 包版本 2.17.32.1（以 SLES11-SP2 的更新的形式提供）或 2.17.34（包含在 SLES11-SP3 中）或更高版本支持迁移钩子。
  </para>

  <sect2>
   <title>钩子脚本的位置和命名约定</title>
   <para>
    可以在 <filename>/var/lib/YaST2/wagon/hooks/</filename> 目录中搜索这些脚本。预期的脚本名称采用<replaceable>步骤_顺序号_前缀_名称</replaceable>格式，其中：
   </para>
   <variablelist>
    <varlistentry>
     <term><replaceable>步骤</replaceable>
     </term>
     <listitem>
      <para>
       是预定义的迁移步骤名称，描述当前的迁移步骤。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><replaceable>顺序号</replaceable>
     </term>
     <listitem>
      <para>
       是 00...99 范围内的顺序号，您可以根据此顺序号设置脚本的执行顺序。（在开始时必须保持为零，以实现正确的排序﹗）
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><replaceable>前缀</replaceable>
     </term>
     <listitem>
      <para>
       应该唯一，以避免冲突（类似于名称空间）。使用包名称（如果它是包的一部分）或供应商名称、因特网域名等，简而言之，请使用您认为足够唯一的任何对象
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><replaceable>名称</replaceable>
     </term>
     <listitem>
      <para>
       可以是任意字符串（用于区分脚本）。建议使用某个描述性名称。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <example>
    <title>包含完整路径的钩子脚本</title>
<screen>/var/lib/YaST2/wagon/hooks/before_package_migration_00_postgresql_backup</screen>
   </example>
  </sect2>

  <sect2>
   <title>钩子脚本退出值</title>
   <para>
    脚本应返回退出值 0。如果该脚本失败（返回任何非零退出值），Wagon 中会显示错误讯息，此时您可以重启动脚本，忽略失败（并继续执行其他脚本），或者完全取消当前步骤和阶段的钩子。
   </para>
  </sect2>

  <sect2>
   <title>幂等脚本</title>
   <para>
    钩子脚本<emphasis>有时可以运行多次</emphasis>（在 Wagon 对话框中前后切换时，Wagon 可能会自行重启动，或者迁移工作流程中的某些步骤可能会执行多次），因此，脚本必须处理这种情况（它们可以在开始时确认是需要执行操作还是操作已经执行，或者它们可以创建一个简单的临时戳记文件，或正确解决多次运行的问题）。
   </para>
  </sect2>

  <sect2>
   <title>受支持钩子的列表</title>
   
   <para>
    某些钩子是可选的（因为它们依赖于前面的结果，或依赖于用户选择的值）。请注意，某些钩子会被调用多次（例如，迁移前后都会调用注册）。以下是按执行顺序列出的受支持钩子（步骤名称）的列表：
   </para>
   <variablelist>
    <varlistentry>
     <term><command>before_init</command>
     </term>
     <listitem>
      <para>
       最开始启动（注意：在重启动 Wagon 后会再次调用）
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_welcome</command>
     </term>
     <term><command>after_welcome</command>
     </term>
     <listitem>
      <para>
       在显示欢迎对话框之前/之后启动
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_registration_check</command>
     </term>
     <term><command>after_registration_check</command>
     </term>
     <listitem>
      <para>
       Wagon 将检查注册状态（如果某些产品的注册已失效，迁移可能失败）。如果任何情况都正常，则不显示对话框，Wagon 将自动继续下一步
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_custom_url</command>
     </term>
     <term><command>after_custom_url</command>
     </term>
     <listitem>
      <para>
       启动安装源管理器（可选，仅限增补程序 CD 模式）
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_self_update</command>
     </term>
     <term><command>after_self_update</command>
     </term>
     <listitem>
      <para>
       在 Wagon 更新自身之前/之后调用（以确保使用最新版本进行迁移）
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_installing_migration_products</command>
     </term>
     <term><command>after_installing_migration_products</command>
     </term>
     <listitem>
      <para>
       在安装迁移产品之前/之后调用
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_selecting_migration_source</command>
     </term>
     <term><command>after_selecting_migration_source</command>
     </term>
     <listitem>
      <para>
       Wagon 会询问用户是通过 SUSE Customer Center 储存库还是使用自定义储存库进行迁移；下一步将根据用户的选择而定
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_registration</command>
     </term>
     <term><command>after_registration</command>
     </term>
     <listitem>
      <para>
       运行 SUSE 注册（以添加迁移安装源）
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_repo_selection</command>
     </term>
     <term><command>after_repo_selection</command>
     </term>
     <listitem>
      <para>
       手动安装源管理
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_set_migration_repo</command>
     </term>
     <term><command>after_set_migration_repo</command>
     </term>
     <listitem>
      <para>
       选择迁移储存库（使用 SUSE Customer Center 时选择完整/最小迁移）或更新储存库选择（自定义储存库迁移）
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_package_migration</command>
     </term>
     <listitem>
      <para>
       在启动包更新之前，执行此步骤之后，实际迁移将会开始，此时无法自动返回到前一状态；这是因为在此阶段中止会导致系统不一致（升级到一半），导致需要手动回滚
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_registration</command>
     </term>
     <term><command>after_registration</command>
     </term>
     <listitem>
      <para>
       运行 SUSE 注册（以注册更新的产品）
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_congratulate</command>
     </term>
     <term><command>after_congratulate</command>
     </term>
     <listitem>
      <para>
       Wagon 在成功迁移后显示恭喜对话框之前/之后
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_exit</command>
     </term>
     <listitem>
      <para>
       在 Wagon 退出之前的那一刻调用（不管迁移结果如何，始终会调用；另外，在中止之后以及在重启动时也会调用）
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>Abort 钩子</title>
   <para>
    这是一些特殊的中止钩子，在用户中止迁移时调用。这些钩子可以在迁移工作流程的任一步骤中调用，因此，无法保证执行顺序。如果这些钩子依赖于其他钩子的结果，则脚本需要检查当前状态。
   </para>
   <variablelist>
    <varlistentry>
     <term><command>before_abort</command>
     </term>
     <listitem>
      <para>
       用户已确认中止迁移
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_abort_rollback</command>
     </term>
     <term><command>after_abort_rollback</command>
     </term>
     <listitem>
      <para>
       用户已确认在中止后回滚（还原到开始迁移之前安装的旧产品）。这些钩子在 before_abort 之后调用，如果用户未确认回滚则跳过此步骤。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>Restart 钩子</title>
   <para>
    每当 Wagon 重启动自身时就会调用这些钩子。
   </para>
   <variablelist>
    <varlistentry>
     <term><command>before_restart</command>
     </term>
     <listitem>
      <para>
       Wagon 正在完成，并将再次启动
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>after_restart</command>
     </term>
     <listitem>
      <para>
       Wagon 已重启动，并在运行迁移工作流程中的下一步
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>常用的钩子</title>
   <para>
    钩子列表的内容相当广泛，但其中的许多钩子只在特殊情况下才有效果。在正常的用例中，应该给这些钩子指定优先顺序：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      要在迁移系统之前（系统仍在运行上一版本）执行某项操作，请使用 <command>before_package_migration</command> 钩子。
     </para>
     <para>
      此时，用户清楚地知道迁移已准备就绪并即将开始；在此前的所有步骤中，可以中止迁移。

     </para>
    </listitem>
    <listitem>
     <para>
      要在系统迁移之后执行某操作（系统运行的是新的已迁移版本，但是有些功能可能尚未激活，例如更新的内核需要重引导、更新的服务可能需要重启动，等等），请使用 <command>before_congratulate</command> 或 <command>after_congratulate</command> 钩子。
     </para>
     <para>
      此钩子也可用于清理 <command>before_package_migration</command> 钩子的临时结果。此时，迁移已成功完成。
     </para>
    </listitem>
    <listitem>
     <para>
      要在中止迁移的情况下还原更改，请根据情况使用 abort 钩子之一。请记住，可以在任何时间调用 abort 钩子，因此，可能无需还原（可能尚未调用执行更改的钩子）。abort 钩子需要检查当前状态。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2>
   <title>过时的钩子</title>
   <para>
    旧版 Wagon 仅支持两个钩子脚本：<filename>/usr/lib/YaST2/bin/wagon_hook_init</filename> 和 <filename>/usr/lib/YaST2/bin/wagon_hook_finish</filename>。问题在于，只能将一个脚本作为钩子运行，并且无法将钩子直接放入 RPM 包中。
   </para>
   <para>
    新版 Wagon 仍然支持这些旧钩子脚本以实现向后兼容，但是，应该使用新的钩子 <command>before_init</command> 和 <command>before_exit</command> 来取代对应的已过时钩子。
   </para>
  </sect2>
 </sect1>
</chapter>
