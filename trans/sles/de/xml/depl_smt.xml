<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="depl_smt.xml" id="cha.smt">
 <title>Abonnementverwaltung</title>

 <para>
  Sie können einen beliebigen Rechner, auf dem SUSE Linux Enterprise Server <phrase role="productname"><phrase os="sles;sled;slerte">12</phrase></phrase> oder SUSE Linux Enterprise Desktop <phrase role="productname"><phrase os="sles;sled;slerte">12</phrase></phrase> ausgeführt wird, für die Registrierung bei einem lokalen SMT-Server (Subscription Management Tool) konfigurieren und dort Software-Aktualisierungen herunterladen, anstatt direkt mit dem SUSE Customer Center und den NU-Servern zu kommunizieren. Für den Einsatz eines SMT-Servers zur Clientregistrierung und als lokale Aktualisierungsquelle müssen Sie zunächst den SMT-Server in Ihrem Netzwerk konfigurieren. Die SMT-Server-Software ist als Add-on for SUSE Linux Enterprise Server erhältlich. Die Konfiguration dieser Software wird im <emphasis>Subscription Management Tool Guide</emphasis> (SMT-Handbuch) beschrieben. Es müssen keinerlei Add-ons auf den Clients installiert werden, die zur Registrierung auf einem SMT-Server konfiguriert werden.
 </para>
 <para>
  Zur Registrierung eines Clients auf einem SMT-Server müssen Sie den Client mit der URL des Servers ausstatten. Da Client und Server während der Registrierung über das HTTPS-Protokoll kommunizieren, müssen Sie auch sicherstellen, dass das Zertifikat des Servers für den Client verbürgt ist. Falls Ihr SMT-Server auf die Verwendung des Standardserverzertifikats eingestellt ist, steht das CA-Zertifikat auf dem SMT-Server über das HTTP-Protokoll unter <literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal> zur Verfügung. In diesem Fall müssen Sie sich nicht um das Zertifikat kümmern: Der Registrierungsvorgang lädt das CA-Zertifikat automatisch von dort herunter, sofern keine andere Konfiguration festgelegt wurde. Sie müssen einen Pfad zum CA-Zertifikat des Servers eingeben, wenn das Zertifikat von einer externen Zertifizierungsstelle ausgestellt wurde.
 </para>

 <para>
  Es bestehen mehrere Möglichkeiten, diese Information bereitzustellen und den Clientcomputer für die Verwendung von SMT zu konfigurieren. Die erste Möglichkeit ist die Bereitstellung der erforderlichen Information über Kernel-Parameter beim Booten. Die zweite Möglichkeit ist die Konfigurierung von Clients mithilfe eines AutoYaST-Profils. Mit Subscription Management Tool wird auch das Skript <command>clientSetup4SMT.sh</command> verteilt, das auf einem Client ausgeführt werden kann, damit er sich bei einem angegebenen SMT-Server registriert. Diese Möglichkeiten werden in den folgenden Abschnitten beschrieben:
 </para>
 <sect1 id="smt.client.parameters">
  <title>Verwenden von Kernel-Parametern zum Zugriff auf einen SMT-Server</title>

  <para>
   Jeder Client kann zur Verwendung von SMT konfiguriert werden, indem beim Computerstart die folgenden Kernel-Parameter bereitgestellt werden: <literal>regurl</literal> und <literal>regcert</literal>. Der erste Parameter ist obligatorisch, der zweite optional.
  </para>

  <variablelist>
   <varlistentry>
    <term>regurl</term>
    <listitem>
     <para>
      URL des SMT-Servers. Die URL muss folgendes Format aufweisen: <literal>https://<replaceable>FQDN</replaceable></literal>, wobei <replaceable>FQDN</replaceable> der vollständig qualifizierte Hostname des SMT-Server ist. Er muss identisch mit dem FQDN des Serverzertifikats auf dem SMT-Server sein. Beispiel:
     </para>
<screen>regurl=https://smt.example.com</screen>
    </listitem>
   </varlistentry>
  </variablelist>

  <warning>
   <title>Achten Sie auf Eingabefehler</title>
   <para>
    Achten Sie darauf, dass Sie richtige Werte eingeben. Wenn <literal>regurl</literal> nicht richtig angegeben wurde, schlägt die Registrierung der Aktualisierungsquelle fehl.
   </para>
  </warning>

  <warning>
   <title>Ändern des SMT-Serverzertifikats</title>
   <para>
    Wenn der SMT-Server ein neues Zertifikat von einer neuen und nicht verbürgten Zertifizierungsstelle erhält, müssen die Clients die neue CA-Zertifikatdatei abrufen. Dies erfolgt automatisch beim Registrierungsvorgang, aber nur, wenn bei der Installation eine URL zum Abrufen des Zertifikats verwendet wurde oder wenn der Parameter <literal>regcert</literal> weggelassen wurde und daher die Standard-URL benutzt wird. Wenn das Zertifikat unter Verwendung einer anderen Methode geladen wurde (z. B. lokaler Pfad), wird das CA-Zertifikat nicht aktualisiert.
   </para>
  </warning>
 </sect1>
 <sect1 id="smt.client.autoyast">
  <title>Konfigurieren von Clients mit dem AutoYaST-Profil</title>

  <para>
   Clients können zur Registrierung bei SMT-Server über das AutoYaST-Profil konfiguriert werden. Allgemeine Informationen zum Erstellen von AutoYaST-Profilen und Vorbereiten der automatischen Installation finden Sie unter <xref linkend="cha.deployment.autoinst"/>. In diesem Abschnitt wird nur die SMT-spezifische Konfiguration beschrieben.
  </para>

  <para>
   So konfigurieren Sie SMT-spezifische Daten mithilfe von AutoYaST:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Starten Sie YaST als <systemitem class="username">root</systemitem>, und wählen Sie <menuchoice><guimenu>Verschiedenes</guimenu> <guimenu>Automatische Installation</guimenu></menuchoice>, um das grafische AutoYaST-Frontend zu starten.
    </para>
    <para>
     Sie können das grafische AutoYaST-Frontend mit <command>yast2 autoyast</command> von einer Kommandozeile aus starten.

    </para>
   </step>
   <step performance="required">
    <para>
     Öffnen Sie ein bestehendes Profil über <menuchoice><guimenu>Datei</guimenu><guimenu>Öffnen</guimenu></menuchoice>, erstellen Sie ein Profil auf der Basis der Konfiguration des aktuellen Systems über <menuchoice><guimenu>Werkzeuge</guimenu><guimenu>Referenzprofil erstellen</guimenu></menuchoice>, oder beginnen Sie mit einem leeren Profil.
    </para>
   </step>
   <step performance="required">
    <para>
     Wählen Sie <menuchoice><guimenu>Support</guimenu><guimenu>SUSE Customer Center-Konfiguration</guimenu></menuchoice>. Eine Übersicht der aktuellen Konfiguration wird angezeigt.
    </para>
   </step>
   <step performance="required">
    <para>
     Klicken Sie auf <guimenu>Bearbeiten</guimenu>.
    </para>
   </step>
   <step performance="required">

    <para>
     Wählen Sie zur automatischen Registrierung während der Installation <guimenu>Produktregistrierung ausführen</guimenu>.  
    </para>
   </step>
   <step performance="required">
    <para>
     Legen Sie die URL des <guimenu>SMT-Servers</guimenu> und optional den Speicherort des <guimenu>SMT-Zertifikats</guimenu> fest. Die möglichen Werte sind dieselben wie für den Kernel-Parameter <literal>regurl</literal>. Die möglichen Werte sind dieselben wie für die Kernel-Parameter <literal>regurl</literal> und <literal>regcert</literal> (siehe <xref linkend="smt.client.parameters"/>). Einzige Ausnahme dabei: Der Wert <literal>ask</literal> für <literal>regcert</literal> funktioniert nicht in AutoYaST, da er eine Benutzerinteraktion verlangt. Wenn Sie ihn verwenden, wird der Registrierungsvorgang übersprungen.
    </para>
    <para>Allerdings kann YaST, wenn Sie sich registrieren lassen, die Add-ons (Erweiterungen oder Module) von einem SUSE Customer Center-Registrierungsserver verwenden. Nach der Registrierung bei SUSE Customer Center können Sie neue Produkte wie SUSE Software Development Kit, High Availability, GEO Clustering for SUSE Linux Enterprise High Availability Extension und dergleichen mehr direkt von Ihrem SUSE Customer Center installieren. Sogar den neuesten Patch-Level können Sie über SUSE Customer Center installieren.
    </para>
   </step>
   <step performance="required">
    <para>
     Führen Sie jegliche weitere Konfiguration durch, die für die bereitzustellenden Systeme erforderlich ist.
    </para>
   </step>
   <step performance="required">
    <para>
     Wählen Sie <menuchoice> <guimenu>Datei</guimenu> <guimenu>Speichern unter</guimenu> </menuchoice>, und geben Sie einen Dateinamen für das Profil ein, z. B. <filename>autoinst.xml</filename>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="smt.client.clientsetupscript">
  <title>Konfigurieren von Clients mit dem Skript clientSetup4SMT.sh</title>

  <para>
   Das Skript <command>/usr/share/doc/packages/smt/clientSetup4SMT.sh</command> wird mit SMT zur Verfügung gestellt. Mithilfe dieses Skripts können Sie einen Clientcomputer für die Verwendung eines SMT-Servers konfigurieren oder seine Konfiguration so ändern, dass er einen anderen SMT-Server verwendet.
  </para>

  <para>
   So konfigurieren Sie einen Clientcomputer mithilfe des Skripts <command>clientSetup4SMT.sh</command> für die Verwendung von SMT:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Kopieren Sie das Skript <filename>/usr/share/doc/packages/smt/clientSetup4SMT.sh</filename> von Ihrem SMT-Server auf den Clientcomputer.
    </para>
   </step>
   <step performance="required">
    <para>
     Führen Sie das Skript als <systemitem class="username">root</systemitem> auf dem Clientcomputer aus. Das Skript kann auf zwei Arten ausgeführt werden:
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       Auf den Skriptnamen folgt die Registrierungs-URL:
      </para>
<screen>./clientSetup4SMT.sh <replaceable>registration_URL</replaceable></screen>
      <para>
       Beispiel:
      </para>
<screen>./clientSetup4SMT.sh  https://smt.example.com/center/regsvc</screen>
     </listitem>
     <listitem>
      <para>
       Auf den Skriptnamen folgt die Option <option>--host</option> und anschließend der Hostname des SMT-Servers:
      </para>
<screen>./clientSetup4SMT.sh  --host <replaceable>server_hostname</replaceable></screen>
      <para>
       Beispiel:
      </para>
<screen>./clientSetup4SMT.sh --host  smt.example.com</screen>
     </listitem>
    </itemizedlist>
    <para>
     Das Skript lädt das CA-Zertifikat des Servers herunter.
    </para>
    <important>
     <title>Der Parameter <option>--host</option></title>
     <para>
      Der Hostname, der mit dem Parameter <option>--host</option> übergeben werden soll, muss mit dem Namen übereinstimmen, für den das Zertifikat ausgestellt wurde. Wenn im Zertifikat der vollständig qualifizierte Hostname angegeben ist (z. B. add smt.example.com), muss dieser zudem in derselben Form eingegeben werden. Bei Eingabe des <quote>kurzen</quote> Namens (smt) tritt ein Fehler beim Skript <command>clientSetup4SMT.sh</command> auf.
     </para>
    </important>
   </step>
   <step performance="required">
    <para>
     Akzeptieren Sie das CA-Zertifikat des Servers mit <keycap>j</keycap>.
    </para>
   </step>
   <step performance="required">
    <para>
     Das Skript führt alle erforderlichen Änderungen am Client durch. Bei Bedarf kann die eigentliche Registrierung durch das Skript erfolgen.
    </para>
   </step>
   <step performance="required">
    <para>
     
     Führen Sie zur Registrierung <command>SUSEConnect</command> auf dem Client aus.
    </para>
   </step>
  </procedure>




 </sect1>
 <sect1 id="sec.smt.register">
  <title>Registrieren von Clients auf einer SMT-Testumgebung</title>

  

  <para>
   Um einen Client so zu konfigurieren, dass er sich bei der Testumgebung anstelle der Produktionsumgebung registriert, verwenden Sie <command>SUSEConnect</command> auf dem Clientcomputer:
  </para>

<screen>SUSEConnect -r <replaceable>REG_CODE</replaceable></screen>

  <para>
   Ersetzen Sie <replaceable>REG_CODE</replaceable> durch den Registrierungscode Ihres Produkts. Diese Angaben finden Sie auf der Website <ulink url="http://scc.suse.com"/>.
  </para>



  <para>
   Weitere Informationen über den Einsatz von SMT in einer Testumgebung finden Sie im <emphasis>Subscription Management Tool Guide</emphasis> (SMT-Handbuch).
  </para>
 </sect1>
</chapter>
