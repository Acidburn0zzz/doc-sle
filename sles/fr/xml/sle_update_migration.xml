<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_migration.xml" version="5.0" xml:id="cha.update.spmigration">
  <title>Migration de Service&#xa0;Packs</title>
  <info>
    <abstract>
      <para>SUSE offre désormais aux administrateurs système de nouveaux outils proposant des fonctions intéressantes pour effectuer la migration de Service Packs en ligne. Il s&apos;agit d&apos;outils de ligne de commande simples, d&apos;une interface utilisateur graphique intuitive, de la prise en charge pour le <quote>retour à l&apos;état initial</quote> des Service Packs et d&apos;autres fonctions. Ce chapitre explique comment effectuer une migration de Service&#xa0;Packs étape par étape à l&apos;aide de ces nouveaux outils.</para>
    </abstract>
  </info>

  <sect1 xml:id="sec.update.migr.supported-scenarios-and-versions">
    <title>Scénarios et versions pris en charge</title>
    <para>SUSE prend en charge les scénarios suivants, que ce soit en ligne ou hors ligne&#xa0;:</para>

    <variablelist>
      <varlistentry>
        <term>En ligne</term>
        <listitem>
          <para>SUSE&#xa0;Customer&#xa0;Center, SMT (Subscription&#xa0;Management&#xa0;Tool), SUSE&#xa0;Manager</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Hors ligne</term>
        <listitem>
          <para>DVD de démarrage, clé USB, image ISO, AutoYaST, <quote>plain rpm</quote> et outils tiers</para>
        </listitem>
      </varlistentry>
    </variablelist>
    
    <para>Les versions prises en charge sont les suivantes&#xa0;:</para>
    
    <variablelist>
      <varlistentry>
        <term>En ligne</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Hors ligne</term>
        <listitem>
          <para>SUSE&#xa0;Linux&#xa0;Enterprise&#xa0;11&#xa0;SP3/SP4, SUSE&#xa0;Linux&#xa0;Enterprise&#xa0;12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Mode manuel ou fournisseurs tiers</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="sec.update.migr.workflow">
    <title>Déroulement de la migration des Service&#xa0;Packs</title>
    <para>Une migration de Service Packs peut être exécutée à l&apos;aide des outils YaST, <command>zypper</command>, AutoYaST, RPM ou d&apos;outils tiers. Seuls les deux premiers outils sont décrits dans ce chapitre. Quelle que soit la méthode utilisée, la migration de Service&#xa0;Packs comporte les étapes suivantes&#xa0;:</para>
    <orderedlist>
      <listitem>
        <para>L&apos;identification de cibles de migration possibles</para>
      </listitem>
      <listitem>
        <para>La sélection d&apos;une cible de migration</para>
      </listitem>
      <listitem>
        <para>La demande et l&apos;activation de nouveaux dépôts</para>
      </listitem>
      <listitem>
        <para>L&apos;exécution de la migration</para>
      </listitem>
    </orderedlist>

    
    <para>La liste des cibles de migration dépend des produits que vous avez installés. Si vous avez une extension installée pour laquelle le nouveau Service&#xa0;Pack n&apos;est pas encore disponible, il se peut qu&apos;aucune cible de migration ne vous soit proposée.</para>
    <para>La liste des cibles de migration disponibles pour votre hôte sera toujours récupérée à partir de SUSE&#xa0;Customer&#xa0;Center et dépendent des extensions ou des produits installés et est susceptible d&apos;évoluer au fil du temps, c&apos;est-à-dire, que la migration de SLE12&#xa0;GA vers SP2 peut par exemple être possible pour un hôte, mais impossible pour un autre.</para>
  </sect1>

  <sect1 xml:id="sec.update.migr.yast.onlinemigr">
    <title>Migration à l&apos;aide de YaST (outil de migration en ligne)</title>
    <para>Pour effectuer une migration de Service&#xa0;Packs à l&apos;aide de YaST, utilisez l&apos;outil de <guimenu>migration en ligne</guimenu> Par défaut, YaST n&apos;installe pas les paquetages à partir d&apos;un dépôt tiers. Si un paquetage a été installé à partir d&apos;un dépôt tiers, YaST empêche le remplacement des paquetages par les mêmes provenant de SUSE.
    </para>
    <procedure xml:id="pro.update.migr.yast">
      <step>
        <para>Installez les dernières mises à jour pour obtenir le module de <guimenu>migration en ligne</guimenu>.</para>
      </step>
      <step>
        <para>Installez le paquetage  <package>yast2-migration</package>
          et ses dépendances. </para>
      </step>
      <step>
        <para>Redémarrez YaST, car dans le cas contraire, le nouveau module installé ne s&apos;affiche pas dans SUSE&#xa0;Control&#xa0;Center.</para>
      </step>
      <step>
        <para>Démarrez le module de <guimenu>migration en ligne</guimenu> à partir de la section <guimenu>Système</guimenu> dans YaST. </para>
        <para>YaST affiche les cibles de migration possibles ainsi qu&apos;un récapitulatif.</para>
      </step>
      <step>
        <para>Sélectionnez une cible de la migration et cliquez ensuite sur <guimenu>Suivant</guimenu>.</para>
      </step>
      <step>
        <para>Si l&apos;outil de migration propose des dépôts de mise à jour, indiquez si vous souhaitez les télécharger. Il est recommandé d&apos;indiquer <guimenu>Oui</guimenu>.
          
        </para>
      </step>
      <step>
        <para><remark>toms 2015-09-09: FATE#319140</remark> Si l&apos;outil de migration en ligne détecte des dépôts obsolètes provenant d&apos;un DVD ou d&apos;un serveur local, il est vivement recommandé de les désactiver. Les anciens dépôts de SUSE&#xa0;Customer&#xa0;Center ou de l&apos;outil SMT sont supprimés automatiquement.
        </para>
      </step>
      <step>
        <para>Vérifiez le récapitulatif et procédez à la migration en cliquant sur <guimenu>Suivant</guimenu>. Confirmez en cliquant sur <guimenu>Start Update</guimenu> (Démarrer la mise à jour).</para>
      </step>
      <step>
        <para>Une fois la migration réussie, redémarrez votre système.</para>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="sec.update.migr.zypper.onlinemigr">
    <title>Migration à l&apos;aide de Zypper</title>
    <para>Pour effectuer une migration de Service Packs à l&apos;aide de Zypper, utilisez la migration <command>zypper</command> <option>de l&apos;outil de ligne de commande</option>.</para>
    <procedure>
      <step>
        <para>Connectez-vous à votre machine SUSE&#xa0;Linux&#xa0;Enterprise&#xa0;12.</para>
      </step>
      <step>
        <para>Installez les dernières mises à jour.</para>
      </step>
      <step>
        <para>Installez les paquetages
            <package>zypper-migration-plugin</package> et leurs dépendances. </para>
      </step>
      <step>
        <para>Exécutez la migration <command>zypper</command> <option></option>&#xa0;:</para>
        <screen><prompt>root # </prompt><command>zypper</command> migration
Executing 'zypper  patch-check'

Refreshing service 'SUSE_Linux_Enterprise_Server_12_x86_64'.
Loading repository data...
Reading installed packages...
0 patches needed (0 security patches)

Available migrations:

    1 | SUSE Linux Enterprise Server 12 SP1 x86_64</screen>
        <remark>toms 2015-09-07: From FATE#319128</remark>
        <para>Par défaut, Zypper utilise l&apos;option <option>--no-allow-vendor-change </option> transmise à <command>zypper</command> <option>dup</option> Si un paquetage a été installé à partir d&apos;un dépôt tiers, cette option empêche le remplacement des paquetages par les mêmes provenant de SUSE.
        </para>
      </step>
      <step>
        <para>
        <remark>toms 2015-09-09: FATE#319140</remark> Si Zypper détecte des dépôts obsolètes provenant d&apos;un DVD ou d&apos;un serveur local, il est vivement recommandé de les désactiver. Les anciens dépôts de SCC ou SMT sont supprimés automatiquement.
        </para>
      </step>
      <step>
        <para>Passez en revue toutes les modifications, en particulier les paquetages qui vont être supprimés. Poursuivez en saisissant <literal>y</literal> (le nombre exact de paquetages à mettre à niveau peut varier sur votre système)&#xa0;:</para>
        <screen>266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</screen>
        <para>Utilisez les touches de défilement <keycombo> <keycap function="shift"/> <keycap function="pageup"/> </keycombo> ou <keycombo> <keycap function="shift"/> <keycap function="pagedown"/> </keycombo> dans votre shell.</para>
      </step>
      <step>
        <para>Une fois la migration réussie, redémarrez votre système.</para>
      </step>
    </procedure>
  </sect1>

</chapter>
