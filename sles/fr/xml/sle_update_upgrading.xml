<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_upgrading.xml" version="5.0" xml:id="cha.update.sle">
  <title>Mise à niveau de SUSE Linux Enterprise</title>
  <info>
    <abstract>
      <para> SUSE® Linux Enterprise (SLE) permet de mettre à jour un système existant vers la nouvelle version, de SLE 11 SP4 vers SLE 12, par exemple. Aucune installation nouvelle n'est requise. Les données existantes, telles que les répertoires privés et de données, ainsi que la configuration du système, sont conservées. Vous pouvez effectuer la mise à jour à partir d'un lecteur de CD ou de DVD local ou à partir d'une source d'installation réseau centrale. </para>
        <para>Ce chapitre explique comment effectuer une mise à niveau manuelle de votre système SUSE Linux Enterprise, que ce soit à partir d'un DVD, du réseau, d'un processus automatisé ou de SUSE Manager.</para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>oui</dm:translation>
      </dm:docmanager>
  </info>

  <sect1 xml:id="sec.update.prep">
    <title>Préparatifs globaux</title>

    <para> Avant de lancer la procédure de mise à jour, assurez-vous que votre système est prêt. Cette préparation implique notamment la sauvegarde des données et la consultation des notes de version. </para>

    <sect2 xml:id="sec.update.prep.disks">
      <title>Partitionnement et espace disque</title>
      <para> Avant de commencer votre mise à jour, prenez note de la partition root. La commande <command>df /</command> énumère le nom de périphérique de la partition root. Dans l'<xref linkend="aus.update.df"/>, la partition root à écrire est <filename>/dev/sda3</filename> (montée en tant que <filename>/</filename>). </para>
      <example xml:id="aus.update.df">
        <title>List with <command>df -h</command></title>
        
        <screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       44G    4G   40G   9% /data</screen>
      </example>
      <para> La taille des logiciels tend à <quote>augmenter</quote> de versions en versions. Il convient donc de vérifier l'espace de partition disponible avec <command>df</command> avant d'effectuer la mise à jour. Si vous estimez que vous allez manquer d'espace disque, sécurisez vos données avant d'effectuer la mise à jour, puis repartitionnez votre système. Il n'existe pas de règle précise concernant l'espace de chaque partition. L'espace requis dépend de votre profil particulier de partitionnement et du logiciel sélectionné. </para>
    </sect2>

    <sect2 xml:id="sec.update.prep.btrfs-on-root">
      <title>Vérification de l'espace sur les systèmes de fichiers racine Btrfs</title>
      <para>Si vous utilisez Btrfs en tant que systèmes de fichiers racine sur votre ordinateur, assurez-vous qu'il dispose de suffisamment d'espace libre. Les deux commandes suivantes vous permettent d'obtenir de l'espace disque :      
      </para>
      <screen><prompt>root # </prompt><command>btrfs</command> filesystem df /
<prompt>root # </prompt><command>df</command> /</screen>
      <para>Les résultats des deux commandes affichent des résultats similaires concernant la quantité d'espace disque utilisée. Toutefois, le problème avec Btrfs et l'espace disponible est que vous ignorez ce qui est référencé dans un instantané et ce qui ne l'est pas. De ce fait, vous ne pouvez pas calculer la quantité d'espace disque nécessaire pour effectuer un changement.</para>
      <para>Dans le pire des cas, une mise à niveau a besoin d'autant d'espace disque que le système de fichiers racine actuel (sans le répertoire <filename>/.snapshot</filename>). En plus des systèmes de fichiers Btrfs, vérifiez l'espace libre dans les autres systèmes de fichiers également. Suivez les recommandations suivantes :
      </para>
      
      <itemizedlist>
        <listitem>
          <para>Pour tous les systèmes de fichiers comprenant Btrfs, vous avez besoin de suffisamment d'espace disque disponible pour télécharger et installer des RPM volumineux. L'espace occupé par les anciens RPM n'est libéré qu'après l'installation des nouveaux RPM.</para>
        </listitem>
        <listitem>
          <para>Pour Btrfs avec des instantanés, vous avez au minimum besoin d'une quantité d'espace libre égale à celle occupée par votre installation actuelle. Il est recommandé de disposer de deux fois plus d'espace libre que celui occupé par l'installation actuelle.
          </para>
          <para>Si vous ne disposez pas de suffisamment d'espace, vous pouvez tenter de supprimer les anciens instantanés à l'aide de <command>Snapper</command> comme ceci :
          </para>
          <screen><prompt>root # </prompt><command>snapper</command> list
<prompt>root # </prompt><command>snapper</command> delete NUMBER</screen>
          <para>Toutefois, cela ne fonctionne pas toujours. Avant la migration, la plupart des instantanés n'occupent pas tellement d'espace.</para>
        </listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="sec.update.prep.relnotes">
      <title>Vérification des notes de version</title>
      <para> Les notes de version contiennent des informations supplémentaires sur les modifications apportées depuis la version précédente de SUSE Linux Enterprise. Vérifiez si votre matériel ou configuration spécifique nécessite de prendre en compte certains aspects, déterminez quels sont vos paquetages logiciels favoris qui ont fait l'objet de modifications importantes et identifiez les précautions à prendre en plus des recommandations générales formulées dans cette section. Les notes de version incluent également des problèmes connus et des informations de dernière minute qui n'ont pas pu être intégrés au manuel. </para>
      <para> La version actuelle des notes de version contenant les informations les plus récentes relatives à <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> peut être consultée en ligne, sur le site : <link xlink:href="http://www.suse.com/doc/"/>. </para>
    </sect2>

    <sect2 xml:id="sec.update.prep.backup">
      <title>Exécution d'une sauvegarde</title>
      <para> Avant de procéder à la mise à jour, copiez les fichiers de configuration existants sur un support distinct (comme un périphérique à bande, un disque dur amovible, etc.) pour sauvegarder les données. Cela concerne principalement les fichiers stockés dans <filename>/etc</filename>, ainsi que certains des répertoires et des fichiers de <filename>/var</filename> et de <filename>/opt</filename>. Vous pouvez également écrire les données de l'utilisateur de <filename>/home</filename> (les répertoires <envar>HOME</envar>) dans un support de sauvegarde. Sauvegardez ces données en tant que <systemitem class="username">root</systemitem>. Seul l'utilisateur <systemitem class="username">root</systemitem> a des droits de lecture sur tous les fichiers locaux. </para>
      <para> Si vous avez sélectionné <guimenu>Mettre à jour un système existant</guimenu> comme mode d'installation dans YaST, vous pouvez choisir d'effectuer une sauvegarde (système) ultérieurement. Vous pouvez inclure tous les fichiers modifiés, ainsi que ceux issus du répertoire <filename>/etc/sysconfig</filename>. Il ne s'agit toutefois pas d'une sauvegarde complète, dans la mesure où il manque tous les autres répertoires importants mentionnés ci-dessus. Recherchez la sauvegarde dans le répertoire <filename>/var/adm/backup</filename>. </para>
    </sect2>

    <sect2 xml:id="sec.update.prep.mariadb">
      <title>Migration de votre base de données MySQL</title>
      <remark>toms 2015-09-03: already reviewed by Ondrej and Kristýna.</remark>
      <para>À partir de la version 12 de SUSE Linux Enterprise, SUSE est passé de MySQL à MariaDB. Avant de lancer une mise à niveau, il est vivement recommandé de sauvegarder votre base de données.
      </para>
      
      <para>Pour effectuer la migration de la base de données, procédez comme suit :</para>

      <procedure>
        <step>
          <para>Connectez-vous à votre machine SUSE Linux Enterprise 11.</para>
        </step>
        <step>
          <para>Créer un fichier de vidage :</para>
          <screen><prompt>root # </prompt><command>mysqldump</command> -u root -p --all-databases &gt; mysql_backup.sql</screen>
          <para>Par défaut, <command>mysqldump</command> ne vide pas la base de données <literal>INFORMATION_SCHEMA</literal> ni <literal>performance_schema</literal>. Pour plus d'informations, consultez la page <link xlink:href="https://dev.mysql.com/doc/refman/5.5/en/mysqldump.html"/>.
          </para>
        </step>
        <step>
          <para>Enregistrez votre fichier de vidage, le fichier de configuration <filename>/etc/my.cnf</filename> ainsi que le répertoire <filename>/etc/mysql/</filename> pour le consulter ultérieurement (<emphasis>PAS</emphasis> le répertoire d'installation) dans un endroit sûr.</para>
        </step>
        <step>
          <para>Effectuez la mise à niveau. Après la mise à niveau, votre ancien fichier de configuration <filename>/etc/my.cnf</filename> reste inchangé. La nouvelle configuration est disponible dans le fichier <filename>/etc/my.cnf.rpmnew</filename>.</para>
        </step>
        <step>
          <para>Configurez votre base de données MariaDB selon vos besoins. <emphasis>N'utilisez PAS</emphasis> les anciens répertoire et fichier de configuration. Vous pouvez toutefois les adapter et vous en servir ultérieurement comme références.</para>
        </step>
        <step>
          <para>Assurez-vous que vous démarrez le serveur MariaDB :</para>
          <screen><prompt>root # </prompt><command>systemctl</command> start mysql</screen>
          <para>Si vous voulez lancer le serveur MariaDB à chaque démarrage, activez ce service :</para>
          <screen><prompt>root # </prompt><command>systemctl</command> enable mysql</screen>
          
        </step>
        <step>
          <para>Vérifiez que MariaDB s'exécute correctement en vous connectant à la base de données :</para>
          <screen><prompt>root # </prompt><command>mysql</command> -u root -p</screen>
        </step>
      </procedure>
    </sect2>

    <sect2 xml:id="sec.update.prep.postgresql">
      <title>Migration de votre base de données PostgreSQL</title>
      <remark>toms 2015-09-09: FATE#319049</remark>
      <remark>Already reviewd by Reinhard</remark>
      <para>SLE11 SP3 et SLE12 GA obtiennent une version plus récente de la base de données PostgreSQL dans le cadre d'une mise à jour de maintenance. En raison du travail de migration requis pour la base de données, le processus de mise à niveau n'est pas automatique. De ce fait, le passage d'une version à l'autre doit être effectué manuellement. </para>
      <para>La migration est exécutée à l'aide de la commande <command>pg_upgrade</command>. Elle constitue une méthode qui diffère du vidage et du rechargement classique. Par rapport à la méthode de <quote>vidage et rechargement</quote>, la migration effectuée par le biais de la commande <command>pg_upgrade</command> est plus rapide.
      </para>
      <para>Chaque version de PostgreSQL stocke ses fichiers dans des répertoires différents selon la version. Après la mise à jour, les répertoires seront modifiés comme suit :</para>
      <variablelist>
        <varlistentry>
          <term>SLE11 SP3/SP4</term>
          <listitem>
            <para><filename>/usr/lib/postgresql91/</filename> en <filename>/usr/lib/postgresql94/</filename></para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>SLE12 GA</term>
          <listitem>
            <para>
              <filename>/usr/lib/postgresql93/</filename> en <filename>/usr/lib/postgresql94/</filename>
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
      <para>Pour effectuer la migration de la base de données, procédez comme suit :</para>
      <procedure>
        <step>
          <para>Assurez-vous que les conditions préalables suivantes sont remplies :</para>
          <itemizedlist>
            <listitem>
              <para>Si ce n'est déjà fait, mettez à niveau les paquetages de l'ancienne version de PostgreSQL vers la version la plus récente par le biais d'une mise à jour de maintenance.</para>
            </listitem>
            <listitem>
              <para>Créez une sauvegarde de votre base de données existante.</para>
            </listitem>
            <listitem>
              <para>Installez les paquetages de la nouvelle version majeure de PostgreSQL. Pour SLE12, cela implique d'installer
                  <package>postgresql94-server</package> et tous les paquetages dont il dépend.</para>
            </listitem>
            <listitem>
              <para>Installez le paquetage 
                  <package>postgresql94-contrib</package> qui contient la commande <command>pg_upgrade</command>. </para>
            </listitem>
            <listitem>
              <para>Assurez-vous que vous disposez de suffisamment d'espace disponible dans la zone de stockage des données PostgreSQL, par défaut <filename>/var/lib/pgsql/data</filename>. Si l'espace risque d'être insuffisant, essayez de réduire la taille à l'aide de la commande SQL suivante sur chaque base de données (cette opération risque d'être très longue) : </para>
              <screen>VACUUM FULL</screen>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>Arrêtez le serveur PostgreSQL :</para>
          <screen><prompt>root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
        </step>
        <step>
          <para>Renommez votre ancien répertoire de données :</para>
          <screen><prompt>root # </prompt><command>mv</command> /var/lib/pgsql/data /var/lib/pgsql/data.old</screen>
        </step>
        <step>
          <para>Créez un nouveau répertoire de données:</para>
          <screen><prompt>root # </prompt><command>mkdir</command> -p /var/lib/pgsql/data</screen>
        </step>
        <step>
          <para>Si vous avez modifié les fichiers de configuration dans l'ancienne version, copiez les fichiers <filename>postgresql.conf</filename> <filename>pg_hba.conf</filename> dans votre nouveau répertoire de <filename>données</filename> :
            <screen><prompt>root # </prompt><command>cp</command> /var/lib/pgsql/data.old/*.conf \
     /var/lib/pgsql/data</screen>
          </para>
        </step>
        <step>
          <para>Initialisez votre nouvelle instance de base de données, soit manuellement avec <command>initdb</command>, soit en démarrant et arrêtant PostgreSQL, qui le fera automatiquement :
          </para>
          <screen><prompt>root # </prompt><command>/usr/sbin/rcpostgresql</command> start
<prompt>root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
        </step>
        <step>
          <para>Démarrez le processus de migration et remplacez l'<replaceable>ANCIEN</replaceable> espace réservé par sa version antérieure :</para>
          <screen><prompt>root # </prompt><command>pg_upgrade</command> \
   --old-datadir "/var/lib/pgsql/data.old" \
   --new-datadir "/var/lib/pgsql/data" \
   --old-bindir "/usr/lib/postgresql<replaceable>OLD</replaceable>/bin/" \
   --new-bindir "/usr/lib/postgresql94/bin/"</screen>
        </step>
        <step>
          <para>Démarrez votre nouvelle instance de la base de données :</para>
          <screen><prompt>root # </prompt><command>/usr/sbin/rcpostgresql</command> start</screen>
        </step>
        <step>
          <para>Vérifiez si la migration a réussi. Il n'existe pas d'outil général permettant d'automatiser cette étape. Le choix va dépendre de votre utilisation, de la quantité ainsi que du volume que vous souhaitez tester.</para>
        </step>
        <step>
          <para>Supprimez les anciens paquetages PostgreSQL et votre ancien répertoire de données :</para>
          <screen><prompt>root # </prompt><command>zypper</command> search -s postgresql<replaceable>OLD</replaceable> | xargs zypper rm -u
<prompt>root # </prompt><command>rm</command> -rf /var/lib/pgsql/data.old</screen>
        </step>
      </procedure>
    </sect2>

    <sect2 xml:id="sec.update.prep.vms">
      <title>Arrêt des invités de machine virtuelle</title>
      <para> Si votre machine fait office de serveur hôte de machine virtuelle pour KVM ou Xen, veillez à arrêter correctement tous les invités de machine virtuelle actifs avant de procéder à la mise à jour. Dans le cas contraire, l'accès aux invités peut s'avérer impossible après la mise à jour. </para>
    </sect2>
  </sect1>

  <sect1 xml:id="sec.update.proc.prep.paths">
    <title>Chemins de mise à niveau pris en charge pour SLE</title>
    
    <important>
      <title>les mises à niveau entre architectures ne sont pas prises en charge</title>
      <para> Les mises à niveau entre architectures, comme une mise à niveau depuis une version 32 bits de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> vers la version 64 bits, ou d'un format Big Endian vers un mode Little Endian, ne sont <emphasis>pas</emphasis> prises en charge ! </para>
      <para> En particulier, la mise à niveau de SLE 1 sur POWER (Big Endian) vers SLE 12 SP1 sur POWER (nouveauté : Little Endian) n'est <emphasis>pas</emphasis> prise en charge. </para>
      <para> De plus, étant donné que SUSE Linux Enterprise 12 est une version exclusivement 64 bits, les mises à niveau à partir d'un système SUSE Linux Enterprise 11 32 bits vers SUSE Linux Enterprise 12 ou version ultérieure ne sont <emphasis>pas</emphasis> prises en charge. </para>
    </important>
    
    <para>Avant d'effectuer une migration, lisez la <xref linkend="sec.update.prep"/>.</para>

    <variablelist>
      <varlistentry>
        <term>Mise à niveau à partir de SUSE Linux Enterprise 10 (tout Service Pack)</term>
        <listitem>
          <para> Aucun chemin de migration direct vers SUSE Linux Enterprise 12 n'est pris en charge. Nous vous recommandons de procéder à une nouvelle installation. </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Mise à niveau à partir de SUSE Linux Enterprise 11 GA, SP1 ou SP2</term>
        <listitem>
          <para>Aucun chemin de migration direct vers SUSE Linux Enterprise 12 n'est pris en charge. Avant de pouvoir passer à SLE 12, vous devez au minimum disposer de SLE 11 SP3.</para>
          <para>Si vous ne pouvez pas effectuer de nouvelle installation, vous devez d'abord effectuer une mise à jour de SLE 11 GA vers SP1, puis de SLE 11 SP1 vers SP2 et enfin de SLE 11 SP2 vers SP3. Ces étapes sont décrites dans le <link xlink:href="https://www.suse.com/documentation/sles11/">Guide de déploiement de SUSE Linux Enterprise 11</link>. </para>
          <para> Passez ensuite à la <xref linkend="sec.update.sle12"/>. </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Mise à niveau de SUSE Linux Enterprise 11 SP3 ou SP4 </term>
        <listitem>
          <para> Reportez-vous au chapitre <xref linkend="sec.update.sle12"/> pour obtenir des informations détaillées. </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Mise à niveau de SUSE Linux Enterprise 12 vers SP1</term>
        <listitem>
          <para>Reportez-vous au chapitre <xref linkend="cha.update.spmigration"/> pour obtenir des informations détaillées.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="sec.update.sle12">
  <title>Méthodes prises en charge pour mettre à niveau SUSE Linux Enterprise</title>
  <remark>toms 2014-02-11: See FATEs #315969 and #313189</remark>
  <para>
   La mise à niveau de SUSE Linux Enterprise 11 SP3 vers SUSE Linux Enterprise 12, SUSE Linux Enterprise 11 SP3 vers SUSE Linux Enterprise 12 SP1 ou SUSE Linux Enterprise 11 SP4 vers SUSE Linux Enterprise 12 SP1 est prise en charge à l'aide de l'une des méthodes suivantes :
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Mise à niveau manuelle, démarrage à partir d'un support d'installation (reportez-vous à la <xref linkend="sec.update.sle12.manual"/>).
    </para>
   </listitem>
   <listitem>
    <para>
     Migration semi-automatisée possible via SSH <phrase os="sles"> (reportez-vous à la <xref linkend="sec.update.sle12.automated"/>) </phrase> ou au <xref linkend="cha.update.spmigration"/>.
    </para>
   </listitem>
  </itemizedlist>
  </sect1>

  <sect1 xml:id="sec.update.sle12.manual">
   <title>Mise à niveau manuelle de SLE 11 SP3 vers SLE 12 SP1 à l'aide d'une source d'installation</title>
   <para>
    Avant de mettre à niveau votre système, lisez d'abord la <xref linkend="sec.update.prep"/>.
   </para>
   <para>
    Pour mettre à niveau votre système de cette manière, le démarrage doit être effectué à partir d'une source d'installation, comme s'il s'agissait d'une première installation. Toutefois, lorsque l'écran de démarrage apparaît, vous devez sélectionner <guimenu>Mettre à niveau</guimenu> (au lieu d'<guimenu>Installation</guimenu>). La source d'installation à partir de laquelle démarrer peut être l'une des suivantes :
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Un support d'installation local (un DVD ou une image ISO sur un périphérique de stockage de masse USB). Pour obtenir des instructions détaillées, reportez-vous à la <xref linkend="sec.update.sle12.manual.dvd"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      Une source d'installation réseau. Vous pouvez démarrer à partir d'un support local, puis sélectionner le type d'installation réseau respectif ou démarrez via PXE. Pour obtenir des instructions détaillées, reportez-vous à la <xref linkend="sec.update.sle12.manual.network"/>.
     </para>
    </listitem>
   </itemizedlist>
   <sect2 xml:id="sec.update.sle12.manual.dvd">
    <title>Mise à niveau à partir d'un support d'installation</title>
    <para>
     La procédure ci-dessous décrit le démarrage à partir d'un DVD à titre d'exemple, mais vous pouvez également utiliser un support d'installation local comme une image ISO sur un périphérique de stockage de masse USB. La façon de sélectionner la méthode de démarrage et de démarrer le système à partir du support dépend de l'architecture système. Vous devez également savoir si la machine est équipée d'un BIOS ou UEFI traditionnel. Pour plus de détails, reportez-vous aux liens ci-dessous.
    </para>
    <procedure xml:id="pro.update.sle12.manual.dvd">
     <title>Mise à niveau manuelle à partir de SLE 11 SP3 vers SLE 12 SP1 à l'aide d'un DVD</title>
     <step>
      <para>
       Insérez le 1er DVD du support d'installation de SUSE Linux Enterprise 12 SP1 et démarrez votre machine. L'écran <guimenu>Bienvenue</guimenu> s'affiche, suivi de l'écran de démarrage.
      </para>
     </step>
     <step>
      <para>
       Sélectionnez la méthode de démarrage respective pour démarrer le système à partir du support (reportez-vous à la <xref linkend="sec.i.yast2.method"/>).
      </para>
     </step>
     <step>
      <para>
       Démarrez le système à partir du support (reportez-vous à la <xref linkend="sec.i.yast2.startup"/>).
      </para>
     </step>
     <step>
      <para>
       Effectuez la procédure de mise à niveau, comme décrit à la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
      </para>
     </step>
    </procedure>
   </sect2>
   <sect2 xml:id="sec.update.sle12.manual.network">
    <title>Mise à niveau à partir d'une source d'installation réseau</title>
    <para>
     Si vous voulez démarrer une mise à niveau à partir d'une source d'installation réseau, veillez à respecter les conditions suivantes :
    </para>
    <variablelist>
     <title>Configuration requise pour la mise à niveau à partir d'une source d'installation réseau</title>
     <varlistentry>
      <term>Source d'installation réseau</term>
      <listitem>
       <para>
        Une source d'installation réseau est configurée conformément à la <xref linkend="sec.deployment.remoteinst.instserver"/>.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Connexion réseau et services réseau</term>
      <listitem>
       <para>
        Le serveur d'installation et l'ordinateur cible disposent d'une connexion réseau qui fonctionne. Le réseau doit fournir les services suivants : un service de noms, DHCP (facultatif, mais nécessaire au démarrage via PXE) et OpenSLP (facultatif).
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Support d'installation</term>
      <listitem>
       <para>
        Vous disposez du 1er DVD de SUSE Linux Enterprise (ou d'une image ISO locale) pour démarrer le système cible <emphasis>ou</emphasis> un système cible qui est configuré pour le démarrage via PXE comme indiqué à la <xref linkend="sec.deployment.remoteinst.boot.pxeprep" xrefstyle="HeadingOnPage"/>. Reportez-vous au <xref linkend="cha.deployment.remoteinst"/> pour obtenir des informations détaillées sur le démarrage d'une mise à niveau à partir d'un serveur distant.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     Lors de la mise à niveau à partir de la source d'installation réseau, vous pouvez démarrer à partir du support local, puis sélectionner le type d'installation réseau respectif ou démarrer via PXE. Sélectionnez la méthode de votre choix et procédez comme indiqué dans la <xref linkend="pro.update.sle12.manual.network.boot-from-dvd" xrefstyle="select:label"/> ou la <xref linkend="pro.update.sle12.manual.network.pxe-boot" xrefstyle="select:label"/>.
    </para>
    <procedure xml:id="pro.update.sle12.manual.network.boot-from-dvd">
     <title>mise à niveau manuelle à partir de SLE 11 SP3 ou SP4 vers SLE 12 SP1 à l'aide d'une source d'installation réseau - Démarrage à partir d'un DVD</title>
     <para>
      Cette procédure fournit l'exemple d'un démarrage à partir d'un DVD, mais vous pouvez également utiliser tout autre support d'installation local comme une image ISO sur un périphérique de stockage de masse USB. La façon de sélectionner la méthode de démarrage et de démarrer le système à partir du support dépend de l'architecture système. Vous devez également savoir si la machine est équipée d'un BIOS ou UEFI traditionnel. Pour plus de détails, reportez-vous aux liens ci-dessous.
     </para>
     <step>
      <para>
       Insérez le 1er DVD du support d'installation SUSE Linux Enterprise 12 SP1 et démarrez votre machine. L'écran <guimenu>Bienvenue</guimenu> s'affiche, suivi de l'écran de démarrage.
      </para>
     </step>
     <step>
      <para>
       Sélectionnez le type de source d'installation réseau que vous souhaitez utiliser (FTP, HTTP, NFS, SMB ou SLP). En général, ce choix est disponible en appuyant sur la touche <keycap>F4</keycap>, mais si votre machine est équipée d'UEFI au lieu d'un BIOS traditionnel, vous devrez peut-être adapter manuellement les paramètres de démarrage. Pour plus de détails, reportez-vous à la section <xref linkend="sec.i.yast2.source.net"/> du <xref linkend="cha.inst"/>.
      </para>
     </step>
     <step>
      <para>
       Effectuez la procédure de mise à niveau, comme décrit à la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
      </para>
     </step>
    </procedure>
    <procedure xml:id="pro.update.sle12.manual.network.pxe-boot">
     <title>mise à niveau manuelle à partir de SLE 11 SP3 ou SP4 vers SLE 12 SP1 à l'aide d'une source d'installation réseau - Démarrage à l'aide de PXE</title>
     <para>
      Pour effectuer une mise à niveau à partir d'une source d'installation réseau à l'aide d'un démarrage PXE, procédez comme suit :
     </para>
     <step>
      <para>
       Ajustez la configuration de votre serveur DHCP afin de fournir les informations relatives à l'adresse indispensables à un démarrage à l'aide de PXE. Pour plus de détails, reportez-vous à la <xref linkend="sec.deployment.remoteinst.boot.pxeprep"/>.
      </para>
     </step>
     <step>
      <para>
       Configurez un serveur TFTP qui devra contenir l'image de démarrage requise pour un démarrage à l'aide de PXE. Pour ce faire, utilisez le 1er DVD du support d'installation de SUSE Linux Enterprise 12 SP1 ou suivez les instructions de la <xref linkend="sec.deployment.remoteinst.boot.tftp"/>.
      </para>
     </step>
     <step>
      <para>
       Préparez le démarrage de PXE et de Wake-on-LAN sur l'ordinateur cible.
      </para>
     </step>
     <step>
      <para>
       Lancez le démarrage du système cible et utilisez VNC pour vous connecter à distance à la routine d'installation s'exécutant sur cet ordinateur. Pour plus d'informations, reportez-vous à la <xref linkend="sec.deployment.remoteinst.monitor.vnc"/>.
      </para>
     </step>
     <step>
      <para>
       Effectuez la procédure de mise à niveau, comme décrit à la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
      </para>
     </step>
    </procedure>
   </sect2>
  </sect1>

  <sect1 xml:id="sec.update.sle12.automated">
   <title>Migration automatique de SLE 11 SP3 ou SP4 vers SLE 12 SP1</title>
   <para>
    Avant de mettre à niveau votre système, lisez d'abord la <xref linkend="sec.update.prep"/>. Pour effectuer une migration automatisée, procédez comme suit :
   </para>
   <procedure xml:id="pro.update.sle12.automated">
    <title>migration automatisée de SUSE Linux Enterprise 11 SP3 vers SUSE Linux Enterprise 12 SP1</title>
    <remark>toms 2014-03-19: See FATE#315037</remark>
    <remark role="future">toms 2014-03-20: From SLE12 SP1 on, we should probably base
    this example on GRUB2, but not for GA.</remark>
     <remark>jsrain 2015-09-02: This is still the old system; at some point
       of time we should switch to GRUB2, but as long as amjority of
       customers still runs SLE11, I would stay with legacy GRUB. Anyway, we
       could include both op6tions, that would be probably best solution</remark>
    <step>
     <para>
      Copiez le kernel d'installation <filename>linux</filename> et le fichier <filename>initrd</filename> à partir du répertoire <filename>/boot/x86_64/loader/</filename> de votre premier DVD d'installation dans le répertoire <filename>/boot</filename> de votre système :
     </para>
<screen><command>cp</command> -vi <replaceable>DVDROOT</replaceable>/boot/x86_64/loader/linux /boot/linux.upgrade
<command>cp</command> -vi <replaceable>DVDROOT</replaceable>/boot/x86_64/loader/initrd /boot/initrd.upgrade</screen>
     <para>
      <replaceable>DVDROOT</replaceable> indique le chemin où votre système monte le DVD ; il s'agit généralement de <filename>/run/media/$USER/$DVDNAME</filename>.
     </para>
    </step>
    <step>
     <para>
      Ouvrez le fichier de configuration hérité GRUB <filename>/boot/grub/menu.lst</filename> et ajoutez une autre section. Pour les autres chargeurs de démarrage, modifiez le ou les fichiers de démarrage correspondants. Adaptez les noms des périphériques et le paramètre <parameter>root</parameter> en conséquence. Par exemple :
     </para>
<screen>title Linux Upgrade Kernel
kernel (hd0,0)/boot/linux.upgrade root=/dev/sda1 upgrade=1 <replaceable>OPTIONAL_PARAMETERS</replaceable>
initrd (hd0,0)/boot/initrd.upgrade</screen>
     <para>
      <replaceable>OPTIONAL_PARAMETERS</replaceable> indique des paramètres de démarrage supplémentaires dont vous pourriez avoir besoin pour démarrer votre système et effectuer la mise à niveau. Il peut s'agir de paramètres kernel nécessaires pour votre système. Vérifiez si vous devez les copier à partir d'une entrée GRUB existante. Il peut également s'agir de <link xlink:href="http://en.opensuse.org/Linuxrc">paramètres linuxrc SUSE, documentés en ligne</link>.
     </para>
    </step>
    <step>
     <para>
      Si la mise à niveau doit être automatisée <phrase os="sles"> (voir la <xref linkend="sec.update.auto.run"/>)</phrase>, ajoutez <option>autoupgrade=1</option> à la fin de la ligne <literal>kernel</literal> de votre configuration GRUB.
     </para>
    </step>
    <step>
     <para>
      Redémarrez votre machine et sélectionnez la nouvelle section à partir du menu de démarrage (dans le cas présent : <emphasis>Linux Upgrade Kernel</emphasis>). Vous pouvez utiliser <command>grubonce</command> pour présélectionner la nouvelle entrée grub pour un redémarrage automatique dans la nouvelle entrée. Vous pouvez également utiliser <command>reboot</command> pour lancer le redémarrage à partir de la ligne de commande.
     </para>
    </step>
    <step>
     <para>
      Effectuez la procédure de mise à niveau habituelle, comme décrit à la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
     </para>
    </step>
    <step>
     <para>
      Une fois la procédure de mise à niveau terminée, supprimez le kernel d'installation et les fichiers initrd (<filename>/boot/linux.upgrade</filename> et <filename>/boot/initrd.upgrade</filename>). Ils ne sont plus nécessaires.
     </para>
    </step>
   </procedure>
  </sect1>

  <sect1 xml:id="sec.update.sle12.start.upgr.after.boot">
   <title>Lancement de la procédure de mise à niveau après le démarrage</title>
   <para>
    <remark>taroth 2014-11-13: argh, the following is terminology hell regarding
     the software strings: "upgrade"/"update" are used intermittently and
     without clear differentiation...</remark>
   </para>
   <procedure>
    <step>
     <para>
      Après avoir démarré (à partir d'un support d'installation ou du réseau), sélectionnez l'entrée <guimenu>Mise à niveau</guimenu> dans l'écran de démarrage.
     </para>
     <warning>
      <title>un choix erroné risque de vous faire perdre des données</title>
      <para>
       Si vous sélectionnez <guimenu>Installation</guimenu> au lieu de <guimenu>Mise à niveau</guimenu>, vous risquez de perdre des données ultérieurement. Soyez vigilant afin de ne pas détruire vos partitions de données en effectuant une nouvelle installation, par exemple, en repartitionnant les disques (ce qui risque de détruire les partitions existantes) ou en reformatant les partitions de données (ce qui efface toutes les données qui y sont stockées).
      </para>
      <para>
       Veillez à bien sélectionner <guimenu>Mettre à niveau</guimenu> dans ce cas.
      </para>
     </warning>
     <para>
      YaST démarre le système d'installation.
     </para>
    </step>
    <step>
     <para>
      Dans l'écran <guimenu>Bienvenue</guimenu>, sélectionnez la <guimenu>Langue</guimenu> et le <guimenu>Clavier</guimenu>, puis acceptez l'accord de licence. Cliquez ensuite sur <guimenu>Suivant</guimenu>.
     </para>
     <para>
      YaST recherche dans vos partitions les systèmes SUSE Linux Enterprise déjà installés.
     </para>
    </step>
    <step>
     <para>
      Dans l'écran <guimenu>Sélectionner pour la mise à niveau</guimenu>, sélectionnez la partition à mettre à niveau et cliquez sur <guimenu>Suivant</guimenu>.
     </para>
     <para>
      YaST monte la partition sélectionnée et affiche tous les dépôts trouvés sur la partition que vous souhaitez mettre à niveau.
     </para>
    </step>
    <step>
     <para>
      Dans l'écran <guimenu>Dépôts utilisés précédemment</guimenu>, adaptez le statut des dépôts : cochez ceux que vous souhaitez inclure dans le processus de mise à niveau et désactivez ceux dont vous n'avez plus besoin. Cliquez ensuite sur <guimenu>Suivant</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Dans l'écran <guimenu>Enregistrement</guimenu>, indiquez si vous voulez enregistrer le système mis à niveau maintenant (en introduisant vos données d'enregistrement et en cliquant sur <guimenu>Suivant</guimenu>) ou si vous préférez <guimenu>Ignorer l'enregistrement</guimenu> pour l'instant. Pour plus d'informations sur l'enregistrement de votre système, reportez-vous à la <xref linkend="sec.update.registersystem"/>.
     </para>
     <para>
      L'écran <guimenu>Paramètres d'installation</guimenu> est la dernière étape avant le début de la mise à niveau.
     </para>
    </step>
    <step>
     <para>
      Passez en revue les <guimenu>paramètres d'installation</guimenu> de la mise à niveau, notamment les <guimenu>options de mise à jour</guimenu>. Sélectionnez l'une des options suivantes :
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <guimenu>Mettre à jour uniquement les paquetages installés</guimenu>. Avec cette option, vous risquez de passer à côté des nouvelles fonctionnalités livrées avec la dernière version de SUSE Linux Enterprise.
       </para>
      </listitem>
      <listitem>
       <para>
        <guimenu>Mise à jour avec l'installation d'un nouveau logiciel et de nouvelles fonctionnalités</guimenu>. Cliquez sur <guimenu>Sélectionner les schémas</guimenu> si vous souhaitez personnaliser l'activation ou la désactivation des schémas et paquetages.
       </para>
      </listitem>
     </itemizedlist>

     <note>
      <title>Choix du poste de travail</title>
      <para>
       Si vous utilisiez KDE avant la mise à niveau vers SUSE Linux Enterprise 12 (<varname>DEFAULT_WM)</varname> dans <filename>/etc/sysconfig/windowmanager</filename> avait été défini sur <literal>KDE*)</literal>, votre environnement de bureau sera automatiquement remplacé par GNOME après la mise à niveau. Par défaut, le gestionnaire d'affichage KDM sera remplacé par GDM.
      </para>
      <para>
       Pour modifier l'environnement de bureau ou le gestionnaire de fenêtres, sélectionnez d'autres logiciels en cliquant sur <guimenu>Sélectionner les schémas</guimenu>.
      </para>
     </note>
    </step>
    <step>
     <para>
      Si tous les paramètres vous conviennent, démarrez la procédure d'installation et de suppression en cliquant sur <guimenu>Mettre à jour</guimenu>.
     </para>
    </step>
   </procedure>
  </sect1>

  <sect1 xml:id="sec.update.sle12.manager">
   <title>Mise à jour via SUSE Manager</title>
   <para>
    SUSE Manager est une solution serveur pour fournir des mises à jour et des correctifs pour les clients SUSE Linux Enterprise. Il s'accompagne d'un ensemble d'outils et d'une interface utilisateur Web pour les tâches de gestion.
   </para>
   <para>
     <remark>toms 2015-08-24: Adapt this link to a better source; at the
     time being, this was the best what we can get.</remark> La documentation de SUSE Manager disponible sur le site <link xlink:href="https://www.suse.com/documentation/suse_manager/book_susemanager_install/data/s1-maintenance-update.html"/> fournit un aperçu de ses fonctionnalités, ainsi que des instructions sur la configuration du serveur et des clients.
   </para>
  </sect1>

  <sect1 xml:id="sec.update.registersystem">
    <title>Enregistrement de votre système</title>

    <para>
      Si vous avez ignoré l'étape d'enregistrement pendant l'installation, vous pourrez enregistrer votre système par la suite à l'aide du module <guimenu>Enregistrement du produit</guimenu> de YaST.
    </para>
    <para>L'enregistrement de vos systèmes vous offre les avantages suivants :</para>
    <itemizedlist>
      <listitem>
        <para>Vous bénéficiez d'un support.</para>
      </listitem>
      <listitem>
        <para>Vous recevez les mises à jour de sécurité et les résolutions de bogues.</para>
      </listitem>
      <listitem>
        <para>Vous avez accès au SUSE Customer Center.</para>
      </listitem>
    </itemizedlist>

    <procedure>
      <step>
        <para>
          Démarrez YaST et sélectionnez <menuchoice> <guimenu>Logiciels</guimenu> <guimenu>Enregistrement du produit</guimenu> </menuchoice>pour ouvrir la boîte de dialogue <guimenu>Enregistrement</guimenu>.
        </para>
      </step>
      <step>
        <para>
          Indiquez l'<guimenu>Adresse électronique</guimenu> associée au compte SUSE que vous ou votre entreprise utilisez pour gérer les abonnements. Si vous ne disposez pas encore de compte SUSE, rendez-vous sur la page d'accueil du SUSE Customer Center (<link xlink:show="new" xlink:href="https://scc.suse.com/"/>) pour en créer un.
        </para>
      </step>
      <step>
        <para>
          Entrez le <guimenu>Code d'enregistrement</guimenu> que vous avez reçu avec votre exemplaire de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
        </para>
      </step>
      <step xml:id="step.y2.register.final">
        <para>
          Appuyez sur <guimenu>Suivant</guimenu> pour lancer la procédure d'enregistrement. Si un ou plusieurs serveurs d'enregistrement locaux sont disponibles sur votre réseau, vous pouvez faire votre choix dans une liste. Vous pouvez également cliquer sur <guimenu>Annuler</guimenu> pour ignorer les serveurs d'enregistrement locaux et vous enregistrer auprès du serveur SUSE par défaut.
        </para>
        <para>
          Au cours de l'enregistrement, les canaux de mise à jour en ligne sont ajoutés à la configuration de votre installation.
        </para>
        <para>
          Une fois l'enregistrement réussi, YaST affiche la liste des extensions, produits complémentaires et modules disponibles pour votre système. Pour les sélectionner et les installer, passez à la <xref linkend="sec.add-ons.extensions"/>.
        </para>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="sec.update.sle12.multiversion">
    <title>Conservation des paquetages de kernel</title>
    <remark>toms 2015-08-26: bsc#753809</remark> <remark>toms 2015-08-26: some parts are taken ("stolen") from the
      wiki at https://en.opensuse.org/SDB:Keep_multiple_kernel_versions
      and adapted
    </remark> <indexterm> <primary>kernels multiversion</primary> </indexterm>
    <para>Lors de l'installation d'un nouveau kernel à l'aide de YaST ou de Zypper, SUSE Linux Enterprise conserve les deux derniers kernels et celui en cours d'exécution. Dans la plupart des cas, c'est suffisant.</para>
    <para>Toutefois, dans certains cas, vous souhaiterez conserver plusieurs versions de kernel, par exemple, à des fins de test. Pour vous offrir cette possibilité, SUSE Linux Enterprise prend en charge la <emphasis>fonction de kernel multiversion</emphasis>. L'activation et la configuration de cette fonction permettent de modifier et de configurer son comportement par défaut afin qu'elle effectue l'une des actions suivantes : </para>
    <itemizedlist>
      <listitem>
        <para>supprimer un ancien kernel uniquement lorsque le système a été redémarré avec le nouveau kernel ;</para>
      </listitem>
      <listitem>
        <para>conserver un certain nombre d'anciens kernels comme solution de secours ;</para>
      </listitem>
      <listitem>
        <para>conserver une version de kernel spécifique. </para>
      </listitem>
    </itemizedlist>
    <para>Lorsque vous redémarrez, un script compare la liste des kernels installés avec les paramètres dans <filename>/etc/zypp/zypp.conf</filename> et supprime ceux qui ne sont plus nécessaires. </para>
    <sect2 xml:id="sec.update.sle12.multiversion.enable">
      <title>Activation de la fonction de kernel multiversion</title>
      <para>Le comportement par défaut est défini dans le fichier de configuration <filename>/etc/zypp/zypp.conf</filename> :</para>
      <screen><prompt>root # </prompt><command>grep</command> ^multiversion /etc/zypp/zypp.conf
multiversion = provides:multiversion(kernel)
multiversion.kernels = latest,latest-1,running</screen>
      <para>Supprimez le caractère dièse (#) avant la ligne <literal>multiversion </literal> ci-dessus pour activer cette fonction. (Il devrait déjà avoir été supprimé). La seconde ligne permet de configurer les <emphasis>kernels</emphasis> à conserver. Vous devez activer les deux, sinon le système conserve <emphasis>tous</emphasis> les kernels, ce qui risque de surcharger votre disque dur. </para>
      <para>La ligne <literal>multiversion.kernels</literal> peut contenir plusieurs mots-clés pour former diverses combinaisons et se présenter dans un ordre différent :</para>
      <variablelist>
        <varlistentry>
          <term><option>latest</option></term>
          <listitem>
            <para>Conserve le kernel ayant le numéro de version le plus élevé</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>latest-<replaceable>N</replaceable></option></term>
          <listitem>
            <para>Conserve les kernels avec les énièmes numéros de version les plus élevés ; <replaceable/><replaceable>N</replaceable> étant tout nombre à partir de 1</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>running</option></term>
          <listitem>
            <para>Conserve le kernel actuellement en cours d'exécution</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>oldest</option></term>
          <listitem>
            <para>Conserve le kernel ayant le plus petit numéro de version (le kernel fourni avec le produit publié)</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>oldest-<replaceable>N</replaceable></option></term>
          <listitem>
            <para>Conserve le kernel avec les énièmes numéros (<replaceable>N</replaceable>) de version les moins élevées ;</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>3.12.28-4.6</option></term>
          <listitem>
            <para>Conserve la version exacte du kernel mentionné</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="sec.update.sle12.multiversion.deleteoldkernel">
      <title>Cas d'utilisation : suppression d'un ancien kernel uniquement après le redémarrage</title>
      <para>Vous souhaitez être certain que l'ancien kernel ne sera supprimé qu'après avoir redémarré le nouveau kernel. </para>
      <para>Remplacez la ligne suivante dans <filename>/etc/zypp/zypp.conf</filename> :</para>
      <screen>multiversion.kernels = latest,running</screen>
      <para>Les paramètres précédents indiquent au système de ne conserver la dernière version du kernel et celle en cours d'exécution que si elles sont différentes.</para>
    </sect2>

    <sect2 xml:id="sec.update.sle12.multiversion.fallback">
      <title>Cas d'utilisation : conservation des anciens kernels comme solution de secours</title>
      <para>Vous souhaitez conserver une ou plusieurs versions de kernel afin d'en avoir un ou plusieurs <quote>de rechange</quote>.</para>
      <para>Ce cas d'utilisation peut s'avérer utile si vous avez besoin de kernels à des fins de test. En cas de problème (si votre ordinateur ne démarre pas, par exemple), vous pouvez toujours utiliser une ou plusieurs versions de kernel valides connues.</para>
      <para>Remplacez la ligne suivante dans <filename>/etc/zypp/zypp.conf</filename> :</para>
      <screen>multiversion.kernels = latest,latest-1,latest-2,running</screen>
      <para>Lorsque vous redémarrez votre système après l'installation d'un nouveau kernel, le système conserve trois kernels : le nouveau kernel qui est celui en cours d'exécution (configuré en tant que <literal>latest,running</literal>), la version précédente du nouveau kernel (configurée en tant que <literal>latest-1</literal>) et le prédécesseur de la version précédente du kernel (configuré en tant que <literal>latest-2</literal>). </para>
    </sect2>

    <sect2 xml:id="sec.update.sle12.multiversion.specificversion">
      <title>Cas d'utilisation : conservation d'une version de kernel spécifique</title>
      <para>Vous effectuez régulièrement des mises à jour système et installez de nouvelles versions de kernel. Toutefois, vous compilez également votre propre version du kernel pour diverses raisons et voulez être certain que le système la conserve.
      </para>
      <para>Remplacez la ligne suivante dans <filename>/etc/zypp/zypp.conf</filename> :</para>
      <screen>multiversion.kernels = latest,3.12.28-4.20,running</screen>
      <para>Lorsque vous redémarrez votre système après l'installation d'un nouveau kernel, le système conserve deux kernels : le nouveau kernel qui est celui en cours d'exécution (configuré en tant que <literal>latest,running</literal> et celui compilé par vos soins (configuré en tant que <literal>3.12.28-4.20</literal>).
      </para>
    </sect2>
  </sect1>
</chapter>
