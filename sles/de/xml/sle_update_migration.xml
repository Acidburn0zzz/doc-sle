<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_migration.xml" version="5.0" xml:id="cha.update.spmigration">
  <title>Service Pack-Migration</title>
  <info>
    <abstract>
      <para>SUSE bietet Systemadministratoren einige neue Tools mit interessanten Funktionen für die Online-Migration von Service Packs. Diese sind einfache Befehlszeilentools, eine intuitive grafische Benutzeroberfläche, Unterstützung für das <quote>Rollback</quote> von Service Packs und dergleichen mehr. In diesem Kapitel wird die Ausführung einer Service Pack-Migration mit den neuen Tools Schritt für Schritt erläutert.</para>
    </abstract>
  </info>

  <sect1 xml:id="sec.update.migr.supported-scenarios-and-versions">
    <title>Unterstützte Szenarios und Versionen</title>
    <para>SUSE unterstützt folgende Szenarios (offline oder online):</para>

    <variablelist>
      <varlistentry>
        <term>Online</term>
        <listitem>
          <para>SUSE Customer Center, Subscription Management Tool (SMT), SUSE Manager</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Offline</term>
        <listitem>
          <para>Boot-DVD, USB-Stick, ISO-Image, AutoYaST, <quote>reines RPM</quote> und Drittanbieter-Tools</para>
        </listitem>
      </varlistentry>
    </variablelist>
    
    <para>Folgende Versionen werden unterstützt:</para>
    
    <variablelist>
      <varlistentry>
        <term>Online</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Offline</term>
        <listitem>
          <para>SUSE Linux Enterprise 11 SP3/SP4, SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Manuell/Drittanbieter</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="sec.update.migr.workflow">
    <title>Arbeitsfluss der Service Pack-Migration</title>
    <para>Eine Service Pack-Migration kann mit YaST, <command>zypper</command>, AutoYaST, RPM oder Drittanbieter-Tools ausgeführt werden. In diesem Kapitel werden nur die ersten beiden Verfahren beschrieben. Unabhängig von der Methode besteht eine Service Pack-Migration jedoch immer aus den folgenden Schritten:</para>
    <orderedlist>
      <listitem>
        <para>Ermitteln der möglichen Migrationsziele</para>
      </listitem>
      <listitem>
        <para>Auswahl des Migrationsziels</para>
      </listitem>
      <listitem>
        <para>Anfordern und Aktivieren neuer Repositorys</para>
      </listitem>
      <listitem>
        <para>Ausführen der Migration</para>
      </listitem>
    </orderedlist>

    
    <para>Die Liste der Migrationsziele ist abhängig von den installierten Produkten. Falls Sie eine Erweiterung installiert haben, für die das neue Service Pack noch nicht zur Verfügung steht, wird Ihnen unter Umständen gar kein Migrationsziel angeboten.</para>
    <para>Die Liste der für Ihren Host verfügbaren Migrationsziele wird immer vom SUSE Customer Center abgerufen. Sie ist abhängig von den installierten Produkten und Erweiterungen und kann sich mit der Zeit ändern. Möglicherweise ist also eine Migration von SLE12 GA nach SP2 für einen Host möglich, für einen anderen hingegen nicht.</para>
  </sect1>

  <sect1 xml:id="sec.update.migr.yast.onlinemigr">
    <title>Migration mit YaST (Tool für die Online-Migration)</title>
    <para>Für eine Service Pack-Migration mit YaST verwenden Sie das Tool für die <guimenu>Online-Migration</guimenu>. YaST installiert standardmäßig keine Pakete aus Repositorys von Drittanbietern. Wurde ein Paket aus einem Repository eines Drittanbieters installiert, verhindert YaST, dass das Paket durch das gleiche Paket aus SUSE ersetzt wird.
    </para>
    <procedure xml:id="pro.update.migr.yast">
      <step>
        <para>Installieren Sie die neuesten Aktualisierungen, um das Modul für die <guimenu>Online-Migration</guimenu> zu erhalten.</para>
      </step>
      <step>
        <para>Installieren Sie das Paket <package>yast2-migration</package>
          und seine Abhängigkeiten. </para>
      </step>
      <step>
        <para>Starten Sie YaST neu, damit das neu installierte Modul im Kontrollzentrum angezeigt wird.</para>
      </step>
      <step>
        <para>Starten Sie das Modul für die <guimenu>Online-Migration</guimenu> in YaST aus dem Abschnitt <guimenu>System</guimenu>. </para>
        <para>YaST zeigt die möglichen Migrationsziele und eine Zusammenfassung an.</para>
      </step>
      <step>
        <para>Wählen Sie ein Migrationsziel aus und fahren Sie mit <guimenu>Weiter</guimenu> fort.</para>
      </step>
      <step>
        <para>Falls das Tool für die Online-Migration Aktualisierungsrepositorys anbietet, entscheiden Sie sich, ob Sie diese haben möchten. Es empfiehlt sich, auf <guimenu>Ja</guimenu> zu klicken.
          
        </para>
      </step>
      <step>
        <para><remark>toms 2015-09-09: FATE#319140</remark> Falls das Tool für die Online-Migration alte Repositorys von DVD oder einem lokalen Server findet, empfiehlt es sich dringend, diese zu deaktivieren. Alte Repositorys aus SUSE Customer Center oder Subscription Management Tool werden automatisch entfernt.
        </para>
      </step>
      <step>
        <para>Prüfen Sie die Zusammenfassung und klicken Sie dann auf <guimenu>Weiter</guimenu>, um mit der Migration fortzufahren. Bestätigen Sie die Migration mit <guimenu>Aktualisierung starten</guimenu>.</para>
      </step>
      <step>
        <para>Starten Sie Ihr System nach einer erfolgreichen Migration neu.</para>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="sec.update.migr.zypper.onlinemigr">
    <title>Migration mit Zypper</title>
    <para>Für eine Service Pack-Migration mit Zypper verwenden Sie das Befehlszeilentool <command>zypper</command> <option>migration</option>.</para>
    <procedure>
      <step>
        <para>Melden Sie sich auf dem SUSE Linux Enterprise&#xa0;12-Computer an.</para>
      </step>
      <step>
        <para>Installieren Sie die neuesten Aktualisierungen.</para>
      </step>
      <step>
        <para>Installieren Sie die Pakete
            <package>zypper-migration-plugin</package> und ihre Abhängigkeiten. </para>
      </step>
      <step>
        <para>Führen Sie das Befehlszeilentool <command>zypper</command> <option>migration</option> aus:</para>
        <screen><prompt>root # </prompt><command>zypper</command> migration
Executing 'zypper  patch-check'

Refreshing service 'SUSE_Linux_Enterprise_Server_12_x86_64'.
Loading repository data...
Reading installed packages...
0 patches needed (0 security patches)

Available migrations:

    1 | SUSE Linux Enterprise Server 12 SP1 x86_64</screen>
        <remark>toms 2015-09-07: From FATE#319128</remark>
        <para>Zypper verwendet standardmäßig die Option <option>--no-allow-vendor-change</option>, die an <command>zypper</command> <option>dup</option> weitergeleitet wird. Wurde ein Paket aus einem Repository eines Drittanbieters installiert, verhindert diese Option, dass das Paket durch das gleiche Paket aus SUSE ersetzt wird.
        </para>
      </step>
      <step>
        <para>
        <remark>toms 2015-09-09: FATE#319140</remark> Falls Zypper alte Repositorys von DVD oder einem lokalen Server findet, empfiehlt es sich dringend, diese zu deaktivieren. Alte SCC- oder SMT-Repositorys werden automatisch entfernt.
        </para>
      </step>
      <step>
        <para>Prüfen Sie alle Änderungen, insbesondere die Pakete, die entfernt werden. Geben Sie <literal>y</literal> ein, um fortzufahren (die Anzahl der Pakete, die aktualisiert werden können, ist von System zu System unterschiedlich):</para>
        <screen>266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</screen>
        <para>Verwenden Sie zum Blättern in Ihrer Shell die Tasten <keycombo> <keycap function="shift"/> <keycap function="pageup"/> </keycombo> oder <keycombo> <keycap function="shift"/> <keycap function="pagedown"/> </keycombo>.</para>
      </step>
      <step>
        <para>Starten Sie Ihr System nach einer erfolgreichen Migration neu.</para>
      </step>
    </procedure>
  </sect1>

</chapter>
