<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="urn:x-suse:rng:geekodoc5-flat.rnc" type="application/relax-ng-compact-syntax"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_teaming.xml" version="5.1" xml:id="sec.team">
 <title>Einrichten von Team-Geräten für Netzwerk-Teaming</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>Ja</dm:translation>
  </dm:docmanager>
 </info>

 <remark>toms 2016-06-16: FATE#320468</remark>

 <para>
  Der Begriff <quote>Link-Aggregation</quote> ist der allgemeine Begriff zum Beschreiben der Kombination (oder Aggregation) einer Netzwerkverbindung zum Bereitstellen einer logischen Ebene. Manchmal stoßen Sie auf Begriffe wie <quote>Channel-Teaming</quote>, <quote>Ethernet-Bonding</quote>, <quote>Port Truncating</quote> usw. Dies sind Synonyme des Begriffs und bezeichnen dasselbe Konzept.
 </para>

 <para>
  Dieses Konzept ist allgemein bekannt als <quote>Bonding</quote> und wurde ursprünglich in den Linux-Kernel integriert (Informationen zur 
ursprünglichen Implementierung finden Sie in <xref linkend="sec.bond"/>). Der Begriff <emphasis>Netzwerk-Teaming</emphasis> wird zum Bezeichnen der neuen Implementierung dieses Konzepts verwendet.
 </para>

 <para>
  Der Hauptunterschied zwischen Bonding und Netzwerk-Teaming ist der, dass das Teaming eine Reihe an kleinen Kernel-Modulen bereitstellt, die für die Bereitstellung einer Schnittstelle für die teamd-Instanzen verantwortlich sind. Alles andere wird im Userspace verarbeitet. Dies unterscheidet sich von der ursprünglichen Bondings-Implementierung, die alle ihre Funktionen ausschließlich im Kernel enthält.
 </para>

 <para>
  Beide Implementierungen, Bonding und Netzwerk-Teaming, können parallel verwendet werden. Netzwerk-Teaming ist eine Alternative zur bestehenden Bondings-Implementierung. Es ersetzt das Bonding nicht.
 </para>

 <para>
  Netzwerk-Teaming kann für verschiedene Anwendungsfälle verwendet werden. Die beiden wichtigsten Anwendungsfälle werden später erläutert und umfassen:
 </para>

 <itemizedlist>
  <listitem>
   <para>
    Lastausgleich zwischen Netzwerkgeräten.
   </para>
  </listitem>
  <listitem>
   <para>
    Failover von einem Netzwerkgerät zu einem anderen, falls eines der Geräte einen Fehler aufweist.
   </para>
  </listitem>
 </itemizedlist>

 <para>
  <remark>toms 2016-06-21: FATE#320947 for Teaming in/with YaST</remark> Zurzeit ist kein YaST-Modul vorhanden, dass das Erstellen eines Teaming-Geräts unterstützt. Sie müssen Netzwerk-Teaming manuell konfigurieren. Das allgemeine Verfahren ist unten dargestellt und kann auf alle Netzwerk-Teaming-Konfigurationen angewendet werden:
 </para>

 <procedure xml:id="pro.team.general">
  <title>Allgemeines Verfahren</title>
  <step>
   <para>
    Stellen Sie sicher, dass alle erforderlichen Pakete installiert sind. Installieren Sie die Pakete
    <package>libteam-tools</package>
    ,
    <package>libteamdctl0</package>
    ,
    <package>libteamdctl0</package>
     und
    <package>python-libteam</package>
    .
   </para>
  </step>
  <step>
   <para>
    Erstellen Sie eine Konfigurationsdatei unter <filename>/etc/sysconfig/network/</filename>. In der Regel ist dies <filename>ifcfg-team0</filename>. Benötigen Sie mehr als ein Netzwerk-Teaming-Gerät, teilen Sie ihnen aufsteigende Nummern zu.
   </para>
   <para>
    Diese Konfigurationsdatei enthält mehrere Variablen, die auf den man-Seiten erläutert werden (siehe <command>man ifcfg</command> und <command>man ifcfg-team</command>).
   </para>
  </step>
  <step>
   <para>
    Entfernen Sie die Konfigurationsdatei der Schnittstellen, die für das Teaming-Gerät verwendet werden (in der Regel <filename>ifcfg-eth0</filename> und <filename>ifcfg-eth1</filename>).
   </para>
   <para>
    Es wird empfohlen, eine Sicherung zu erstellen und beide Dateien zu löschen. Wicked legt die Konfigurationsdateien mit den erforderlichen Parametern für Teaming neu an.
   </para>
  </step>
  <step>
   <para>
    Optional können Sie überprüfen, ob alle Angeben in der Konfigurationsdatei von Wicked enthalten sind:
   </para>
<screen>wicked show-config</screen>
  </step>
  <step>
   <para>
    Starten Sie das Netzwerk-Teaming-Gerät <systemitem class="service">team0</systemitem>:
   </para>
<screen>wicked all ifup team0</screen>
   <para>
    Falls Sie zusätzliche Informationen zur Fehlersuche benötigen, verwenden Sie die Option <option>--debug all</option> nach dem Subkommando <command>all</command>.
   </para>
  </step>
  <step>
   <para>
    Überprüfen Sie den Status des Netzwerk-Teaming-Geräts. Führen Sie hierzu die folgenden Kommandos aus:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Status der teamd-Instanz von Wicked abrufen:
     </para>
<screen>wicked ifstatus --verbose team0</screen>
    </listitem>
    <listitem>
     <para>
      Status der gesamten Instanz abrufen:
     </para>
<screen>teamdctl team0 state</screen>
    </listitem>
    <listitem>
     <para>
      systemd-Status der teamd-Instanz abrufen:
     </para>
<screen>systemctl status teamd@team0</screen>
    </listitem>
   </itemizedlist>
   <para>
    Jedes Kommando zeigt eine etwas andere Ansicht abhängig von Ihren Anforderungen an.
   </para>
  </step>
  <step>
   <para>
    Falls Sie nachträglich Änderungen in der Datei <filename>ifcfg-team0</filename> vornehmen müssen, laden Sie die Konfiguration der Datei mit folgendem Kommando neu:
   </para>
<screen>wicked ifreload team0</screen>
  </step>
 </procedure>

 <para>
  Verwenden Sie <emphasis>nicht</emphasis> <command>systemctl</command> zum Starten oder Stoppen des Teaming-Geräts! Verwenden Sie stattdessen das Kommando <command>wicked</command>, wie oben gezeigt.
 </para>

 <sect2 xml:id="sec.team.lb">
  <title>Anwendungsfall: Lastenausgleich mit Netzwerk-Teaming</title>
  <para>
   Der Lastenausgleich wird zum Verbessern der Bandbreite verwendet. Verwenden Sie die folgende Konfigurationsdatei zum Erstellen eines Netzwerk-Teaming-Geräts mit Funktionen für den Lastenausgleich. Fahren Sie mit <xref linkend="pro.team.general"/> fort, um das Gerät einzurichten. Überprüfen Sie die Ausgabe mit <command>teamdctl</command>.
  </para>
  <example xml:id="ex.team.lb">
   <title>Konfiguration für Lastenausgleich mit Netzwerk-Teaming</title>
<screen>STARTMODE=auto <co xml:id="co.team.lb.startmode"/>
BOOTPROTO=static <co xml:id="co.team.lb.boot-and-ip"/>
IPADDRESS="192.168.1.1/24" <xref linkend="co.team.lb.boot-and-ip"/>
IPADDR6="fd00:deca:fbad:50::1/64" <xref linkend="co.team.lb.boot-and-ip"/>

TEAM_RUNNER="loadbalance" <co xml:id="co.team.lb.loadbalance"/>
TEAM_LB_TX_HASH="ipv4,ipv6,eth,vlan"
TEAM_LB_TX_BALANCER_NAME="basic"
TEAM_LB_TX_BALANCER_INTERVAL="100"

TEAM_PORT_DEVICE_0="eth0" <co xml:id="co.team.lb.dev"/>
TEAM_PORT_DEVICE_1="eth1" <xref linkend="co.team.lb.dev"/>

TEAM_LW_NAME="ethtool" <co xml:id="co.team.lb.name"/>
TEAM_LW_ETHTOOL_DELAY_UP="10" <co xml:id="co.team.lb.ethtool.delay"/>
TEAM_LW_ETHTOOL_DELAY_DOWN="10" <xref linkend="co.team.lb.ethtool.delay"/></screen>

   <calloutlist>
    <callout arearefs="co.team.lb.startmode">
     <para>
      Steuert das Starten des Teaming-Geräts. Der Wert <literal>auto</literal> bedeutet, dass die Schnittstelle eingerichtet wird, wenn der Netzwerkdienst verfügbar ist, und bei jedem Reboot automatisch gestartet wird.
     </para>
     <para>
      Falls Sie das Gerät selbst steuern müssen (und das automatische Starten vermeiden möchten) legen Sie für <varname>STARTMODE</varname> den Wert <literal>manual</literal> fest.
     </para>
    </callout>
    <callout arearefs="co.team.lb.boot-and-ip">
     <para>
      Legt eine statische IP-Adresse fest (hier <systemitem class="ipaddress">192.168.1.1</systemitem> für IPv4 und <systemitem class="ipaddress">fd00:deca:fbad:50::1</systemitem> für IPv6).
     </para>
     <para>
      Wenn das Netzwerk-Teaming-Gerät eine dynamische IP-Adresse verwenden soll, legen Sie <literal>BOOTPROTO="dhcp"</literal> fest und entfernen (oder kommentieren) Sie die Zeile mit
      <varname>IPADDRESS</varname> und <varname>IPADDR6</varname>.
     </para>
    </callout>
    <callout arearefs="co.team.lb.loadbalance">
     <para>
      Legt für <varname>TEAM_RUNNER</varname> den Wert <literal>loadbalance</literal> fest, um den Modus für den Lastenausgleich zu aktivieren.
     </para>
    </callout>
    <callout arearefs="co.team.lb.dev">
     <para>
      Gibt ein oder mehrere Geräte an, die aggregiert werden sollen, um das Netzwerk-Teaming-Gerät zu bilden.
     </para>
    </callout>
    <callout arearefs="co.team.lb.name">
     <para>
      Definiert eine Verbindungsüberwachung, die den Status der untergeordneten Geräte überwacht. Mit dem Standardwert <literal>ethtool</literal> wird nur überprüft, ob das Gerät aktiv und erreichbar ist. Hierdurch erfolgt die Überprüfung recht schnell. Jedoch wird nicht überprüft, ob das Gerät wirklich Pakete senden und empfangen kann.
     </para>
     <para>
      Wenn Sie wirklich sicher sein müssen, dass die Verbindung einwandfrei funktioniert, verwenden Sie die Option <literal>arp_ping</literal>. Damit werden Ping-Kommandos an einen beliebigen Host geschickt (dies ist in der Variable  <varname>TEAM_LW_ARP_PING_TARGET_HOST</varname>
      konfiguriert). Nur, wenn die Antworten empfangen werden, wird das Netzwerk-Teaming-Gerät als aktiv betrachtet.
     </para>
    </callout>
    <callout arearefs="co.team.lb.ethtool.delay">
     <para>
      Definiert die Verzögerung in Millisekunden zwischen dem Verbindungsaufbau (oder -abbau) und der Benachrichtigung des Runner.
     </para>
    </callout>
   </calloutlist>
  </example>
 </sect2>

 <sect2 xml:id="sec.team.dhcp">
  <title>Anwendungsfall: Failover mit Netzwerk-Teaming</title>
  <para>
   Failover wird verwendet, um eine hohe Verfügbarkeit kritischer Netzwerk-Teaming-Geräte sicherzustellen, indem ein paralleles Sicherungsnetzwerkgerät verwendet wird. Das Sicherungsnetzwerkgerät ist ständig aktiv und übernimmt die Funktionen, wenn das Hauptgerät ausfällt.
  </para>
  <para>
   Verwenden Sie die folgende Konfigurationsdatei zum Erstellen eines Netzwerk-Teaming-Geräts mit Failover-Funktionen. Fahren Sie mit <xref linkend="pro.team.general"/> fort, um das Gerät einzurichten. Überprüfen Sie die Ausgabe mit <command>teamdctl</command>.
  </para>
  <example xml:id="ex.team.failover">
   <title>Konfiguration für DHCP-Netzwerk-Teaming-Gerät</title>
<screen>STARTMODE=auto <co xml:id="co.team.failover.startmode"/>
BOOTPROTO=static <co xml:id="co.team.failover.boot-and-ip"/>
IPADDR="192.168.1.2/24" <xref linkend="co.team.failover.boot-and-ip"/>
IPADDR6="fd00:deca:fbad:50::2/64" <xref linkend="co.team.failover.boot-and-ip"/>

TEAM_RUNNER=activebackup <co xml:id="co.team.failover.activebackup"/>
TEAM_PORT_DEVICE_0="eth0" <co xml:id="co.team.failover.dev"/>
TEAM_PORT_DEVICE_1="eth1" <xref linkend="co.team.failover.dev"/>

TEAM_LW_NAME=ethtool <co xml:id="co.team.failover.name"/>
TEAM_LW_ETHTOOL_DELAY_UP="10" <co xml:id="co.team.failover.ethtool.delay"/>
TEAM_LW_ETHTOOL_DELAY_DOWN="10" <xref linkend="co.team.failover.ethtool.delay"/></screen>
   <calloutlist>
    <callout arearefs="co.team.failover.startmode">
     <para>
      Steuert das Starten des Teaming-Geräts. Der Wert <literal>auto</literal> bedeutet, dass die Schnittstelle eingerichtet wird, wenn der Netzwerkdienst verfügbar ist und bei jedem Reboot automatisch gestartet wird.
     </para>
     <para>
      Falls Sie das Gerät selbst steuern müssen (und das automatische Starten vermeiden möchten) legen Sie für <varname>STARTMODE</varname> den Wert <literal>manual</literal> fest.
     </para>
    </callout>
    <callout arearefs="co.team.failover.boot-and-ip">
     <para>
      Legt eine statische IP-Adresse fest (hier <systemitem class="ipaddress">192.168.1.2</systemitem> für IPv4 und <systemitem class="ipaddress">fd00:deca:fbad:50::2</systemitem> für IPv6).
     </para>
     <para>
      Wenn das Netzwerk-Teaming-Gerät eine dynamische IP-Adresse verwenden soll, legen Sie <literal>BOOTPROTO="dhcp"</literal> fest und entfernen (oder kommentieren) Sie die Zeile mit
      <varname>IPADDRESS</varname> und <varname>IPADDR6</varname>.
     </para>
    </callout>
    <callout arearefs="co.team.failover.activebackup">
     <para>
      Legt für <varname>TEAM_RUNNER</varname> den Wert <literal>activebackup</literal> fest, um den Failover-Modus zu aktivieren.
     </para>
    </callout>
    <callout arearefs="co.team.failover.dev">
     <para>
      Gibt ein oder mehrere Geräte an, die aggregiert werden sollen, um das Netzwerk-Teaming-Gerät zu bilden.
     </para>
    </callout>
    <callout arearefs="co.team.failover.name">
     <para>
      Definiert eine Verbindungsüberwachung, die den Status der untergeordneten Geräte überwacht. Mit dem Standardwert <literal>ethtool</literal> wird nur überprüft, ob das Gerät aktiv und erreichbar ist. Hierdurch erfolgt die Überprüfung recht schnell. Jedoch wird nicht überprüft, ob das Gerät wirklich Pakete senden und empfangen kann.
     </para>
     <para>
      Wenn Sie wirklich sicher sein müssen, dass die Verbindung einwandfrei funktioniert, verwenden Sie die Option <literal>arp_ping</literal>. Damit werden Ping-Kommandos an einen beliebigen Host geschickt (dies ist in der Variable  <varname>TEAM_LW_ARP_PING_TARGET_HOST</varname>
      konfiguriert). Nur, wenn die Antworten empfangen werden, wird das Netzwerk-Teaming-Gerät als aktiv betrachtet.
     </para>
    </callout>
    <callout arearefs="co.team.failover.ethtool.delay">
     <para>
      Definiert die Verzögerung in Millisekunden zwischen dem Verbindungsaufbau (oder -abbau) und der Benachrichtigung des Runner.
     </para>
    </callout>
   </calloutlist>
  </example>
 </sect2>
</sect1>
