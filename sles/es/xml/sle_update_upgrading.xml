<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_upgrading.xml" version="5.0" xml:id="cha.update.sle">
  <title>Actualización de SUSE Linux Enterprise</title>
  <info>
    <abstract>
      <para> SUSE® Linux Enterprise (SLE) permite actualizar un sistema existente a la nueva versión, por ejemplo, de SLE 11 SP4 a SLE 12. No es preciso realizar una nueva instalación. Los datos que ya existan, como los directorios personales y la configuración del sistema, permanecen intactos. La actualización se puede realizar desde una unidad local de CD o DVD o desde un origen de instalación de red. </para>
        <para>En este capítulo se explica cómo actualizar manualmente el sistema SUSE Linux Enterprise, ya sea mediante un DVD, la red, un proceso automatizado o SUSE Manager.</para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>sí</dm:translation>
      </dm:docmanager>
  </info>

  <sect1 xml:id="sec.update.prep">
    <title>Preparativos generales</title>

    <para> Antes de iniciar el procedimiento de actualización, asegúrese de que el sistema está debidamente preparado. Entre otros aspectos, los preparativos requieren realizar una copia de seguridad de los datos y comprobar las notas de la versión. </para>

    <sect2 xml:id="sec.update.prep.disks">
      <title>Particionamiento y espacio en disco</title>
      <para> Antes de empezar el proceso de actualización, anote la partición raíz. El comando <command>df /</command> muestra el nombre de dispositivo de la partición raíz. Por ejemplo, en el <xref linkend="aus.update.df"/>, la partición raíz que debe escribir es <filename>/dev/sda3</filename> (montada como <filename>/</filename>). </para>
      <example xml:id="aus.update.df">
        <title>Lista que se obtiene con <command>df -h</command></title>
        
        <screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       44G    4G   40G   9% /data</screen>
      </example>
      <para> El software tiende a <quote>crecer</quote> de una versión a la siguiente. Por ello, antes de actualizar debe saber de cuánto espacio dispone en la partición, empleando para ello el comando <command>df</command>. Si sospecha que no dispone de mucho espacio en el disco, asegure los datos antes de actualizar el sistema y volver a particionarlo. No existe ninguna regla general sobre cuánto espacio debe tener cada partición. Los requisitos de espacio dependen de cada perfil de particiones concreto y del software que se seleccione. </para>
    </sect2>

    <sect2 xml:id="sec.update.prep.btrfs-on-root">
      <title>Comprobación de espacio en sistemas de archivos raíz Btrfs</title>
      <para>Si usa Btrfs como sistema de archivos raíz en su equipo, asegúrese de que hay suficiente espacio libre. Para averiguar el espacio en disco disponible, se pueden usar estos dos comandos:      
      </para>
      <screen><prompt>root # </prompt><command>btrfs</command> filesystem df /
<prompt>root # </prompt><command>df</command> /</screen>
      <para>El resultado de los dos comandos muestra cifras similares sobre el espacio en disco usado. Sin embargo, el problema con Btrfs y el espacio libre es que no es posible determinar a qué se hace referencia en una instantánea: no es posible calcular cuánto espacio en disco necesitará un cambio.</para>
      <para>En el peor de los casos, una actualización necesitará tanto espacio en disco como el que ocupa el sistema de archivos raíz actual (sin <filename>/.snapshot</filename>). Además de los sistemas de archivos Btrfs, se debe comprobar también el espacio libre en otros sistemas de archivos. Se ha comprobado que las recomendaciones siguientes funcionan:
      </para>
      
      <itemizedlist>
        <listitem>
          <para>Para todos los sistemas de archivos, incluido Btrfs, se necesita espacio libre suficiente en el disco para descargar e instalar RPM de gran tamaño. El espacio de los RPM antiguos solo se libera después de que se instalen los RPM nuevos.</para>
        </listitem>
        <listitem>
          <para>En el caso de Btrfs con instantáneas, se necesita como mínimo el mismo espacio libre que el que ocupa la instalación actual. Se recomienda disponer del doble de espacio libre que el que ocupa la instalación actual.
          </para>
          <para>Si no tiene espacio libre suficiente, puede intentar suprimir instantáneas antiguas con <command>Snapper</command>, como se indica aquí:
          </para>
          <screen><prompt>root # </prompt><command>snapper</command> list
<prompt>root # </prompt><command>snapper</command> delete NUMBER</screen>
          <para>Sin embargo, esto podría no ser de ayuda en todos los casos. Antes de la migración, la mayoría de las instantáneas ocupan poco espacio.</para>
        </listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="sec.update.prep.relnotes">
      <title>Comprobación de las notas de la versión</title>
      <para> En las notas de la versión puede encontrar información adicional respecto a los cambios desde la versión previa de SUSE Linux Enterprise. Verifique si su hardware específico o configuración necesita alguna consideración especial, cuál de sus paquetes específicos de software preferidos ha cambiado considerablemente, y qué precauciones debería tomar, además de las recomendaciones generales de esta sección. Las notas de la versión también proporcionan la información más reciente y fallos conocidos que no pudieron publicarse en el manual a tiempo. </para>
      <para> Puede consultar en línea la versión actual del documento de notas de la versión de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>con la información más reciente en <link xlink:href="http://www.suse.com/doc/"/>. </para>
    </sect2>

    <sect2 xml:id="sec.update.prep.backup">
      <title>Creación de una copia de seguridad</title>
      <para> Antes de actualizar, copie los archivos de configuración existentes en un medio independiente (un dispositivo de cinta, un disco duro extraíble, etc.) para realizar una copia de seguridad de los datos. Esta recomendación se aplica fundamentalmente a los archivos almacenados en <filename>/etc</filename>, además de a algunos directorios y archivos de <filename>/var</filename> y <filename>/opt</filename>. También puede ser conveniente escribir los datos de usuario del directorio <filename>/home</filename> (los directorios <envar>HOME</envar>) en un medio de copia de seguridad. Haga una copia de seguridad de esos datos como usuario <systemitem class="username">Root</systemitem>. Solo los usuarios <systemitem class="username">Root</systemitem> disponen de permiso de lectura para todos los archivos locales. </para>
      <para> Si ha seleccionado <guimenu>Actualizar un sistema existente</guimenu> como modo de instalación en YaST, puede optar por realizar una copia de seguridad (del sistema) en un momento posterior. Puede seleccionar la inclusión de todos los archivos modificados y los archivos del directorio <filename>/etc/sysconfig</filename>. Sin embargo, no se trata de una copia de seguridad completa, ya que faltarían otros directorios importantes mencionados anteriormente. Busque la copia de seguridad en el directorio <filename>/var/adm/backup</filename>. </para>
    </sect2>

    <sect2 xml:id="sec.update.prep.mariadb">
      <title>Migración de la base de datos MySQL</title>
      <remark>toms 2015-09-03: already reviewed by Ondrej and Kristýna.</remark>
      <para>A partir de la versión SUSE Linux Enterprise 12, SUSE cambió de MySQL a MariaDB. Antes de empezar cualquier actualización, se recomienda encarecidamente realizar una copia de seguridad de la base de datos.
      </para>
      
      <para>A fin de realizar la migración de la base de datos, siga el siguiente procedimiento:</para>

      <procedure>
        <step>
          <para>Entre a la sesión en el equipo con SUSE Linux Enterprise 11.</para>
        </step>
        <step>
          <para>Cree un archivo de volcado de memoria:</para>
          <screen><prompt>root # </prompt><command>mysqldump</command> -u root -p --all-databases &gt; mysql_backup.sql</screen>
          <para>Por defecto, <command>mysqldump</command> no realiza el volcado de <literal>INFORMATION_SCHEMA</literal> ni de la base de datos <literal>performance_schema</literal>. Para obtener más información, consulte <link xlink:href="https://dev.mysql.com/doc/refman/5.5/en/mysqldump.html"/>.
          </para>
        </step>
        <step>
          <para>Guarde el archivo de volcado de memoria, el archivo de configuración <filename>/etc/my.cnf</filename> y el directorio <filename>/etc/mysql/</filename> para su investigación posterior (<emphasis>NO</emphasis> para la instalación) en un lugar seguro.</para>
        </step>
        <step>
          <para>Realice la actualización. Después de la actualización, el archivo de configuración anterior <filename>/etc/my.cnf</filename> seguirá intacto. Encontrará la nueva configuración en el archivo <filename>/etc/my.cnf.rpmnew</filename>.</para>
        </step>
        <step>
          <para>Configure la base de datos MariaDB según sus necesidades. <emphasis>NO</emphasis> use el archivo de configuración ni el directorio anterior, en su lugar, empléelos como recordatorios y adáptelos.</para>
        </step>
        <step>
          <para>Asegúrese de iniciar el servidor de MariaDB:</para>
          <screen><prompt>root # </prompt><command>systemctl</command> start mysql</screen>
          <para>Si desea iniciar el servidor de MariaDB cada vez que arranque, habilite el servicio:</para>
          <screen><prompt>root # </prompt><command>systemctl</command> enable mysql</screen>
          
        </step>
        <step>
          <para>Conéctese a la base de datos para verificar que MariaDB se está ejecutando correctamente:</para>
          <screen><prompt>root # </prompt><command>mysql</command> -u root -p</screen>
        </step>
      </procedure>
    </sect2>

    <sect2 xml:id="sec.update.prep.postgresql">
      <title>Migración de la base de datos PostgreSQL</title>
      <remark>toms 2015-09-09: FATE#319049</remark>
      <remark>Already reviewd by Reinhard</remark>
      <para>En SLE11 SP3 y SLE12 GA hay una nueva versión de la base de datos PostgreSQL como actualización de mantenimiento. Debido al trabajo de migración necesario de la base de datos, no existe un proceso de actualización automático. Por lo tanto, el cambio de una versión a otra se debe realizar manualmente. </para>
      <para>El proceso de migración se realiza mediante el comando <command>pg_upgrade</command>, que es un método alternativo al clásico de volcado y recarga. En comparación con el método de <quote>volcado y recarga</quote>, con <command>pg_upgrade</command> la migración tarda menos tiempo.
      </para>
      <para>En cada versión de PostgreSQL, los archivos se almacenan de forma distinta en directorios que varían según la versión. Después de actualizar, los directorios cambiarán a:</para>
      <variablelist>
        <varlistentry>
          <term>SLE11 SP3/SP4</term>
          <listitem>
            <para><filename>/usr/lib/postgresql91/</filename> a <filename>/usr/lib/postgresql94/</filename></para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>SLE12 GA</term>
          <listitem>
            <para>
              <filename>/usr/lib/postgresql93/</filename> a <filename>/usr/lib/postgresql94/</filename>
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
      <para>A fin de realizar la migración de la base de datos, siga el siguiente procedimiento:</para>
      <procedure>
        <step>
          <para>Asegúrese de que se cumplen las siguientes condiciones previas:</para>
          <itemizedlist>
            <listitem>
              <para>Si aún no lo ha hecho, actualice todos los paquetes de la versión anterior de PostgreSQL a la más reciente mediante una actualización de mantenimiento.</para>
            </listitem>
            <listitem>
              <para>Cree una copia de seguridad de la base de datos existente.</para>
            </listitem>
            <listitem>
              <para>Instale los paquetes de la nueva versión principal de PostgreSQL. En el caso de SLE12, esto significa instalar
                  <package>postgresql94-server</package> y todos los paquetes de los que depende.</para>
            </listitem>
            <listitem>
              <para>Instale el paquete
                  <package>postgresql94-contrib</package> que contiene el comando <command>pg_upgrade</command>. </para>
            </listitem>
            <listitem>
              <para>Asegúrese de que dispone de suficiente espacio libre en el área de datos de PostgreSQL, que por defecto es <filename>/var/lib/pgsql/data</filename>. Si hay poco espacio, intente reducir el tamaño con los comandos siguientes de SQL en cada base de datos (esta operación puede tardar mucho tiempo): </para>
              <screen>VACUUM FULL</screen>
            </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>Detenga el servidor de PostgreSQL:</para>
          <screen><prompt>root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
        </step>
        <step>
          <para>Renombre el directorio de datos anterior:</para>
          <screen><prompt>root # </prompt><command>mv</command> /var/lib/pgsql/data /var/lib/pgsql/data.old</screen>
        </step>
        <step>
          <para>Cree un directorio de datos nuevo:</para>
          <screen><prompt>root # </prompt><command>mkdir</command> -p /var/lib/pgsql/data</screen>
        </step>
        <step>
          <para>Si ha cambiado los archivos de configuración en la versión anterior, copie los archivos <filename>postgresql.conf</filename> <filename>pg_hba.conf</filename> al nuevo directorio <filename>data</filename>:
            <screen><prompt>root # </prompt><command>cp</command> /var/lib/pgsql/data.old/*.conf \
     /var/lib/pgsql/data</screen>
          </para>
        </step>
        <step>
          <para>Inicialice la nueva instancia de la base de datos manualmente con <command>initdb</command> o iniciando y deteniendo PostgreSQL, con lo que el proceso se realizará automáticamente:
          </para>
          <screen><prompt>root # </prompt><command>/usr/sbin/rcpostgresql</command> start
<prompt>root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
        </step>
        <step>
          <para>Inicie el proceso de migración y sustituya el espacio reservado <replaceable>OLD</replaceable> con la versión anterior:</para>
          <screen><prompt>root # </prompt><command>pg_upgrade</command> \
   --old-datadir "/var/lib/pgsql/data.old" \
   --new-datadir "/var/lib/pgsql/data" \
   --old-bindir "/usr/lib/postgresql<replaceable>OLD</replaceable>/bin/" \
   --new-bindir "/usr/lib/postgresql94/bin/"</screen>
        </step>
        <step>
          <para>Inicie la nueva instancia de la base de datos:</para>
          <screen><prompt>root # </prompt><command>/usr/sbin/rcpostgresql</command> start</screen>
        </step>
        <step>
          <para>Compruebe si la migración se ha realizado correctamente. No existe ninguna herramienta general para automatizar este paso. La extensión de las pruebas y los elementos que se someterán a ellas dependerán de su situación de uso concreto.</para>
        </step>
        <step>
          <para>Elimine todos los paquetes anteriores de PostgreSQL y el directorio de datos antiguo:</para>
          <screen><prompt>root # </prompt><command>zypper</command> search -s postgresql<replaceable>OLD</replaceable> | xargs zypper rm -u
<prompt>root # </prompt><command>rm</command> -rf /var/lib/pgsql/data.old</screen>
        </step>
      </procedure>
    </sect2>

    <sect2 xml:id="sec.update.prep.vms">
      <title>Apagado de máquinas virtuales de invitado</title>
      <para> Si el equipo hace de Host VM Server para KVM o Xen, asegúrese de apagar correctamente cualquier Guest VM en ejecución antes de actualizar. De lo contrario, quizá no pueda acceder a los sistemas invitados tras la actualización. </para>
    </sect2>
  </sect1>

  <sect1 xml:id="sec.update.proc.prep.paths">
    <title>Vías de actualización admitidas para SLE</title>
    
    <important>
      <title>no se admiten actualizaciones de arquitecturas cruzadas</title>
      <para> Las actualizaciones de arquitecturas cruzadas, como actualizar de una versión 32 bits de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> a la versión 64 bits, o actualizar de big-endian a little-endian, <emphasis>no</emphasis> se admiten. </para>
      <para> Específicamente, SLE 11 en POWER (big endian) a SLE 12 SP1 en POWER (nuevo: ¡little endian!), <emphasis>no</emphasis> se admite. </para>
      <para> Además, como SUSE Linux Enterprise 12 es solo de 64 bits, las actualizaciones de cualquier sistema de 32 bits de SUSE Linux Enterprise 11 a SUSE Linux Enterprise 12 <emphasis>no</emphasis> se admiten. </para>
    </important>
    
    <para>Antes de realizar cualquier migración, consulte la <xref linkend="sec.update.prep"/>.</para>

    <variablelist>
      <varlistentry>
        <term>Actualizar de SUSE Linux Enterprise 10 (cualquier paquete de servicios o Service Pack)</term>
        <listitem>
          <para> No se admite ninguna vía de migración directa a SUSE Linux Enterprise 12. En su lugar, se recomienda realizar una nueva instalación. </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Actualización desde SUSE Linux Enterprise 11 GA, SP1 o SP2</term>
        <listitem>
          <para>No se admite ninguna vía de migración directa a SUSE Linux Enterprise 12. Debe tener instalado al menos SLE 11 SP3 para poder continuar a SLE 12.</para>
          <para>Si no puede realizar una instalación nueva, primero debe actualizar desde SLE 11 GA a SP1, a continuación de SLE 11 SP1 a SP2 y, por último, de SLE 11 SP2 a SP3. Estos pasos se describen en la <link xlink:href="https://www.suse.com/documentation/sles11/">Guía de distribución de SUSE Linux Enterprise 11</link>. </para>
          <para> A continuación, siga con la <xref linkend="sec.update.sle12"/>. </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Actualización desde de SUSE Linux Enterprise 11 SP3 o SP4</term>
        <listitem>
          <para> Consulte la <xref linkend="sec.update.sle12"/> para obtener más detalles. </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Actualización desde SUSE Linux Enterprise 12 a SP1</term>
        <listitem>
          <para>Consulte el <xref linkend="cha.update.spmigration"/> para obtener más detalles.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="sec.update.sle12">
  <title>Métodos compatibles para actualizar SUSE Linux Enterprise</title>
  <remark>toms 2014-02-11: See FATEs #315969 and #313189</remark>
  <para>
   Se admite la actualización de SUSE Linux Enterprise 11 SP3 a SUSE Linux Enterprise 12, de SUSE Linux Enterprise 11 SP3 a SUSE Linux Enterprise 12 SP1 o de SUSE Linux Enterprise 11 SP4 a SUSE Linux Enterprise 12 SP1. Para ello, se debe seguir uno de estos métodos:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Actualización manual, con arranque desde un medio de instalación (consulte la <xref linkend="sec.update.sle12.manual"/>).
    </para>
   </listitem>
   <listitem>
    <para>
     Migración semiautomatizada, posible mediante SSH <phrase os="sles">(consulte la <xref linkend="sec.update.sle12.automated"/>)</phrase> o con <xref linkend="cha.update.spmigration"/>.
    </para>
   </listitem>
  </itemizedlist>
  </sect1>

  <sect1 xml:id="sec.update.sle12.manual">
   <title>Actualización manual desde SLE 11 SP3 a SLE 12 SP1 mediante un origen de instalación</title>
   <para>
    Antes de actualizar el sistema, lea la <xref linkend="sec.update.prep"/>.
   </para>
   <para>
    Para actualizar el sistema de este modo, debe arrancarlo desde un origen de instalación, como haría en el caso de una instalación nueva. Sin embargo, cuando aparece la pantalla de arranque, debe seleccionar la opción <guimenu>Actualizar</guimenu> (en lugar de <guimenu>Instalación</guimenu>). El origen de instalación desde el que se deberá arrancar puede ser uno de los siguientes:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Un medio de instalación local (como un DVD o una imagen ISO, o un dispositivo de almacenamiento masivo USB). Para obtener instrucciones detalladas, consulte la <xref linkend="sec.update.sle12.manual.dvd"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      Un origen de instalación en red. Puede arrancar desde el medio local y después seleccionar el tipo de instalación de red correspondiente, o bien arrancar mediante PXE. Para obtener instrucciones detalladas, consulte la <xref linkend="sec.update.sle12.manual.network"/>.
     </para>
    </listitem>
   </itemizedlist>
   <sect2 xml:id="sec.update.sle12.manual.dvd">
    <title>Actualización desde un medio de instalación</title>
    <para>
     El procedimiento siguiente describe el arranque desde un DVD como ejemplo, pero también es posible usar otro medio de instalación local, como una imagen ISO o un dispositivo de almacenamiento masivo USB. La forma de seleccionar el método de arranque y de iniciar el sistema desde el medio dependen de la arquitectura del sistema y de si el equipo cuenta con un BIOS tradicional o de UEFI. Para obtener más información, consulte los enlaces siguientes.
    </para>
    <procedure xml:id="pro.update.sle12.manual.dvd">
     <title>Actualización manual desde SLE 11 SP3 a SLE 12 SP1 mediante un DVD</title>
     <step>
      <para>
       Inserte el DVD 1 del medio de instalación de SUSE Linux Enterprise 12 SP1 y arranque el equipo. Se muestra una pantalla de <guimenu>bienvenida</guimenu>, seguida de la pantalla de arranque.
      </para>
     </step>
     <step>
      <para>
       Seleccione el método de arranque correspondiente para iniciar el sistema desde el medio (consulte la <xref linkend="sec.i.yast2.method"/>).
      </para>
     </step>
     <step>
      <para>
       Inicie el sistema desde el medio (consulte la <xref linkend="sec.i.yast2.startup"/>).
      </para>
     </step>
     <step>
      <para>
       Proceda con el proceso de actualización descrito en la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
      </para>
     </step>
    </procedure>
   </sect2>
   <sect2 xml:id="sec.update.sle12.manual.network">
    <title>Actualización desde un origen de instalación de red</title>
    <para>
     Si desea iniciar una actualización desde un origen de instalación de red, compruebe que se cumplen los siguientes requisitos:
    </para>
    <variablelist>
     <title>Requisitos para actualizar desde un origen de instalación de red</title>
     <varlistentry>
      <term>Origen de instalación de red</term>
      <listitem>
       <para>
        Un origen de instalación de red se configura como se describe en la <xref linkend="sec.deployment.remoteinst.instserver"/>.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Conexión de red y servicios de red</term>
      <listitem>
       <para>
        Tanto el servidor de instalación como el equipo de destino deben disponer de una conexión funcional a la red. La red debe proporcionar los siguientes servicios: un servicio de nombres, DHCP (opcional, pero necesario para arrancar mediante PXE) y OpenSLP (opcional).
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Medios de instalación</term>
      <listitem>
       <para>
        Disponga del DVD 1 de SUSE Linux Enterprise (de una imagen ISO local) a mano para arrancar el sistema de destino <emphasis>o</emphasis> un sistema de destino que se configure para arrancar mediante PXE según <xref linkend="sec.deployment.remoteinst.boot.pxeprep" xrefstyle="HeadingOnPage"/>. Consulte la <xref linkend="cha.deployment.remoteinst"/> para obtener información más detallada sobre cómo iniciar la actualización desde un servidor remoto.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     Al actualizar desde un origen de instalación de red, puede arrancar desde el medio local y después seleccionar el tipo de instalación de red correspondiente, o bien arrancar mediante PXE. Seleccione el método que prefiera y continúe como se describe en el <xref linkend="pro.update.sle12.manual.network.boot-from-dvd" xrefstyle="select:label"/> o en el <xref linkend="pro.update.sle12.manual.network.pxe-boot" xrefstyle="select:label"/>.
    </para>
    <procedure xml:id="pro.update.sle12.manual.network.boot-from-dvd">
     <title>Actualización manual de SLE 11 SP3 o SP4 a SLE 12 SP1 mediante un origen de instalación de red con arranque desde un DVD</title>
     <para>
      Este procedimiento describe el arranque desde un DVD como ejemplo, pero también es posible usar otro medio de instalación local, como una imagen ISO o un dispositivo de almacenamiento masivo USB. La forma de seleccionar el método de arranque y de iniciar el sistema desde el medio dependen de la arquitectura del sistema y de si el equipo cuenta con un BIOS tradicional o de UEFI. Para obtener más información, consulte los enlaces siguientes.
     </para>
     <step>
      <para>
       Inserte el DVD 1 del medio de instalación de SUSE Linux Enterprise 12 SP1 y arranque el equipo. Se muestra una pantalla de <guimenu>bienvenida</guimenu>, seguida de la pantalla de arranque.
      </para>
     </step>
     <step>
      <para>
       Seleccione el tipo de origen de instalación de red que desee usar (FTP, HTTP, NFS, SMB o SLP). Habitualmente, estas opciones se obtienen al pulsar <keycap>F4</keycap>, pero en el caso de que el equipo cuente con UEFI en lugar de un BIOS tradicional, puede ser necesario ajustar manualmente los parámetros de arranque. Para obtener más información, consulte <xref linkend="sec.i.yast2.source.net"/> en el <xref linkend="cha.inst"/>.
      </para>
     </step>
     <step>
      <para>
       Proceda con el proceso de actualización descrito en la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
      </para>
     </step>
    </procedure>
    <procedure xml:id="pro.update.sle12.manual.network.pxe-boot">
     <title>Actualización manual de SLE 11 SP3 o SP4 a SLE 12 SP1 mediante un origen de instalación de red con arranque mediante PXE</title>
     <para>
      Para realizar una actualización desde un origen de instalación de red mediante el arranque PXE, siga este procedimiento:
     </para>
     <step>
      <para>
       Ajuste la configuración del servidor DHCP para proporcionar la información de dirección necesaria para el arranque mediante PXE. Para obtener información, consulte la <xref linkend="sec.deployment.remoteinst.boot.pxeprep"/>.
      </para>
     </step>
     <step>
      <para>
       Configure un servidor TFTP para almacenar la imagen de arranque necesaria para el arranque PXE. Use el DVD 1 del medio de instalación de SUSE Linux Enterprise 12 SP1 para ello o siga las instrucciones descritas en la <xref linkend="sec.deployment.remoteinst.boot.tftp"/>.
      </para>
     </step>
     <step>
      <para>
       Prepare el arranque PXE y Wake-on-LAN en el equipo de destino.
      </para>
     </step>
     <step>
      <para>
       Inicie el arranque del sistema de destino y utilice el VNC para conectar de forma remota con la rutina de instalación en ejecución en ese equipo. Para obtener más información, consulte la <xref linkend="sec.deployment.remoteinst.monitor.vnc"/>.
      </para>
     </step>
     <step>
      <para>
       Proceda con el proceso de actualización descrito en la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
      </para>
     </step>
    </procedure>
   </sect2>
  </sect1>

  <sect1 xml:id="sec.update.sle12.automated">
   <title>Migración automática desde SLE 11 SP3 o SP4 a SLE 12 SP1</title>
   <para>
    Antes de actualizar el sistema, lea la <xref linkend="sec.update.prep"/>. Para realizar una migración automatizada, proceda como se indica:
   </para>
   <procedure xml:id="pro.update.sle12.automated">
    <title>Migración automatizada desde SUSE Linux Enterprise 11 SP3 a SUSE Linux Enterprise 12  SP1</title>
    <remark>toms 2014-03-19: See FATE#315037</remark>
    <remark role="future">toms 2014-03-20: From SLE12 SP1 on, we should probably base
    this example on GRUB2, but not for GA.</remark>
     <remark>jsrain 2015-09-02: This is still the old system; at some point
       of time we should switch to GRUB2, but as long as amjority of
       customers still runs SLE11, I would stay with legacy GRUB. Anyway, we
       could include both op6tions, that would be probably best solution</remark>
    <step>
     <para>
      Copie la instalación del núcleo <filename>linux</filename> y el archivo <filename>initrd</filename> de <filename>/boot/x86_64/loader/</filename> del primer DVD de instalación al directorio <filename>/boot</filename> del sistema:
     </para>
<screen><command>cp</command> -vi <replaceable>DVDROOT</replaceable>/boot/x86_64/loader/linux /boot/linux.upgrade
<command>cp</command> -vi <replaceable>DVDROOT</replaceable>/boot/x86_64/loader/initrd /boot/initrd.upgrade</screen>
     <para>
      <replaceable>DVDROOT</replaceable> marca la vía donde sus sistema carga el DVD, normalmente <filename>/run/media/$USER/$DVDNAME</filename>.
     </para>
    </step>
    <step>
     <para>
      Abra el archivo de configuración GRUB <filename>/boot/grub/menu.lst</filename> y añada otra sección. Para otros cargadores de arranque, edite el/los respectivo(s) archivo(s) de configuración. Ajuste los nombres de dispositivos y el parámetro <parameter>root</parameter> de la forma correspondiente. Por ejemplo:
     </para>
<screen>title Linux Upgrade Kernel
kernel (hd0,0)/boot/linux.upgrade root=/dev/sda1 upgrade=1 <replaceable>OPTIONAL_PARAMETERS</replaceable>
initrd (hd0,0)/boot/initrd.upgrade</screen>
     <para>
      <replaceable>OPTIONAL_PARAMETERS</replaceable> señale parámetros adicionales de arranque que pueda necesitar para arrancar su sistema y realizar la actualización. Estos pueden ser parámetros de núcleo que su sistema necesita: compruebe si necesita revisarlos y copiarlos desde una entrada existente GRUB. También pueden ser parámetros <link xlink:href="http://en.opensuse.org/Linuxrc">linuxrc de SUSE, para los que encontrará documentación en línea</link>.
     </para>
    </step>
    <step>
     <para>
      Si la actualización debe ser automatizada <phrase os="sles"> (consulte la <xref linkend="sec.update.auto.run"/>)</phrase>, añada <option>autoupgrade=1</option> al final de la línea del <literal>núcleo</literal> en su configuración GRUB.
     </para>
    </step>
    <step>
     <para>
      Vuelva a arrancar su equipo y seleccione la sección añadida de nuevo desde el menú de arranque (aquí: <emphasis>Linux Upgrade Kernel</emphasis>). Puede utilizar <command>grubonce</command> para preseleccionar la entrada de GRUP recién creada para un rearranque automático sin supervisión en la entrada recién creada. También puede utilizar <command>rearranque</command> para iniciar el rearranque desde la línea de comandos.
     </para>
    </step>
    <step>
     <para>
      Continúe con el procedimiento de actualización habitual, como se detalla en la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
     </para>
    </step>
    <step>
     <para>
      Después de que el proceso de actualización finalice con éxito, elimine el núcleo de instalación y archivos initrd (<filename>/boot/linux.upgrade</filename> y <filename>/boot/initrd.upgrade</filename>). Ya no se necesitan.
     </para>
    </step>
   </procedure>
  </sect1>

  <sect1 xml:id="sec.update.sle12.start.upgr.after.boot">
   <title>Inicio del proceso de actualización tras el arranque</title>
   <para>
    <remark>taroth 2014-11-13: argh, the following is terminology hell regarding
     the software strings: "upgrade"/"update" are used intermittently and
     without clear differentiation...</remark>
   </para>
   <procedure>
    <step>
     <para>
      Después de arrancar (ya sea desde un medio de instalación o desde la red), seleccione la opción <guimenu>Actualizar</guimenu> en la pantalla de arranque.
     </para>
     <warning>
      <title>una elección equivocada puede provocar la pérdida de datos</title>
      <para>
       Si selecciona <guimenu>Instalación</guimenu> en lugar de <guimenu>Actualizar</guimenu>, más adelante se podrían perder datos. Debe tener mucho cuidado de no destruir sus particiones de datos al realizar una instalación nueva, por ejemplo, al volver a particionar los discos (que pueden destruir las particiones existentes), o al reformatear las particiones de datos (que borran todos los datos).
      </para>
      <para>
       Asegúrese de seleccionar <guimenu>Actualizar</guimenu> aquí.
      </para>
     </warning>
     <para>
      YaST inicia el sistema de instalación.
     </para>
    </step>
    <step>
     <para>
      En la pantalla <guimenu>Bienvenida,</guimenu> seleccione los valores oportunos en <guimenu>Idioma</guimenu> y <guimenu>Teclado</guimenu> y acepte el Acuerdo de licencia. Haga clic en <guimenu>Siguiente.</guimenu> 
     </para>
     <para>
      YaST comprueba en las particiones si hay sistemas SUSE Linux Enterprise ya instalados.
     </para>
    </step>
    <step>
     <para>
      En la pantalla <guimenu>Seleccionar para actualizar</guimenu>, seleccione la partición que desea actualizar y haga clic en <guimenu>Siguiente</guimenu>.
     </para>
     <para>
      YaST monta la partición seleccionada y muestra todos los repositorios que encuentra en la partición que desea actualizar.
     </para>
    </step>
    <step>
     <para>
      En la pantalla <guimenu>Repositorios usados anteriormente</guimenu>, ajuste el estado de los repositorios: habilite los que desea incluir en el proceso de actualización e inhabilite los que ya no necesite. Haga clic en <guimenu>Siguiente.</guimenu> 
     </para>
    </step>
    <step>
     <para>
      En la pantalla <guimenu>Registro</guimenu>, seleccione si desea registrar el sistema actualizado ahora (introduciendo los datos de registro y haciendo clic en <guimenu>Siguiente</guimenu>) o si desea <guimenu>Omitir el registro</guimenu>. Para obtener más información sobre cómo registrar el sistema, consulte la <xref linkend="sec.update.registersystem"/>.
     </para>
     <para>
      La pantalla <guimenu>Configuración de la instalación</guimenu> siguiente se muestra en el último paso antes de que comience la actualización.
     </para>
    </step>
    <step>
     <para>
      Revise la pantalla <guimenu>Configuración de la instalación</guimenu> de la actualización, sobre todo la sección <guimenu>Opciones de actualización</guimenu>. Elija entre las siguientes opciones:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <guimenu>Actualizar solo paquetes instalados</guimenu>. En este caso, podrían perderse las funciones nuevas incluidas en la última versión de SUSE Linux Enterprise.
       </para>
      </listitem>
      <listitem>
       <para>
        <guimenu>Actualizar con instalación de nuevo software y características</guimenu>. Haga clic en <guimenu>Seleccionar patrones</guimenu> si desea habilitar o inhabilitar los patrones y los paquetes según desee.
       </para>
      </listitem>
     </itemizedlist>

     <note>
      <title>elección del escritorio</title>
      <para>
       Si ha usado KDE antes de actualizar a SUSE Linux Enterprise 12 (<varname>DEFAULT_WM</varname> en <filename>/etc/sysconfig/windowmanager</filename> se definió como <literal>kde*</literal>), el entorno de escritorio se sustituirá automáticamente con GNOME después de la actualización. Por defecto, el gestor de pantalla KDM se sustituirá por GDM.
      </para>
      <para>
       Para cambiar la elección del entorno de escritorio o el gestor de ventanas, ajuste la selección del software haciendo clic en <guimenu>Seleccionar patrones</guimenu>.
      </para>
     </note>
    </step>
    <step>
     <para>
      Si está de acuerdo con todos los valores, inicie el procedimiento de instalación y eliminación haciendo clic en <guimenu>Actualizar</guimenu>.
     </para>
    </step>
   </procedure>
  </sect1>

  <sect1 xml:id="sec.update.sle12.manager">
   <title>Actualización a través de SUSE Manager</title>
   <para>
    SUSE Manager es una solución de servidor para proporcionar actualizaciones, parches y soluciones de seguridad para los clientes de SUSE Linux Enterprise. Incorpora un conjunto de herramientas y una interfaz de usuario Web para tareas de gestión.
   </para>
   <para>
     <remark>toms 2015-08-24: Adapt this link to a better source; at the
     time being, this was the best what we can get.</remark> La documentación de SUSE Manager de <link xlink:href="https://www.suse.com/documentation/suse_manager/book_susemanager_install/data/s1-maintenance-update.html"/> ofrece una descripción general de sus funciones e instrucciones acerca de cómo configurar servidores y clientes.
   </para>
  </sect1>

  <sect1 xml:id="sec.update.registersystem">
    <title>Registro del sistema</title>

    <para>
      Si omitió el paso de registro durante la instalación, puede registrar el sistema en cualquier momento mediante el módulo <guimenu>Registro del producto</guimenu> de YaST.
    </para>
    <para>Registrar los sistemas presenta las ventajas siguientes:</para>
    <itemizedlist>
      <listitem>
        <para>Obtención de asistencia</para>
      </listitem>
      <listitem>
        <para>Obtención de actualizaciones de seguridad y soluciones de errores</para>
      </listitem>
      <listitem>
        <para>Acceso al Centro de servicios al cliente de SUSE</para>
      </listitem>
    </itemizedlist>

    <procedure>
      <step>
        <para>
          Inicie YaST y seleccione <menuchoice> <guimenu>Software</guimenu> <guimenu>Registro del producto</guimenu> </menuchoice> para abrir el recuadro de diálogo <guimenu>Registro</guimenu>.
        </para>
      </step>
      <step>
        <para>
          Indique la dirección de <guimenu>correo electrónico</guimenu> asociada con la cuenta de SUSE que usted o su organización utilice para gestionar las suscripciones. En caso de que aún no tenga una cuenta de SUSE, diríjase a la página principal del Centro de servicios al cliente de SUSE (<link xlink:show="new" xlink:href="https://scc.suse.com/"/>) a fin de crear una.
        </para>
      </step>
      <step>
        <para>
          Introduzca el <guimenu>código de registro</guimenu> que recibió con la copia de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
        </para>
      </step>
      <step xml:id="step.y2.register.final">
        <para>
          Haga clic en <guimenu>Siguiente</guimenu> para iniciar el proceso de registro. Si en la red hay más de un servidor de registro local disponible, podrá elegir uno en la lista. También puede hacer clic en <guimenu>Cancelar</guimenu> para ignorar los servidores de registro locales y registrarse con el servidor de registro de SUSE por defecto.
        </para>
        <para>
          Durante el registro, los canales de actualización en línea se añaden a la configuración de la instalación.
        </para>
        <para>
          Después de registrarse correctamente, YaST muestra una lista de extensiones, productos adicionales y módulos disponibles para el sistema. Para seleccionarlos e instalarlos, continúe en la <xref linkend="sec.add-ons.extensions"/>.
        </para>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="sec.update.sle12.multiversion">
    <title>Conservación de paquetes de núcleos</title>
    <remark>toms 2015-08-26: bsc#753809</remark> <remark>toms 2015-08-26: some parts are taken ("stolen") from the
      wiki at https://en.opensuse.org/SDB:Keep_multiple_kernel_versions
      and adapted
    </remark> <indexterm> <primary>núcleos multiversión</primary> </indexterm>
    <para>Al instalar un núcleo nuevo con YaST o Zypper, SUSE Linux Enterprise conserva los dos últimos núcleos y el núcleo en ejecución. En la mayoría de los casos, esto es suficiente.</para>
    <para>Sin embargo, pueden presentarse situaciones en las que desee conservar más versiones del núcleo; por ejemplo, para realizar pruebas. Para permitirlo, SUSE Linux Enterprise admite la función de <emphasis>núcleo multiversión</emphasis>. Al habilitar y configurar esta función, el comportamiento por defecto se puede cambiar y configurar para lo siguiente: </para>
    <itemizedlist>
      <listitem>
        <para>que se suprima un núcleo antiguo solo después de rearrancar el sistema correctamente con el núcleo nuevo;</para>
      </listitem>
      <listitem>
        <para>que se conserve un número específico de núcleos antiguos como sistema de vuelta atrás;</para>
      </listitem>
      <listitem>
        <para>que se conserve una versión específica del núcleo. </para>
      </listitem>
    </itemizedlist>
    <para>Después de rearrancar correctamente, un guion compara la lista de núcleos instalados con el valor de <filename>/etc/zypp/zypp.conf</filename> y suprime los núcleos que ya no se necesitan. </para>
    <sect2 xml:id="sec.update.sle12.multiversion.enable">
      <title>Habilitación de la función de núcleo multiversión</title>
      <para>El comportamiento por defecto se define en el archivo de configuración <filename>/etc/zypp/zypp.conf</filename>:</para>
      <screen><prompt>root # </prompt><command>grep</command> ^multiversion /etc/zypp/zypp.conf
multiversion = provides:multiversion(kernel)
multiversion.kernels = latest,latest-1,running</screen>
      <para>Elimine los signos de almohadilla (#) situados delante de la línea <literal>multiversion</literal> de arriba para habilitar la función (ya debería aparecer así). La segunda línea se usa para configurar <emphasis>qué</emphasis> núcleos se deben conservar. Debe habilitar ambas líneas o el sistema conservará <emphasis>todos</emphasis> los núcleos, lo que llenará todo el espacio del disco duro. </para>
      <para>La línea <literal>multiversion.kernels</literal> puede incluir varias palabras clave en distintas combinaciones y con distinto orden:</para>
      <variablelist>
        <varlistentry>
          <term><option>latest</option></term>
          <listitem>
            <para>Conserva el núcleo con el número de versión más alto.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>latest-<replaceable>N</replaceable></option></term>
          <listitem>
            <para>Conserva el núcleo con el enésimo (<replaceable>N</replaceable>) número de versión más alto; <replaceable>N</replaceable> es un número que empieza desde 1.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>running</option></term>
          <listitem>
            <para>Conserva el núcleo en ejecución.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>oldest</option></term>
          <listitem>
            <para>Conserva el núcleo con el número de versión más bajo (el núcleo del producto publicado)</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>oldest-<replaceable>N</replaceable></option></term>
          <listitem>
            <para>Conserva el núcleo con el enésimo (<replaceable>N</replaceable>) número de versión más bajo.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>3.12.28-4.6</option></term>
          <listitem>
            <para>Conserva esta versión exacta del núcleo.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="sec.update.sle12.multiversion.deleteoldkernel">
      <title>Caso de uso: supresión de un núcleo anterior solo después de rearrancar</title>
      <para>Quiere asegurarse de que un núcleo antiguo solo se suprimirá después de que el sistema se haya arrancado correctamente con el núcleo nuevo. </para>
      <para>Cambie la línea siguiente en <filename>/etc/zypp/zypp.conf</filename>:</para>
      <screen>multiversion.kernels = latest,running</screen>
      <para>Los parámetros anteriores indican al sistema que conserve el núcleo más reciente y el que se está ejecutando solo si son distintos.</para>
    </sect2>

    <sect2 xml:id="sec.update.sle12.multiversion.fallback">
      <title>Caso de uso: conservación de núcleos anteriores como medida de vuelta atrás</title>
      <para>Desea conservar uno o varios núcleos para disponer de uno o varios núcleos <quote>de repuesto</quote>.</para>
      <para>Esta situación puede ser útil si necesita núcleos para realizar pruebas. En caso de que algo vaya mal, por ejemplo que el equipo no arranque, podrá seguir usando una o varias versiones del núcleo que se sabe que funcionan.</para>
      <para>Cambie la línea siguiente en <filename>/etc/zypp/zypp.conf</filename>:</para>
      <screen>multiversion.kernels = latest,latest-1,latest-2,running</screen>
      <para>Cuando se rearranca el sistema después de la instalación de un núcleo nuevo, el sistema conservará tres núcleos: el nuevo y el que se está ejecutando (configurados como <literal>latest,running</literal>), la versión anterior al nuevo (configurada como <literal>latest-1</literal>) y la versión precedente a la versión anterior del núcleo (configurada como <literal>latest-2</literal>). </para>
    </sect2>

    <sect2 xml:id="sec.update.sle12.multiversion.specificversion">
      <title>Caso de uso: conservación de una versión específica del núcleo</title>
      <para>Realiza actualizaciones habituales del sistema e instala nuevas versiones del núcleo. Sin embargo, también compila su propia versión del núcleo por diversos motivos y desea asegurarse de que el sistema funcionará correctamente.
      </para>
      <para>Cambie la línea siguiente en <filename>/etc/zypp/zypp.conf</filename>:</para>
      <screen>multiversion.kernels = latest,3.12.28-4.20,running</screen>
      <para>Cuando se rearranca el sistema después de la instalación de un núcleo nuevo, el sistema conservará dos núcleos: el nuevo y el que se está ejecutando (configurados como <literal>latest,running</literal>) y el núcleo que ha compilado (configurado como <literal>3.12.28-4.20</literal>).
      </para>
    </sect2>
  </sect1>
</chapter>
