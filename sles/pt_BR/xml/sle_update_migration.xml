<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_migration.xml" version="5.0" xml:id="cha.update.spmigration">
  <title>Migração de service pack</title>
  <info>
    <abstract>
      <para>O SUSE agora oferece aos administradores de sistema novas ferramentas com alguns recursos interessantes para migração online de service pack. Tratam-se de ferramentas simples de linha de comando, de uma interface gráfica do usuário intuitiva, de suporte a <quote>rollback</quote> de service packs, etc. Este capítulo explica passo a passo como fazer a migração de service pack com as novas ferramentas.</para>
    </abstract>
  </info>

  <sect1 xml:id="sec.update.migr.supported-scenarios-and-versions">
    <title>Cenários e versões suportados</title>
    <para>O SUSE suporta os seguintes cenários, tanto offline quanto online:</para>

    <variablelist>
      <varlistentry>
        <term>Online</term>
        <listitem>
          <para>SUSE Customer Center, SMT (Subscription Management Tool), SUSE Manager</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Offline</term>
        <listitem>
          <para>DVD de Boot, pendrive USB, imagem ISO, AutoYaST, <quote>rpm simples</quote> e ferramentas de terceiros</para>
        </listitem>
      </varlistentry>
    </variablelist>
    
    <para>As versões de a seguir são suportadas:</para>
    
    <variablelist>
      <varlistentry>
        <term>Online</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Offline</term>
        <listitem>
          <para>SUSE Linux Enterprise 11 SP3/SP4, SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Manualmente/Terceiros</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="sec.update.migr.workflow">
    <title>Workflow de migração de service pack</title>
    <para>É possível executar a migração de service pack pelo YaST, <command>zypper</command>, AutoYaST, RPM ou por ferramentas de terceiros. Este capítulo descreve apenas os dois primeiros. Independentemente do método, a migração de service pack consiste nas seguintes etapas:</para>
    <orderedlist>
      <listitem>
        <para>Localize os destinos de migração possíveis.</para>
      </listitem>
      <listitem>
        <para>Selecione um destino de migração.</para>
      </listitem>
      <listitem>
        <para>Solicite e habilite novos repositórios.</para>
      </listitem>
      <listitem>
        <para>Execute a migração.</para>
      </listitem>
    </orderedlist>

    
    <para>A lista de destinos de migração depende dos produtos que você instalou. Se você tem uma extensão instalada para a qual ainda não há um novo SP disponível, talvez nenhum destino de migração seja oferecido a você.</para>
    <para>A lista de destinos de migração disponíveis para o seu host sempre é recuperada do SUSE Customer Center, depende dos produtos ou extensões instalados e pode mudar ao longo do tempo; o que significa, por exemplo, que a migração do SLE12 GA para o SP2 pode ser possível para um host, mas não para outro.</para>
  </sect1>

  <sect1 xml:id="sec.update.migr.yast.onlinemigr">
    <title>Migrando com o YaST (ferramenta Migração Online)</title>
    <para>Para executar a migração de service pack com o YaST, use a ferramenta <guimenu>Migração Online</guimenu>. Por padrão, o YaST não instala nenhum pacote de um repositório de terceiros. Se um pacote foi instalado de um repositório de terceiros, o YaST impede que os pacotes sejam substituídos pelo mesmo pacote que vem do SUSE.
    </para>
    <procedure xml:id="pro.update.migr.yast">
      <step>
        <para>Instale as atualizações mais recentes para ter o módulo <guimenu>Migração Online</guimenu>.</para>
      </step>
      <step>
        <para>Instale o pacote <package>yast2-migration</package>
          e suas dependências. </para>
      </step>
      <step>
        <para>Reinicie o YaST; do contrário, o módulo recém-instalado não será mostrado no centro de controle.</para>
      </step>
      <step>
        <para>Inicie o módulo <guimenu>Migração Online</guimenu> da seção <guimenu>Sistema</guimenu> no YaST. </para>
        <para>O YaST mostra os destinos de migração possíveis e um resumo.</para>
      </step>
      <step>
        <para>Selecione um destino de migração e clique em <guimenu>Avançar</guimenu> para continuar.</para>
      </step>
      <step>
        <para>Se a ferramenta Migração Online oferecer repositórios de atualização, decida se você os deseja. Recomenda-se clicar em <guimenu>Sim</guimenu> para continuar.
          
        </para>
      </step>
      <step>
        <para><remark>toms 2015-09-09: FATE#319140</remark> Se a ferramenta Migração Online encontrar repositórios obsoletos de DVD ou de um servidor local, será altamente recomendado desabilitá-los. Os repositórios antigos do SUSE Customer Center ou da Subscription Management Tool são automaticamente removidos.
        </para>
      </step>
      <step>
        <para>Confira o resumo e clique em <guimenu>Avançar</guimenu> para continuar a migração. Clique em <guimenu>Iniciar Atualização</guimenu> para confirmar.</para>
      </step>
      <step>
        <para>Reinicie o sistema após a migração bem-sucedida.</para>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="sec.update.migr.zypper.onlinemigr">
    <title>Migrando com o Zypper</title>
    <para>Para executar a migração de service pack com o Zypper, use a ferramenta de linha de comando <command>zypper</command> <option>migration</option>.</para>
    <procedure>
      <step>
        <para>Efetue login na máquina do SUSE Linux Enterprise 12.</para>
      </step>
      <step>
        <para>Instale as atualizações mais recentes.</para>
      </step>
      <step>
        <para>Instale os pacotes
            <package>zypper-migration-plugin</package> e suas dependências. </para>
      </step>
      <step>
        <para>Execute <command>zypper</command> <option>migration</option>:</para>
        <screen><prompt>root # </prompt><command>zypper</command> migration
Executing 'zypper  patch-check'

Refreshing service 'SUSE_Linux_Enterprise_Server_12_x86_64'.
Loading repository data...
Reading installed packages...
0 patches needed (0 security patches)

Available migrations:

    1 | SUSE Linux Enterprise Server 12 SP1 x86_64</screen>
        <remark>toms 2015-09-07: From FATE#319128</remark>
        <para>Por padrão, o Zypper usa a opção <option>--no-allow-vendor-change</option>, que é passada para o <command>zypper</command> <option>dup</option>. Se um pacote foi instalado de um repositório de terceiros, essa opção impede que os pacotes sejam substituídos pelo mesmo pacote que vem do SUSE.
        </para>
      </step>
      <step>
        <para>
        <remark>toms 2015-09-09: FATE#319140</remark> Se o Zypper encontrar repositórios obsoletos de DVD ou de um servidor local, será altamente recomendado desabilitá-los. Os repositórios SCC ou SMT antigos são automaticamente removidos.
        </para>
      </step>
      <step>
        <para>Revise todas as mudanças, principalmente os pacotes que serão removidos. Digite <literal>y</literal> para continuar (o número exato de pacotes para upgrade pode variar de acordo com o sistema):</para>
        <screen>266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</screen>
        <para>Use as teclas <keycombo> <keycap function="shift"/> <keycap function="pageup"/> </keycombo> ou <keycombo> <keycap function="shift"/> <keycap function="pagedown"/> </keycombo> para mover a barra de rolagem no shell.</para>
      </step>
      <step>
        <para>Reinicie o sistema após a migração bem-sucedida.</para>
      </step>
    </procedure>
  </sect1>

</chapter>
