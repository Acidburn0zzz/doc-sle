<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_migration.xml" version="5.0" xml:id="cha.update.spmigration">
  <title>サービスパックのマイグレーション</title>
  <info>
    <abstract>
      <para>SUSEは、サービスパックのオンラインマイグレーションとして、システム管理者の方の関心を引く各種機能を備えた新しいツールをご用意しています。これらは、シンプルなコマンドラインツールや直感的なグラフィカルユーザインタフェース、サービスパックの<quote>ロールバック</quote>のサポートなどです。この章では、これらの新しいツールを使用してサービスパックのマイグレーションを実行する方法を順を追って説明します。</para>
    </abstract>
  </info>

  <sect1 xml:id="sec.update.migr.supported-scenarios-and-versions">
    <title>サポートされるシナリオとバージョン</title>
    <para>SUSEは、オフラインまたはオンラインによって次のシナリオをサポートします。</para>

    <variablelist>
      <varlistentry>
        <term>オンライン</term>
        <listitem>
          <para>SUSE Customer Center、SMT (Subscription Management Tool)、SUSE Manager</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>オフライン</term>
        <listitem>
          <para>ブートDVD、USBスティック、ISOイメージ、AutoYaST、<quote>プレーンRPM</quote>、およびサードパーティ製ツール</para>
        </listitem>
      </varlistentry>
    </variablelist>
    
    <para>次のバージョンがサポートされます。</para>
    
    <variablelist>
      <varlistentry>
        <term>オンライン</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>オフライン</term>
        <listitem>
          <para>SUSE Linux Enterprise 11 SP3/SP4、SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>手動/サードパーティ</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="sec.update.migr.workflow">
    <title>サービスパックのマイグレーションのワークフロー</title>
    <para>サービスパックのマイグレーションは、YaST、<command>zypper</command>、AutoYaST、RPM、またはサードパーティ製ツールで実行できます。この章では、最初の2つについてのみ説明します。どの方法を使用する場合も、サービスパックのマイグレーションは次の手順で構成されます。</para>
    <orderedlist>
      <listitem>
        <para>可能性があるマイグレーションターゲットを特定します。</para>
      </listitem>
      <listitem>
        <para>マイグレーションターゲットを選択します。</para>
      </listitem>
      <listitem>
        <para>新しいリポジトリを要求して有効にします。</para>
      </listitem>
      <listitem>
        <para>マイグレーションを実行します。</para>
      </listitem>
    </orderedlist>

    
    <para>マイグレーションターゲットのリストは、インストールされている製品に応じて異なります。新しいSPがまだ利用可能になっていない拡張機能がインストールされている場合、マイグレーションターゲットが提供されない可能性があります。</para>
    <para>ホストで利用可能なマイグレーションターゲットのリストは常にSUSE Customer Centerから取得され、インストールされている製品や拡張機能に応じて異なるほか、時間の経過に伴って変わることもあります。たとえば、あるホストではSLE12 GAからSP2へのマイグレーションが可能であっても、他のホストでは不可能な場合があります。</para>
  </sect1>

  <sect1 xml:id="sec.update.migr.yast.onlinemigr">
    <title>YaST (［Online Migration (オンラインマイグレーション)］ツール)を使用したマイグレーション</title>
    <para>YaSTを使用してサービスパックのマイグレーションを実行するには、<guimenu>Online Migration (オンラインマイグレーション)</guimenu>ツールを使用します。デフォルトでは、YaSTはサードパーティリポジトリからパッケージをインストールしません。パッケージがサードパーティリポジトリからインストールされている場合、YaSTは、SUSEから提供されている同じパッケージによってパッケージが置き換えられるのを防ぎます。
    </para>
    <procedure xml:id="pro.update.migr.yast">
      <step>
        <para>最新のアップデートをインストールして<guimenu>Online Migration (オンラインマイグレーション)</guimenu>モジュールを入手します。</para>
      </step>
      <step>
        <para>パッケージ <package>yast2-migration</package>
          およびその依存関係をインストールします。 </para>
      </step>
      <step>
        <para>YaSTを再起動します。再起動しないと、新しくインストールしたモジュールがコントロールセンターに表示されません。</para>
      </step>
      <step>
        <para>YaSTの<guimenu>System (システム)</guimenu>セクションから<guimenu>Online Migration (オンラインマイグレーション)</guimenu>モジュールを起動します。 </para>
        <para>可能性のあるマイグレーションターゲットと概要がYaSTによって表示されます。</para>
      </step>
      <step>
        <para>マイグレーションターゲットを選択し、<guimenu>Next (次へ)</guimenu>を選択して続行します。</para>
      </step>
      <step>
        <para>［Online Migration (オンラインマイグレーション)］ツールによってアップデートリポジトリが提供されている場合、それらが必要かどうかを判断します。<guimenu>Yes (はい)</guimenu>を選択して続行することをお勧めします。
          
        </para>
      </step>
      <step>
        <para><remark>toms 2015-09-09: FATE#319140</remark>［Online Migration (オンラインマイグレーション)］ツールにより、DVDまたはローカルサーバから提供されている古いリポジトリが検出される場合は、それらを無効にすることを強くお勧めします。SUSE Customer CenterまたはSubscription Management Toolからの古いリポジトリは自動的に削除されます。
        </para>
      </step>
      <step>
        <para>概要を確認し、<guimenu>Next (次へ)</guimenu>をクリックしてマイグレーションを続行します。<guimenu>Start Update (アップデートの開始)</guimenu>を選択して確認します。</para>
      </step>
      <step>
        <para>マイグレーションが正常に完了したら、システムを再起動します。</para>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="sec.update.migr.zypper.onlinemigr">
    <title>Zypperによるマイグレーション</title>
    <para>Zypperを使用してサービスパックのマイグレーションを実行するには、コマンドラインツール<command>zypper</command> <option>migration</option>を使用します。</para>
    <procedure>
      <step>
        <para>ご使用のSUSE Linux Enterprise 12マシンにログインします。</para>
      </step>
      <step>
        <para>最新のアップデートをインストールします。</para>
      </step>
      <step>
        <para>パッケージ
            <package>zypper-migration-plugin</package> およびその依存関係をインストールします。 </para>
      </step>
      <step>
        <para><command>zypper</command> <option>migration</option>を実行します。</para>
        <screen><prompt>root # </prompt><command>zypper</command> migration
Executing 'zypper  patch-check'

Refreshing service 'SUSE_Linux_Enterprise_Server_12_x86_64'.
Loading repository data...
Reading installed packages...
0 patches needed (0 security patches)

Available migrations:

    1 | SUSE Linux Enterprise Server 12 SP1 x86_64</screen>
        <remark>toms 2015-09-07: From FATE#319128</remark>
        <para>デフォルトでは、Zypperは、<command>zypper</command> <option>dup</option>に渡されるオプション<option>--no-allow-vendor-change</option>を使用します。パッケージがサードパーティリポジトリからインストールされている場合、このオプションにより、SUSEから提供されている同じパッケージによって該当するパッケージが置き換えられるのを防ぎます。
        </para>
      </step>
      <step>
        <para>
        <remark>toms 2015-09-09: FATE#319140</remark>Zypperにより、DVDまたはローカルサーバから提供されている古いリポジトリが検出される場合は、それらを無効にすることを強くお勧めします。古いSCCまたはSMTリポジトリは自動的に削除されます。
        </para>
      </step>
      <step>
        <para>すべての変更内容を確認します。特に、削除されるパッケージに注意してください。「<literal>y</literal>」と入力して続行します(アップグレードするパッケージの正確な数はシステムによって異なる可能性があります)。</para>
        <screen>266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</screen>
        <para>シェルをスクロールするには、<keycombo> <keycap function="shift"/> <keycap function="pageup"/> </keycombo>または<keycombo> <keycap function="shift"/> <keycap function="pagedown"/> </keycombo>キーを使用します。</para>
      </step>
      <step>
        <para>マイグレーションが正常に完了したら、システムを再起動します。</para>
      </step>
    </procedure>
  </sect1>

</chapter>
