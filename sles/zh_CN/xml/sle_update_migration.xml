<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_migration.xml" version="5.0" xml:id="cha.update.spmigration">
  <title>服务包迁移</title>
  <info>
    <abstract>
      <para>SUSE 现在提供具备一些有趣功能的新工具，可供系统管理员进行服务包联机迁移。新工具都是简易的命令行工具，拥有直观的图形用户界面，支持服务包<quote>回滚</quote>，而且还具备其他更多功能。本章节介绍用新工具进行服务包迁移的逐步指南。</para>
    </abstract>
  </info>

  <sect1 xml:id="sec.update.migr.supported-scenarios-and-versions">
    <title>支持的方案和版本</title>
    <para>SUSE 支持以下方案（不论是联机还是脱机）：</para>

    <variablelist>
      <varlistentry>
        <term>联机</term>
        <listitem>
          <para>SUSE Customer Center、订阅管理工具 (SMT)、SUSE Manager</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>脱机</term>
        <listitem>
          <para>引导 DVD、USB 记忆棒、ISO 映像、AutoYaST、<quote>纯 RPM</quote> 和第三方工具</para>
        </listitem>
      </varlistentry>
    </variablelist>
    
    <para>支持以下版本：</para>
    
    <variablelist>
      <varlistentry>
        <term>联机</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>脱机</term>
        <listitem>
          <para>SUSE Linux Enterprise 11 SP3/SP4、SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>手动/第三方</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="sec.update.migr.workflow">
    <title>服务包迁移工作流程</title>
    <para>服务包迁移可通过 YaST、<command>zypper</command>、AutoYaST、RPM 或第三方工具执行。本章节只对前两种工具进行了说明。不论使用哪种方式，服务包迁移都包含以下步骤：</para>
    <orderedlist>
      <listitem>
        <para>查找可能的迁移目标。</para>
      </listitem>
      <listitem>
        <para>选择迁移目标。</para>
      </listitem>
      <listitem>
        <para>请求并启用新的储存库。</para>
      </listitem>
      <listitem>
        <para>运行迁移。</para>
      </listitem>
    </orderedlist>

    
    <para>迁移目标列表取决于您所安装的产品。如果您安装的扩展没有新的 SP 可用，则无法向您提供迁移目标。</para>
    <para>您主机可用的迁移目标列表将始终从 SUSE Customer Center 检索，并且视所安装的产品或扩展而定；该列表可能会随时间而变化 — 这意味着从 SLE12 GA 迁移到 SP2（以此为例）可能对一个主机有效，但是对其他主机就无效了。</para>
  </sect1>

  <sect1 xml:id="sec.update.migr.yast.onlinemigr">
    <title>使用 YaST 迁移（联机迁移工具）</title>
    <para>要通过 Yast 执行服务包迁移，请使用<guimenu>联机迁移</guimenu>工具。默认情况下，YaST 不会从第三方储存库安装任何包。如果某包是从第三方储存库安装的，YaST 会阻止该包替换成来自 SUSE 的相同包。
    </para>
    <procedure xml:id="pro.update.migr.yast">
      <step>
        <para>安装最新的更新，以获得<guimenu>联机迁移</guimenu>模块。</para>
      </step>
      <step>
        <para>安装包 <package>yast2-migration</package>
          及其依赖项。 </para>
      </step>
      <step>
        <para>重启动 YaST；如果不重启动，新安装的模块将不会显示在控制中心中。</para>
      </step>
      <step>
        <para>在 YaST 中的<guimenu>系统</guimenu>部分中，启动<guimenu>联机迁移</guimenu>模块。 </para>
        <para>YaST 将显示可能的迁移目标和摘要。</para>
      </step>
      <step>
        <para>选择一个迁移目标，然后单击<guimenu>下一步</guimenu>继续。</para>
      </step>
      <step>
        <para>如果“联机迁移”工具提供更新储存库，请决定您是否需要它们。建议单击<guimenu>是</guimenu>继续。
          
        </para>
      </step>
      <step>
        <para><remark>toms 2015-09-09: FATE#319140</remark>如果“联机迁移”工具找到来自 DVD 或本地服务器的过时储存库，强烈建议您将其禁用。SUSE Customer Center 或订阅管理工具中的旧储存库会自动去除。
        </para>
      </step>
      <step>
        <para>单击<guimenu>下一步</guimenu>，查看摘要并继续迁移过程。确认<guimenu>开始更新</guimenu>。</para>
      </step>
      <step>
        <para>成功迁移后，请重启动系统。</para>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="sec.update.migr.zypper.onlinemigr">
    <title>使用 Zypper 迁移</title>
    <para>要使用 Zypper 执行服务包迁移，请使用命令行工具 <command>zypper</command> <option>migration</option>。</para>
    <procedure>
      <step>
        <para>登录到 SUSE Linux Enterprise 12 计算机。</para>
      </step>
      <step>
        <para>安装最新的更新。</para>
      </step>
      <step>
        <para>安装包
            <package>zypper-migration-plugin</package> 及其依赖项。 </para>
      </step>
      <step>
        <para>运行 <command>zypper</command> <option>migration</option>：</para>
        <screen><prompt>root # </prompt><command>zypper</command> migration
Executing 'zypper  patch-check'

Refreshing service 'SUSE_Linux_Enterprise_Server_12_x86_64'.
Loading repository data...
Reading installed packages...
0 patches needed (0 security patches)

Available migrations:

    1 | SUSE Linux Enterprise Server 12 SP1 x86_64</screen>
        <remark>toms 2015-09-07: From FATE#319128</remark>
        <para>默认情况下，Zypper 会使用 <option>--no-allow-vendor-change</option> 选项，以传递到 <command>zypper</command> <option>dup</option>。如果某包是从第三方储存库安装的，此选项会阻止该包替换成来自 SUSE 的相同包。
        </para>
      </step>
      <step>
        <para>
        <remark>toms 2015-09-09: FATE#319140</remark>如果 Zypper 找到来自 DVD 或本地服务器的过时储存库，强烈建议您将其禁用。旧的 SCC 或 SMT 储存库会自动去除。
        </para>
      </step>
      <step>
        <para>查看所有更改，特别是即将去除的包。键入 <literal>y</literal>（要升级的包的确切数目会根据系统的不同而变化）继续：</para>
        <screen>266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</screen>
        <para>使用 <keycombo> <keycap function="shift"/> <keycap function="pageup"/> </keycombo> 或 <keycombo> <keycap function="shift"/> <keycap function="pagedown"/> </keycombo> 键在外壳中滚动。</para>
      </step>
      <step>
        <para>成功迁移后，请重启动系统。</para>
      </step>
    </procedure>
  </sect1>

</chapter>
