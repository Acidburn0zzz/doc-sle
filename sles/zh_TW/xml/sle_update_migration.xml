<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_migration.xml" version="5.0" xml:id="cha.update.spmigration">
  <title>Service Pack 移轉</title>
  <info>
    <abstract>
      <para>SUSE 現在提供具備一些有趣功能的新工具，可供系統管理員進行 service pack 線上移轉。新工具都是簡易的指令行工具，擁有直觀的圖形使用者介面，支援 service pack <quote>復原</quote>，而且還具備其他更多功能。本章節介紹使用新工具進行 service pack 移轉的逐步指南。</para>
    </abstract>
  </info>

  <sect1 xml:id="sec.update.migr.supported-scenarios-and-versions">
    <title>支援的案例與版本</title>
    <para>SUSE 支援以下案例 (不論是線上還是離線)：</para>

    <variablelist>
      <varlistentry>
        <term>線上</term>
        <listitem>
          <para>SUSE Customer Center、訂閱管理工具 (SMT)、SUSE Manager</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>離線</term>
        <listitem>
          <para>將 DVD、USB 晶片組、ISO 影像、AutoYaST、<quote>純 RPM</quote> 和協力廠商工具開機</para>
        </listitem>
      </varlistentry>
    </variablelist>
    
    <para>支援以下版本：</para>
    
    <variablelist>
      <varlistentry>
        <term>線上</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>離線</term>
        <listitem>
          <para>SUSE Linux Enterprise 11 SP3/SP4、SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>手動/協力廠商</term>
        <listitem>
          <para>SUSE Linux Enterprise 12</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="sec.update.migr.workflow">
    <title>Service Pack 移轉工作流程</title>
    <para>Service Pack 移轉可透過 YaST、<command>zypper</command>、AutoYaST、RPM 或協力廠商工具執行。本章節只對前兩種工具進行了說明。不論使用哪種方式，Service Pack 移轉都包含以下步驟：</para>
    <orderedlist>
      <listitem>
        <para>尋找可能的移轉目標。</para>
      </listitem>
      <listitem>
        <para>選取移轉目標。</para>
      </listitem>
      <listitem>
        <para>申請並啟用新的儲存庫。</para>
      </listitem>
      <listitem>
        <para>執行移轉。</para>
      </listitem>
    </orderedlist>

    
    <para>移轉目標清單取決於您所安裝的產品。如果您安裝的延伸沒有新的 SP 可用，則無法向您提供移轉目標。</para>
    <para>您主機可用的移轉目標清單將始終從 SUSE Customer Center 擷取，並且視所安裝的產品或延伸而定；該清單可能會隨時間而變化 — 這意味著從 SLE12 GA 移轉到 SP2 (以此為例) 可能對一個主機有效，但是對其他主機就無效了。</para>
  </sect1>

  <sect1 xml:id="sec.update.migr.yast.onlinemigr">
    <title>使用 YaST 移轉 (線上移轉工具)</title>
    <para>要透過 Yast 執行 Service Pack 移轉，請使用<guimenu>線上移轉</guimenu>工具。依預設，YaST 不會從協力廠商儲存庫安裝任何套件。如果某套件是從協力廠商儲存庫安裝的，YaST 會阻止該套件取代為來自 SUSE 的相同套件。
    </para>
    <procedure xml:id="pro.update.migr.yast">
      <step>
        <para>安裝最新的更新，以獲得<guimenu>線上移轉</guimenu>模組。</para>
      </step>
      <step>
        <para>安裝套件 <package>yast2-migration</package>
          及其相依項。 </para>
      </step>
      <step>
        <para>重新啟動 YaST；如果不重新啟動，新安裝的模組將不會顯示在控制中心中。</para>
      </step>
      <step>
        <para>在 YaST 中的<guimenu>系統</guimenu>區段中，啟動<guimenu>線上移轉</guimenu>模組。 </para>
        <para>YaST 將顯示可能的移轉目標和摘要。</para>
      </step>
      <step>
        <para>選取一個移轉目標，然後按<guimenu>下一步</guimenu>繼續。</para>
      </step>
      <step>
        <para>如果「線上移轉」工具提供更新儲存庫，請決定您是否需要它們。建議按一下<guimenu>是</guimenu>繼續。
          
        </para>
      </step>
      <step>
        <para><remark>toms 2015-09-09: FATE#319140</remark>如果「線上移轉」工具找到來自 DVD 或本地伺服器的過時儲存庫，強烈建議您將其停用。SUSE Customer Center 或訂閱管理工具中的舊儲存庫會自動移除。
        </para>
      </step>
      <step>
        <para>按<guimenu>下一步</guimenu>，查看摘要並繼續移轉過程。確認<guimenu>開始更新</guimenu>。</para>
      </step>
      <step>
        <para>成功移轉後，請重新啟動系統。</para>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="sec.update.migr.zypper.onlinemigr">
    <title>使用 Zypper 移轉</title>
    <para>若要使用 Zypper 執行 Service Pack 移轉，請使用指令行工具 <command>zypper</command> <option>migration</option>。</para>
    <procedure>
      <step>
        <para>登入到 SUSE Linux Enterprise 12 機器。</para>
      </step>
      <step>
        <para>安裝最新的更新。</para>
      </step>
      <step>
        <para>安裝套件
            <package>zypper-migration-plugin</package> 及其相依項。 </para>
      </step>
      <step>
        <para>執行 <command>zypper</command> <option>migration</option>：</para>
        <screen><prompt>root # </prompt><command>zypper</command> migration
Executing 'zypper  patch-check'

Refreshing service 'SUSE_Linux_Enterprise_Server_12_x86_64'.
Loading repository data...
Reading installed packages...
0 patches needed (0 security patches)

Available migrations:

    1 | SUSE Linux Enterprise Server 12 SP1 x86_64</screen>
        <remark>toms 2015-09-07: From FATE#319128</remark>
        <para>依預設，Zypper 會使用 <option>--no-allow-vendor-change</option> 選項，以傳送到 <command>zypper</command> <option>dup</option>。如果某套件是從協力廠商儲存庫安裝的，此選項會阻止該套件取代為來自 SUSE 的相同套件。
        </para>
      </step>
      <step>
        <para>
        <remark>toms 2015-09-09: FATE#319140</remark>如果 Zypper 找到來自 DVD 或本地伺服器的過時儲存庫，強烈建議您將其停用。舊的 SCC 或 SMT 儲存庫會自動移除。
        </para>
      </step>
      <step>
        <para>檢閱所有變更，特別是即將移除的套件。輸入 <literal>y</literal> (要升級之套件的確切數量因系統而異) 繼續：</para>
        <screen>266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</screen>
        <para>使用 <keycombo> <keycap function="shift"/> <keycap function="pageup"/> </keycombo> 或 <keycombo> <keycap function="shift"/> <keycap function="pagedown"/> </keycombo> 鍵在外圍程序中捲動。</para>
      </step>
      <step>
        <para>成功移轉後，請重新啟動系統。</para>
      </step>
    </procedure>
  </sect1>

</chapter>
